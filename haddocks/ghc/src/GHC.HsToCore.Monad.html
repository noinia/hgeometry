<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>  </span><span class="hs-comment">-- instance MonadThings is necessarily an orphan</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Monadery used in desugaring
-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier">DsM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapAndUnzipM</span></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#initDs"><span class="hs-identifier">initDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#initDsTc"><span class="hs-identifier">initDsTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier">initTcDsForSolver</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#initDsWithModGuts"><span class="hs-identifier">initDsWithModGuts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#fixDs"><span class="hs-identifier">fixDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><span class="hs-identifier">foldlM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldrM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier">whenGOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier">unsetGOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier">unsetWOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier">xoptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><span class="hs-identifier">Applicative</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-operator">(&lt;$&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#duplicateLocalDs"><span class="hs-identifier">duplicateLocalDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier">newSysLocalDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier">newSysLocalsDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier">newSysLocalMDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalsMDs"><span class="hs-identifier">newSysLocalsMDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newFailLocalMDs"><span class="hs-identifier">newFailLocalMDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newUniqueId"><span class="hs-identifier">newUniqueId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newPredVarDs"><span class="hs-identifier">newPredVarDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier">getSrcSpanDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier">putSrcSpanDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDsA"><span class="hs-identifier">putSrcSpanDsA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkNamePprCtxDs"><span class="hs-identifier">mkNamePprCtxDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier">newUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier">UniqSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier">newUniqueSupply</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getGhcModeDs"><span class="hs-identifier">getGhcModeDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier">dsGetFamInstEnvs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier">dsLookupGlobal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier">dsLookupGlobalId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier">dsLookupTyCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier">dsLookupDataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupConLike"><span class="hs-identifier">dsLookupConLike</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getCCIndexDsM"><span class="hs-identifier">getCCIndexDsM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaEnv"><span class="hs-identifier">DsMetaEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaVal"><span class="hs-identifier">DsMetaVal</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetMetaEnv"><span class="hs-identifier">dsGetMetaEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupMetaEnv"><span class="hs-identifier">dsLookupMetaEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsExtendMetaEnv"><span class="hs-identifier">dsExtendMetaEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>        </span><span class="hs-comment">-- Getting and setting pattern match oracle states</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getPmNablas"><span class="hs-identifier">getPmNablas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#updPmNablas"><span class="hs-identifier">updPmNablas</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>        </span><span class="hs-comment">-- Tracking evidence variable coherence</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#addUnspecables"><span class="hs-identifier">addUnspecables</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getUnspecables"><span class="hs-identifier">getUnspecables</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-comment">-- Get COMPLETE sets of a TyCon</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetCompleteMatches"><span class="hs-identifier">dsGetCompleteMatches</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>        </span><span class="hs-comment">-- Warnings and errors</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWarning"><span class="hs-identifier">DsWarning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier">diagnosticDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#errDsCoreExpr"><span class="hs-identifier">errDsCoreExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#failWithDs"><span class="hs-identifier">failWithDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#failDs"><span class="hs-identifier">failDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#discardWarningsDs"><span class="hs-identifier">discardWarningsDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#addMessagesDs"><span class="hs-identifier">addMessagesDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#captureMessagesDs"><span class="hs-identifier">captureMessagesDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>        </span><span class="hs-comment">-- Data types</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier">DsMatchContext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier">EquationInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfoNE"><span class="hs-identifier">EquationInfoNE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#prependPats"><span class="hs-identifier">prependPats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkEqnInfo"><span class="hs-identifier">mkEqnInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#eqnMatchResult"><span class="hs-identifier">eqnMatchResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier">MatchResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier">runMatchResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWrapper"><span class="hs-identifier">DsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#idDsWrapper"><span class="hs-identifier">idDsWrapper</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>        </span><span class="hs-comment">-- Trace injection</span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#pprRuntimeTrace"><span class="hs-identifier">pprRuntimeTrace</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ppr.html"><span class="hs-identifier">GHC.Driver.Ppr</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html"><span class="hs-identifier">GHC.HsToCore.Types</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html"><span class="hs-identifier">GHC.HsToCore.Errors.Types</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html"><span class="hs-identifier">GHC.HsToCore.Pmc.Solver.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier">Nablas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#initNablas"><span class="hs-identifier">initNablas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#unitExpr"><span class="hs-identifier">unitExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier">exprType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.External.html"><span class="hs-identifier">GHC.Unit.External</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html"><span class="hs-identifier">GHC.Unit.Module.ModGuts</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#EvId"><span class="hs-identifier">EvId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html"><span class="hs-identifier">GHC.Types.TypeEnv</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Ppr.html"><span class="hs-identifier">GHC.Types.Name.Ppr</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#mkLitString"><span class="hs-identifier">mkLitString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html"><span class="hs-identifier">GHC.Types.CostCentre.State</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html"><span class="hs-identifier">GHC.Types.CompleteMatch</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html"><span class="hs-identifier">GHC.Types.Unique.DSet</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Env.html#lookupGlobal"><span class="hs-identifier">lookupGlobal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Strict.html"><span class="hs-identifier">GHC.Data.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html"><span class="hs-identifier">GHC.Driver.Env.KnotVars</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/GHC.IO.Unsafe.html"><span class="hs-identifier">GHC.IO.Unsafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeInterleaveIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Data types for the desugarer
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-keyword">data</span><span> </span><span id="DsMatchContext"><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a></span></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="DsMatchContext"><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a></span></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621683118862"><span class="annot"><span class="annottext">ppr :: DsMatchContext -&gt; SDoc
</span><a href="#local-6989586621683118862"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a></span><span> </span><span id="local-6989586621683118864"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621683118864"><span class="hs-identifier hs-var">hs_match</span></a></span></span><span> </span><span id="local-6989586621683118865"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683118865"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683118865"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext (GenLocated SrcSpanAnnN Name) -&gt; SDoc
forall fn. Outputable fn =&gt; HsMatchContext fn -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprMatchContext"><span class="hs-identifier hs-var">pprMatchContext</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
HsMatchContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621683118864"><span class="hs-identifier hs-var">hs_match</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-keyword">data</span><span> </span><span id="EquationInfo"><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a></span></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="EqnMatch"><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnMatch"><span class="hs-identifier hs-var">EqnMatch</span></a></span></span><span>  </span><span class="hs-special">{</span><span> </span><span id="eqn_pat"><span class="annot"><span class="annottext">EquationInfo -&gt; LPat GhcTc
</span><a href="GHC.HsToCore.Monad.html#eqn_pat"><span class="hs-identifier hs-var hs-var">eqn_pat</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-141"></span><span>                </span><span class="hs-comment">-- ^ The first pattern of the equation</span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span>                </span><span class="hs-comment">-- NB: The location info is used to determine whether the</span><span>
</span><span id="line-144"></span><span>                </span><span class="hs-comment">-- pattern is generated or not.</span><span>
</span><span id="line-145"></span><span>                </span><span class="hs-comment">-- This helps us avoid warnings on patterns that GHC elaborated.</span><span>
</span><span id="line-146"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-147"></span><span>                </span><span class="hs-comment">-- NB: We have /already/ applied 'decideBangHood' to this</span><span>
</span><span id="line-148"></span><span>                </span><span class="hs-comment">-- pattern. See Note [decideBangHood] in &quot;GHC.HsToCore.Utils&quot;</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="eqn_rest"><span class="annot"><span class="annottext">EquationInfo -&gt; EquationInfo
</span><a href="GHC.HsToCore.Monad.html#eqn_rest"><span class="hs-identifier hs-var hs-var">eqn_rest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-151"></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ The rest of the equation after its first pattern</span></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="EqnDone"><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnDone"><span class="hs-identifier hs-var">EqnDone</span></a></span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-comment">-- The empty tail of an equation having no more patterns</span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ What to do after match</span></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">type</span><span> </span><span id="EquationInfoNE"><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfoNE"><span class="hs-identifier hs-var">EquationInfoNE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- An EquationInfo which has at least one pattern</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#prependPats"><span class="hs-identifier hs-type">prependPats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span>
</span><span id="line-162"></span><span id="prependPats"><span class="annot"><span class="annottext">prependPats :: [LPat GhcTc] -&gt; EquationInfo -&gt; EquationInfo
</span><a href="GHC.HsToCore.Monad.html#prependPats"><span class="hs-identifier hs-var hs-var">prependPats</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621683118872"><span class="annot"><span class="annottext">EquationInfo
</span><a href="#local-6989586621683118872"><span class="hs-identifier hs-var">eqn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EquationInfo
</span><a href="#local-6989586621683118872"><span class="hs-identifier hs-var">eqn</span></a></span><span>
</span><span id="line-163"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#prependPats"><span class="hs-identifier hs-var">prependPats</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683118873"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683118873"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683118874"><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683118874"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683118875"><span class="annot"><span class="annottext">EquationInfo
</span><a href="#local-6989586621683118875"><span class="hs-identifier hs-var">eqn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnMatch"><span class="hs-identifier hs-type">EqnMatch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eqn_pat :: LPat GhcTc
</span><a href="GHC.HsToCore.Monad.html#eqn_pat"><span class="hs-identifier hs-var">eqn_pat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683118873"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eqn_rest :: EquationInfo
</span><a href="GHC.HsToCore.Monad.html#eqn_rest"><span class="hs-identifier hs-var">eqn_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc] -&gt; EquationInfo -&gt; EquationInfo
</span><a href="GHC.HsToCore.Monad.html#prependPats"><span class="hs-identifier hs-var">prependPats</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683118874"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">EquationInfo
</span><a href="#local-6989586621683118875"><span class="hs-identifier hs-var">eqn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkEqnInfo"><span class="hs-identifier hs-type">mkEqnInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span>
</span><span id="line-166"></span><span id="mkEqnInfo"><span class="annot"><span class="annottext">mkEqnInfo :: [LPat GhcTc] -&gt; MatchResult CoreExpr -&gt; EquationInfo
</span><a href="GHC.HsToCore.Monad.html#mkEqnInfo"><span class="hs-identifier hs-var hs-var">mkEqnInfo</span></a></span></span><span> </span><span id="local-6989586621683118876"><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683118876"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc] -&gt; EquationInfo -&gt; EquationInfo
</span><a href="GHC.HsToCore.Monad.html#prependPats"><span class="hs-identifier hs-var">prependPats</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683118876"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">(EquationInfo -&gt; EquationInfo)
-&gt; (MatchResult CoreExpr -&gt; EquationInfo)
-&gt; MatchResult CoreExpr
-&gt; EquationInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr -&gt; EquationInfo
</span><a href="GHC.HsToCore.Monad.html#EqnDone"><span class="hs-identifier hs-var">EqnDone</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#eqnMatchResult"><span class="hs-identifier hs-type">eqnMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-169"></span><span id="eqnMatchResult"><span class="annot"><span class="annottext">eqnMatchResult :: EquationInfo -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Monad.html#eqnMatchResult"><span class="hs-identifier hs-var hs-var">eqnMatchResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnDone"><span class="hs-identifier hs-type">EqnDone</span></a></span><span> </span><span id="local-6989586621683118878"><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683118878"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><a href="#local-6989586621683118878"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#eqnMatchResult"><span class="hs-identifier hs-var">eqnMatchResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnMatch"><span class="hs-identifier hs-type">EqnMatch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eqn_rest :: EquationInfo -&gt; EquationInfo
</span><a href="GHC.HsToCore.Monad.html#eqn_rest"><span class="hs-identifier hs-var">eqn_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683118879"><span class="annot"><span class="annottext">EquationInfo
</span><a href="#local-6989586621683118879"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EquationInfo -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Monad.html#eqnMatchResult"><span class="hs-identifier hs-var">eqnMatchResult</span></a></span><span> </span><span class="annot"><span class="annottext">EquationInfo
</span><a href="#local-6989586621683118879"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621683118899"><span class="annot"><span class="annottext">ppr :: EquationInfo -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat GhcTc] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">([Pat GhcTc] -&gt; SDoc)
-&gt; (EquationInfo -&gt; [Pat GhcTc]) -&gt; EquationInfo -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EquationInfo -&gt; [Pat GhcTc]
</span><a href="#local-6989586621683118900"><span class="hs-identifier hs-var">allEqnPats</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>      </span><span id="local-6989586621683118900"><span class="annot"><span class="annottext">allEqnPats :: EquationInfo -&gt; [Pat GhcTc]
</span><a href="#local-6989586621683118900"><span class="hs-identifier hs-var hs-var">allEqnPats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnDone"><span class="hs-identifier hs-type">EqnDone</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><a href="#local-6989586621683118900"><span class="hs-identifier hs-var">allEqnPats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnMatch"><span class="hs-identifier hs-type">EqnMatch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eqn_pat :: EquationInfo -&gt; LPat GhcTc
</span><a href="GHC.HsToCore.Monad.html#eqn_pat"><span class="hs-identifier hs-var">eqn_pat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683118901"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683118901"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eqn_rest :: EquationInfo -&gt; EquationInfo
</span><a href="GHC.HsToCore.Monad.html#eqn_rest"><span class="hs-identifier hs-var">eqn_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683118902"><span class="annot"><span class="annottext">EquationInfo
</span><a href="#local-6989586621683118902"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683118901"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc -&gt; [Pat GhcTc] -&gt; [Pat GhcTc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">EquationInfo -&gt; [Pat GhcTc]
</span><a href="#local-6989586621683118900"><span class="hs-identifier hs-var">allEqnPats</span></a></span><span> </span><span class="annot"><span class="annottext">EquationInfo
</span><a href="#local-6989586621683118902"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-keyword">type</span><span> </span><span id="DsWrapper"><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWrapper"><span class="hs-identifier hs-var">DsWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-178"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#idDsWrapper"><span class="hs-identifier hs-type">idDsWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWrapper"><span class="hs-identifier hs-type">DsWrapper</span></a></span><span>
</span><span id="line-179"></span><span id="idDsWrapper"><span class="annot"><span class="annottext">idDsWrapper :: DsWrapper
</span><a href="GHC.HsToCore.Monad.html#idDsWrapper"><span class="hs-identifier hs-var hs-var">idDsWrapper</span></a></span></span><span> </span><span id="local-6989586621683118904"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683118904"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683118904"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- The semantics of (match vs (EqnInfo wrap pats rhs)) is the MatchResult CoreExpr</span><span>
</span><span id="line-182"></span><span class="hs-comment">--      \fail. wrap (case vs of { pats -&gt; rhs fail })</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- where vs are not bound by wrap</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- | This is a value of type a with potentially a CoreExpr-shaped hole in it.</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- This is used to deal with cases where we are potentially handling pattern</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- match failure, and want to later specify how failure is handled.</span><span>
</span><span id="line-188"></span><span class="hs-keyword">data</span><span> </span><span id="MatchResult"><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-var">MatchResult</span></a></span></span><span> </span><span id="local-6989586621683118475"><span class="annot"><a href="#local-6989586621683118475"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-comment">-- | We represent the case where there is no hole without a function from</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-comment">-- 'CoreExpr', like this, because sometimes we have nothing to put in the</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-comment">-- hole and so want to be sure there is in fact no hole.</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MR_Infallible"><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118475"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MR_Fallible"><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118475"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683118908"><span id="local-6989586621683118912"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b)
-&gt; (forall a b. a -&gt; MatchResult b -&gt; MatchResult a)
-&gt; Functor MatchResult
forall a b. a -&gt; MatchResult b -&gt; MatchResult a
forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
fmap :: forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
$c&lt;$ :: forall a b. a -&gt; MatchResult b -&gt; MatchResult a
&lt;$ :: forall a b. a -&gt; MatchResult b -&gt; MatchResult a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- | Product is an &quot;or&quot; on fallibility---the combined match result is infallible</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- only if the left and right argument match results both were.</span><span>
</span><span id="line-198"></span><span class="hs-comment">--</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- This is useful for combining a bunch of alternatives together and then</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- getting the overall fallibility of the entire group. See 'mkDataConCase' for</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- an example.</span><span>
</span><span id="line-202"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683118923"><span id="local-6989586621683118927"><span id="local-6989586621683118930"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621683118935"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; MatchResult a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621683118936"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118936"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsM a -&gt; MatchResult a
forall a. DsM a -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; DsM a
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118936"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span id="local-6989586621683118939"><span class="annot"><span class="annottext">DsM (a -&gt; b)
</span><a href="#local-6989586621683118939"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683118940"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. MatchResult (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
</span><span class="hs-operator hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span id="local-6989586621683118941"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683118941"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsM b -&gt; MatchResult b
forall a. DsM a -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsM (a -&gt; b)
</span><a href="#local-6989586621683118939"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DsM (a -&gt; b) -&gt; DsM a -&gt; DsM b
forall a b.
IOEnv (Env DsGblEnv DsLclEnv) (a -&gt; b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) a
-&gt; IOEnv (Env DsGblEnv DsLclEnv) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683118941"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621683118942"><span class="annot"><span class="annottext">MatchResult (a -&gt; b)
</span><a href="#local-6989586621683118942"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span id="local-6989586621683118943"><span class="annot"><span class="annottext">MatchResult a
</span><a href="#local-6989586621683118943"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM b) -&gt; MatchResult b
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM b) -&gt; MatchResult b)
-&gt; (CoreExpr -&gt; DsM b) -&gt; MatchResult b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683118944"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683118944"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; MatchResult (a -&gt; b) -&gt; DsM (a -&gt; b)
forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var">runMatchResult</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683118944"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult (a -&gt; b)
</span><a href="#local-6989586621683118942"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DsM (a -&gt; b) -&gt; DsM a -&gt; DsM b
forall a b.
IOEnv (Env DsGblEnv DsLclEnv) (a -&gt; b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) a
-&gt; IOEnv (Env DsGblEnv DsLclEnv) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; MatchResult a -&gt; DsM a
forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var">runMatchResult</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683118944"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult a
</span><a href="#local-6989586621683118943"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Given a fail expression to use, and a MatchResult CoreExpr, compute the filled CoreExpr whether</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- the MatchResult CoreExpr was failable or not.</span><span>
</span><span id="line-209"></span><span id="local-6989586621683118482"><span class="annot"><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-type">runMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118482"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118482"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-210"></span><span id="runMatchResult"><span class="annot"><span class="annottext">runMatchResult :: forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var hs-var">runMatchResult</span></a></span></span><span> </span><span id="local-6989586621683118945"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683118945"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span id="local-6989586621683118946"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683118946"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683118946"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-type">MR_Fallible</span></a></span><span> </span><span id="local-6989586621683118947"><span class="annot"><span class="annottext">CoreExpr -&gt; DsM a
</span><a href="#local-6989586621683118947"><span class="hs-identifier hs-var">body_fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM a
</span><a href="#local-6989586621683118947"><span class="hs-identifier hs-var">body_fn</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683118945"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Monad functions
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="hs-comment">-- Compatibility functions</span><span>
</span><span id="line-223"></span><span id="local-6989586621683118484"><span class="annot"><a href="GHC.HsToCore.Monad.html#fixDs"><span class="hs-identifier hs-type">fixDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683118484"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118484"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118484"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-224"></span><span id="fixDs"><span class="annot"><span class="annottext">fixDs :: forall a. (a -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#fixDs"><span class="hs-identifier hs-var hs-var">fixDs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall a env. (a -&gt; IOEnv env a) -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-keyword">type</span><span> </span><span id="DsWarning"><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWarning"><span class="hs-identifier hs-var">DsWarning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>        </span><span class="hs-comment">-- Not quite the same as a WarnMsg, we have an SDoc here</span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-comment">-- and we'll do the name_ppr_ctx stuff later on to turn it</span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-comment">-- into a Doc.</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><span class="hs-comment">-- | Run a 'DsM' action inside the 'TcM' monad.</span></span><span>
</span><span id="line-232"></span><span id="local-6989586621683118488"><span class="annot"><a href="GHC.HsToCore.Monad.html#initDsTc"><span class="hs-identifier hs-type">initDsTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118488"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683118488"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-233"></span><span id="initDsTc"><span class="annot"><span class="annottext">initDsTc :: forall a. DsM a -&gt; TcM (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#initDsTc"><span class="hs-identifier hs-var hs-var">initDsTc</span></a></span></span><span> </span><span id="local-6989586621683118959"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683118959"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683118960"><span class="annot"><a href="#local-6989586621683118960"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-235"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683118962"><span class="annot"><a href="#local-6989586621683118962"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-type">emptyMessages</span></a></span><span>
</span><span id="line-236"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683118966"><span class="annot"><a href="#local-6989586621683118966"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-237"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683118968"><span class="annot"><a href="#local-6989586621683118968"><span class="hs-identifier hs-var">envs</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-type">mkDsEnvsFromTcGbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118966"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118962"><span class="hs-identifier hs-type">msg_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118960"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-238"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683118970"><span class="annot"><a href="#local-6989586621683118970"><span class="hs-identifier hs-var">e_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-type">tryM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>  </span><span class="hs-comment">-- need to tryM so that we don't discard</span><span>
</span><span id="line-239"></span><span>                             </span><span class="hs-comment">-- DsMessages</span><span>
</span><span id="line-240"></span><span>                     </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-type">setEnvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118968"><span class="hs-identifier hs-type">envs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118959"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-241"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683118973"><span class="annot"><a href="#local-6989586621683118973"><span class="hs-identifier hs-var">msgs</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683118962"><span class="hs-identifier hs-type">msg_var</span></a></span><span>
</span><span id="line-242"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683118973"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683118970"><span class="hs-identifier hs-type">e_result</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-243"></span><span>                                        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683118975"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118975"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683118975"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="annot"><span class="hs-comment">-- | Run a 'DsM' action inside the 'IO' monad.</span></span><span>
</span><span id="line-247"></span><span id="local-6989586621683118517"><span class="annot"><a href="GHC.HsToCore.Monad.html#initDs"><span class="hs-identifier hs-type">initDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118517"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683118517"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-248"></span><span id="initDs"><span class="annot"><span class="annottext">initDs :: forall a.
HscEnv -&gt; TcGblEnv -&gt; DsM a -&gt; IO (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#initDs"><span class="hs-identifier hs-var hs-var">initDs</span></a></span></span><span> </span><span id="local-6989586621683118980"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683118980"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683118981"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683118981"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span id="local-6989586621683118982"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683118982"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683118983"><span class="annot"><a href="#local-6989586621683118983"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages DsMessage -&gt; IO (IORef (Messages DsMessage))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683118984"><span class="annot"><a href="#local-6989586621683118984"><span class="hs-identifier hs-var">envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-type">mkDsEnvsFromTcGbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118980"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118983"><span class="hs-identifier hs-type">msg_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118981"><span class="hs-identifier hs-type">tcg_env</span></a></span><span>
</span><span id="line-251"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#runDs"><span class="hs-identifier hs-type">runDs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118980"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118984"><span class="hs-identifier hs-type">envs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118982"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-252"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><span class="hs-comment">-- | Build a set of desugarer environments derived from a 'TcGblEnv'.</span></span><span>
</span><span id="line-255"></span><span id="local-6989586621683118505"><span class="annot"><a href="GHC.HsToCore.Monad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-type">mkDsEnvsFromTcGbl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621683118505"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-256"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-257"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683118505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-258"></span><span id="mkDsEnvsFromTcGbl"><span class="annot"><span class="annottext">mkDsEnvsFromTcGbl :: forall (m :: * -&gt; *).
MonadIO m =&gt;
HscEnv
-&gt; IORef (Messages DsMessage) -&gt; TcGblEnv -&gt; m (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-var hs-var">mkDsEnvsFromTcGbl</span></a></span></span><span> </span><span id="local-6989586621683119000"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119000"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621683119001"><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621683119001"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span id="local-6989586621683119002"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683119002"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119003"><span class="annot"><a href="#local-6989586621683119003"><span class="hs-identifier hs-var">cc_st_var</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef CostCentreState) -&gt; m (IORef CostCentreState)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (IORef CostCentreState) -&gt; m (IORef CostCentreState))
-&gt; IO (IORef CostCentreState) -&gt; m (IORef CostCentreState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CostCentreState -&gt; IO (IORef CostCentreState)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">CostCentreState
</span><a href="GHC.Types.CostCentre.State.html#newCostCentreState"><span class="hs-identifier hs-var">newCostCentreState</span></a></span><span>
</span><span id="line-260"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119005"><span class="annot"><a href="#local-6989586621683119005"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-type">hscEPS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119000"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-261"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683119007"><span class="annot"><a href="#local-6989586621683119007"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119000"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-262"></span><span>             </span><span id="local-6989586621683119009"><span class="annot"><a href="#local-6989586621683119009"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683119002"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-263"></span><span>             </span><span id="local-6989586621683119011"><span class="annot"><a href="#local-6989586621683119011"><span class="hs-identifier hs-var hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683119002"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-264"></span><span>             </span><span id="local-6989586621683119013"><span class="annot"><a href="#local-6989586621683119013"><span class="hs-identifier hs-var hs-var">rdr_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683119002"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-265"></span><span>             </span><span id="local-6989586621683119015"><span class="annot"><a href="#local-6989586621683119015"><span class="hs-identifier hs-var hs-var">fam_inst_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; FamInstEnv
</span><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683119002"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-266"></span><span>             </span><span id="local-6989586621683119017"><span class="annot"><a href="#local-6989586621683119017"><span class="hs-identifier hs-var hs-var">ptc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.DynFlags.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119000"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>             </span><span class="hs-comment">-- re-use existing next_wrapper_num to ensure uniqueness</span><span>
</span><span id="line-268"></span><span>             </span><span id="local-6989586621683119020"><span class="annot"><a href="#local-6989586621683119020"><span class="hs-identifier hs-var hs-var">next_wrapper_num_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (ModuleEnv Int)
</span><a href="GHC.Tc.Types.html#tcg_next_wrapper_num"><span class="hs-identifier hs-var">tcg_next_wrapper_num</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683119002"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119022"><span class="annot"><a href="#local-6989586621683119022"><span class="hs-identifier hs-var">ds_complete_matches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-271"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">unsafeInterleaveIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-272"></span><span>             </span><span class="hs-comment">-- This call to 'unsafeInterleaveIO' ensures we only do this work</span><span>
</span><span id="line-273"></span><span>             </span><span class="hs-comment">-- when we need to look at the COMPLETE pragmas, avoiding doing work</span><span>
</span><span id="line-274"></span><span>             </span><span class="hs-comment">-- when we don't need them.</span><span>
</span><span id="line-275"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-276"></span><span>             </span><span class="hs-comment">-- Relevant test case: MultiLayerModulesTH_Make, which regresses</span><span>
</span><span id="line-277"></span><span>             </span><span class="hs-comment">-- in allocations by ~5% if we don't do this.</span><span>
</span><span id="line-278"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#lookupCompleteMatch"><span class="hs-identifier hs-type">lookupCompleteMatch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119011"><span class="hs-identifier hs-type">type_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119000"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-279"></span><span>             </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#localAndImportedCompleteMatches"><span class="hs-identifier hs-type">localAndImportedCompleteMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#tcg_complete_matches"><span class="hs-identifier hs-var">tcg_complete_matches</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119002"><span class="hs-identifier hs-type">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683119000"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119005"><span class="hs-identifier hs-type">eps</span></a></span><span>
</span><span id="line-280"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkDsEnvs"><span class="hs-identifier hs-type">mkDsEnvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119007"><span class="hs-identifier hs-type">unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119009"><span class="hs-identifier hs-type">this_mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119013"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119011"><span class="hs-identifier hs-type">type_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119015"><span class="hs-identifier hs-type">fam_inst_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119017"><span class="hs-identifier hs-type">ptc</span></a></span><span>
</span><span id="line-281"></span><span>                           </span><span class="annot"><a href="#local-6989586621683119001"><span class="hs-identifier hs-type">msg_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119003"><span class="hs-identifier hs-type">cc_st_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119020"><span class="hs-identifier hs-type">next_wrapper_num_var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119022"><span class="hs-identifier hs-type">ds_complete_matches</span></a></span><span>
</span><span id="line-282"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | We have in hand the `CompleteMatches` for the module, but when</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- doing pattern-match overlap checking we want the `ConLike` for each</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- data constructor, not just its `Name`.  This function makes the</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- transition.</span><span>
</span><span id="line-288"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#lookupCompleteMatch"><span class="hs-identifier hs-type">lookupCompleteMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#DsCompleteMatch"><span class="hs-identifier hs-type">DsCompleteMatch</span></a></span><span>
</span><span id="line-289"></span><span id="lookupCompleteMatch"><span class="annot"><span class="annottext">lookupCompleteMatch :: TypeEnv -&gt; HscEnv -&gt; CompleteMatch -&gt; IO DsCompleteMatch
</span><a href="GHC.HsToCore.Monad.html#lookupCompleteMatch"><span class="hs-identifier hs-var hs-var">lookupCompleteMatch</span></a></span></span><span> </span><span id="local-6989586621683119029"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683119029"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621683119030"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119030"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmConLikes :: forall con. CompleteMatchX con -&gt; UniqDSet con
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119033"><span class="annot"><span class="annottext">UniqDSet Name
</span><a href="#local-6989586621683119033"><span class="hs-identifier hs-var">nms</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cmResultTyCon :: forall con. CompleteMatchX con -&gt; Maybe Name
</span><a href="GHC.Types.CompleteMatch.html#cmResultTyCon"><span class="hs-identifier hs-var">cmResultTyCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119035"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621683119035"><span class="hs-identifier hs-var">mb_tc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119036"><span class="annot"><a href="#local-6989586621683119036"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IO ConLike) -&gt; UniqDSet Name -&gt; IO (UniqDSet ConLike)
forall (m :: * -&gt; *) b a.
(Monad m, Uniquable b) =&gt;
(a -&gt; m b) -&gt; UniqDSet a -&gt; m (UniqDSet b)
</span><a href="GHC.Types.Unique.DSet.html#mapMUniqDSet"><span class="hs-identifier hs-var">mapMUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IO ConLike
</span><a href="#local-6989586621683119038"><span class="hs-identifier hs-var">lookup_conLike</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet Name
</span><a href="#local-6989586621683119033"><span class="hs-identifier hs-var">nms</span></a></span><span>
</span><span id="line-291"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119036"><span class="hs-identifier hs-type">cons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#cmResultTyCon"><span class="hs-identifier hs-var">cmResultTyCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119035"><span class="hs-identifier hs-type">mb_tc</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="#local-6989586621683119038"><span class="hs-identifier hs-type">lookup_conLike</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621683119038"><span class="annot"><span class="annottext">lookup_conLike :: Name -&gt; IO ConLike
</span><a href="#local-6989586621683119038"><span class="hs-identifier hs-var hs-var">lookup_conLike</span></a></span></span><span> </span><span id="local-6989586621683119039"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119039"><span class="hs-identifier hs-var">nm</span></a></span></span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683119040"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683119040"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyThing
</span><a href="GHC.Types.Name.html#wiredInNameTyThing_maybe"><span class="hs-identifier hs-var">wiredInNameTyThing_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119039"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; IO ConLike
</span><a href="#local-6989586621683119042"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683119040"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683119043"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683119043"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; Name -&gt; Maybe TyThing
</span><a href="GHC.Types.TypeEnv.html#lookupTypeEnv"><span class="hs-identifier hs-var">lookupTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683119029"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119039"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; IO ConLike
</span><a href="#local-6989586621683119042"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683119043"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; IO ConLike
</span><a href="#local-6989586621683119042"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; IO ConLike) -&gt; IO TyThing -&gt; IO ConLike
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Name -&gt; IO TyThing
</span><a href="GHC.Tc.Utils.Env.html#lookupGlobal"><span class="hs-identifier hs-var">lookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119030"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119039"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><a href="#local-6989586621683119042"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-303"></span><span>        </span><span id="local-6989586621683119042"><span class="annot"><span class="annottext">go :: TyThing -&gt; IO ConLike
</span><a href="#local-6989586621683119042"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span id="local-6989586621683119047"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683119047"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; IO ConLike
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683119047"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><a href="#local-6989586621683119042"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621683119048"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683119048"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO ConLike
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookup_conLike not a ConLike&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119039"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621683119048"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span id="local-6989586621683118519"><span class="annot"><a href="GHC.HsToCore.Monad.html#runDs"><span class="hs-identifier hs-type">runDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118519"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683118519"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-307"></span><span id="runDs"><span class="annot"><span class="annottext">runDs :: forall a.
HscEnv
-&gt; (DsGblEnv, DsLclEnv)
-&gt; DsM a
-&gt; IO (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#runDs"><span class="hs-identifier hs-var hs-var">runDs</span></a></span></span><span> </span><span id="local-6989586621683119056"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119056"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683119057"><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621683119057"><span class="hs-identifier hs-var">ds_gbl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683119058"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119058"><span class="hs-identifier hs-var">ds_lcl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683119059"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119059"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119060"><span class="annot"><a href="#local-6989586621683119060"><span class="hs-identifier hs-var">res</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char
-&gt; HscEnv
-&gt; DsGblEnv
-&gt; DsLclEnv
-&gt; TcRnIf DsGblEnv DsLclEnv (Either IOEnvFailure a)
-&gt; IO (Either IOEnvFailure a)
forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'d'</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119056"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621683119057"><span class="hs-identifier hs-var">ds_gbl</span></a></span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119058"><span class="hs-identifier hs-var">ds_lcl</span></a></span><span>
</span><span id="line-309"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsM a -&gt; TcRnIf DsGblEnv DsLclEnv (Either IOEnvFailure a)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119059"><span class="hs-identifier hs-var">thing_inside</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119062"><span class="annot"><a href="#local-6989586621683119062"><span class="hs-identifier hs-var">msgs</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119057"><span class="hs-identifier hs-type">ds_gbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683119064"><span class="annot"><a href="#local-6989586621683119064"><span class="hs-identifier hs-var hs-var">final_res</span></a></span></span><span>
</span><span id="line-312"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Messages DsMessage -&gt; Bool
forall e. Diagnostic e =&gt; Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621683119062"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-313"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621683119066"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683119066"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621683119060"><span class="hs-identifier hs-var">res</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683119066"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-314"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initDs&quot;</span></span><span>
</span><span id="line-315"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683119062"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683119064"><span class="hs-identifier hs-type">final_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="annot"><span class="hs-comment">-- | Run a 'DsM' action in the context of an existing 'ModGuts'</span></span><span>
</span><span id="line-319"></span><span id="local-6989586621683118556"><span class="annot"><a href="GHC.HsToCore.Monad.html#initDsWithModGuts"><span class="hs-identifier hs-type">initDsWithModGuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118556"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621683118556"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-320"></span><span id="initDsWithModGuts"><span class="annot"><span class="annottext">initDsWithModGuts :: forall a.
HscEnv -&gt; ModGuts -&gt; DsM a -&gt; IO (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#initDsWithModGuts"><span class="hs-identifier hs-var hs-var">initDsWithModGuts</span></a></span></span><span> </span><span id="local-6989586621683119079"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119079"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_module :: ModGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119081"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119081"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_binds :: ModGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119083"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683119083"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-321"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_tcs :: ModGuts -&gt; [TyCon]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_tcs"><span class="hs-identifier hs-var">mg_tcs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119085"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683119085"><span class="hs-identifier hs-var">tycons</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_fam_insts :: ModGuts -&gt; [FamInst]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_fam_insts"><span class="hs-identifier hs-var">mg_fam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119087"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683119087"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span>
</span><span id="line-322"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_patsyns :: ModGuts -&gt; [PatSyn]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_patsyns"><span class="hs-identifier hs-var">mg_patsyns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119089"><span class="annot"><span class="annottext">[PatSyn]
</span><a href="#local-6989586621683119089"><span class="hs-identifier hs-var">patsyns</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_rdr_env :: ModGuts -&gt; GlobalRdrEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_rdr_env"><span class="hs-identifier hs-var">mg_rdr_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119091"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683119091"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span>
</span><span id="line-323"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_fam_inst_env :: ModGuts -&gt; FamInstEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_fam_inst_env"><span class="hs-identifier hs-var">mg_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119093"><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621683119093"><span class="hs-identifier hs-var">fam_inst_env</span></a></span></span><span>
</span><span id="line-324"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_complete_matches :: ModGuts -&gt; [CompleteMatch]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_complete_matches"><span class="hs-identifier hs-var">mg_complete_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119095"><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621683119095"><span class="hs-identifier hs-var">local_complete_matches</span></a></span></span><span>
</span><span id="line-325"></span><span>                          </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683119096"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119096"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119097"><span class="annot"><a href="#local-6989586621683119097"><span class="hs-identifier hs-var">cc_st_var</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CostCentreState -&gt; IO (IORef CostCentreState)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">CostCentreState
</span><a href="GHC.Types.CostCentre.State.html#newCostCentreState"><span class="hs-identifier hs-var">newCostCentreState</span></a></span><span>
</span><span id="line-327"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119098"><span class="annot"><a href="#local-6989586621683119098"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Env.html#emptyModuleEnv"><span class="hs-identifier hs-type">emptyModuleEnv</span></a></span><span>
</span><span id="line-328"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119100"><span class="annot"><a href="#local-6989586621683119100"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newIORef</span></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-type">emptyMessages</span></a></span><span>
</span><span id="line-329"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119101"><span class="annot"><a href="#local-6989586621683119101"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-type">hscEPS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119079"><span class="hs-identifier hs-type">hsc_env</span></a></span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683119102"><span class="annot"><a href="#local-6989586621683119102"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119079"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-331"></span><span>             </span><span id="local-6989586621683119103"><span class="annot"><a href="#local-6989586621683119103"><span class="hs-identifier hs-var hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EvVar] -&gt; [TyCon] -&gt; [PatSyn] -&gt; [FamInst] -&gt; TypeEnv
</span><a href="GHC.Types.TypeEnv.html#typeEnvFromEntities"><span class="hs-identifier hs-var">typeEnvFromEntities</span></a></span><span> </span><span class="annot"><span class="annottext">[EvVar]
</span><a href="#local-6989586621683119105"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621683119085"><span class="hs-identifier hs-var">tycons</span></a></span><span> </span><span class="annot"><span class="annottext">[PatSyn]
</span><a href="#local-6989586621683119089"><span class="hs-identifier hs-var">patsyns</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621683119087"><span class="hs-identifier hs-var">fam_insts</span></a></span><span>
</span><span id="line-332"></span><span>             </span><span id="local-6989586621683119106"><span class="annot"><a href="#local-6989586621683119106"><span class="hs-identifier hs-var hs-var">ptc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.DynFlags.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621683119079"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>             </span><span id="local-6989586621683119107"><span class="annot"><a href="#local-6989586621683119107"><span class="hs-identifier hs-var hs-var">bindsToIds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621683119109"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683119109"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683119109"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span>             </span><span class="annot"><a href="#local-6989586621683119107"><span class="hs-identifier hs-var">bindsToIds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span>    </span><span id="local-6989586621683119111"><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621683119111"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Expr a) -&gt; a) -&gt; [(a, Expr a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, Expr a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621683119111"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-335"></span><span>             </span><span id="local-6989586621683119105"><span class="annot"><a href="#local-6989586621683119105"><span class="hs-identifier hs-var hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bind EvVar -&gt; [EvVar]) -&gt; CoreProgram -&gt; [EvVar]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Bind EvVar -&gt; [EvVar]
forall {a}. Bind a -&gt; [a]
</span><a href="#local-6989586621683119107"><span class="hs-identifier hs-var">bindsToIds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621683119083"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-336"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119114"><span class="annot"><a href="#local-6989586621683119114"><span class="hs-identifier hs-var">ds_complete_matches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#lookupCompleteMatch"><span class="hs-identifier hs-type">lookupCompleteMatch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119103"><span class="hs-identifier hs-type">type_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119079"><span class="hs-identifier hs-type">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-337"></span><span>            </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#localAndImportedCompleteMatches"><span class="hs-identifier hs-type">localAndImportedCompleteMatches</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119095"><span class="hs-identifier hs-type">local_complete_matches</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119079"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119101"><span class="hs-identifier hs-type">eps</span></a></span><span>
</span><span id="line-338"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-339"></span><span>             </span><span id="local-6989586621683119115"><span class="annot"><a href="#local-6989586621683119115"><span class="hs-identifier hs-var hs-var">envs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv
-&gt; Module
-&gt; GlobalRdrEnv
-&gt; TypeEnv
-&gt; FamInstEnv
-&gt; PromotionTickContext
-&gt; IORef (Messages DsMessage)
-&gt; IORef CostCentreState
-&gt; TcRef (ModuleEnv Int)
-&gt; [DsCompleteMatch]
-&gt; (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvs"><span class="hs-identifier hs-var">mkDsEnvs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683119102"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119081"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683119091"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683119103"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-340"></span><span>                              </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621683119093"><span class="hs-identifier hs-var">fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621683119106"><span class="hs-identifier hs-var">ptc</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621683119100"><span class="hs-identifier hs-var">msg_var</span></a></span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621683119097"><span class="hs-identifier hs-var">cc_st_var</span></a></span><span>
</span><span id="line-341"></span><span>                              </span><span class="annot"><span class="annottext">TcRef (ModuleEnv Int)
</span><a href="#local-6989586621683119098"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span><span> </span><span class="annot"><span class="annottext">[DsCompleteMatch]
</span><a href="#local-6989586621683119114"><span class="hs-identifier hs-var">ds_complete_matches</span></a></span><span>
</span><span id="line-342"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#runDs"><span class="hs-identifier hs-type">runDs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119079"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119115"><span class="hs-identifier hs-type">envs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119096"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-343"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span id="local-6989586621683118573"><span class="annot"><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier hs-type">initTcDsForSolver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118573"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118573"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-346"></span><span class="hs-comment">-- Spin up a TcM context so that we can run the constraint solver</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- Returns any error messages generated by the constraint solver</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- and (Just res) if no error happened; Nothing if an error happened</span><span>
</span><span id="line-349"></span><span class="hs-comment">--</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- Simon says: I'm not very happy about this.  We spin up a complete TcM monad</span><span>
</span><span id="line-351"></span><span class="hs-comment">--             only to immediately refine it to a TcS monad.</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- Better perhaps to make TcS into its own monad, rather than building on TcS</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- But that may in turn interact with plugins</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span id="initTcDsForSolver"><span class="annot"><span class="annottext">initTcDsForSolver :: forall a. TcM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier hs-var hs-var">initTcDsForSolver</span></a></span></span><span> </span><span id="local-6989586621683119128"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621683119128"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683119129"><span class="annot"><a href="#local-6989586621683119129"><span class="hs-identifier hs-var">gbl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683119130"><span class="annot"><a href="#local-6989586621683119130"><span class="hs-identifier hs-var">lcl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv (DsGblEnv, DsLclEnv)
forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a></span><span>
</span><span id="line-357"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119132"><span class="annot"><a href="#local-6989586621683119132"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>         </span><span class="hs-comment">-- The DsGblEnv is used to inform the typechecker's solver of a few</span><span>
</span><span id="line-360"></span><span>         </span><span class="hs-comment">-- key pieces of information:</span><span>
</span><span id="line-361"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-362"></span><span>         </span><span class="hs-comment">--  - ds_fam_inst_env tells it how to reduce type families,</span><span>
</span><span id="line-363"></span><span>         </span><span class="hs-comment">--  - ds_gbl_rdr_env  tells it which newtypes it can unwrap.</span><span>
</span><span id="line-364"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_mod"><span class="hs-identifier hs-var">ds_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119135"><span class="annot"><a href="#local-6989586621683119135"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-365"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_fam_inst_env"><span class="hs-identifier hs-var">ds_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119137"><span class="annot"><a href="#local-6989586621683119137"><span class="hs-identifier hs-var">fam_inst_env</span></a></span></span><span>
</span><span id="line-366"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_gbl_rdr_env"><span class="hs-identifier hs-var">ds_gbl_rdr_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119139"><span class="annot"><a href="#local-6989586621683119139"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span>
</span><span id="line-367"></span><span>                      </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119129"><span class="hs-identifier hs-type">gbl</span></a></span><span>
</span><span id="line-368"></span><span>             </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_loc"><span class="hs-identifier hs-var">dsl_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683119142"><span class="annot"><a href="#local-6989586621683119142"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119130"><span class="hs-identifier hs-type">lcl</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621683119143"><span class="annot"><a href="#local-6989586621683119143"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683119144"><span class="annot"><a href="#local-6989586621683119144"><span class="hs-identifier hs-var">mb_ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-type">initTc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119132"><span class="hs-identifier hs-type">hsc_env</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-type">HsSrcFile</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="#local-6989586621683119135"><span class="hs-identifier hs-type">mod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119142"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-371"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683119148"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683119148"><span class="hs-identifier hs-var">tc_gbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621683119148"><span class="hs-identifier hs-var">tc_gbl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119137"><span class="hs-identifier hs-type">fam_inst_env</span></a></span><span>
</span><span id="line-372"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119139"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-373"></span><span>         </span><span class="annot"><a href="#local-6989586621683119128"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-374"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683119144"><span class="hs-identifier hs-type">mb_ret</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-375"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683119149"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683119149"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683119149"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-376"></span><span>           </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initTcDsForSolver&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bag (MsgEnvelope TcRnMessage) -&gt; [SDoc]
forall e. Diagnostic e =&gt; Bag (MsgEnvelope e) -&gt; [SDoc]
</span><a href="GHC.Utils.Error.html#pprMsgEnvelopeBagWithLocDefault"><span class="hs-identifier hs-var">pprMsgEnvelopeBagWithLocDefault</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; Bag (MsgEnvelope TcRnMessage)
forall e. Diagnostic e =&gt; Messages e -&gt; Bag (MsgEnvelope e)
</span><a href="GHC.Types.Error.html#getErrorMessages"><span class="hs-identifier hs-var">getErrorMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621683119143"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkDsEnvs"><span class="hs-identifier hs-type">mkDsEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span>
</span><span id="line-379"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#PromotionTickContext"><span class="hs-identifier hs-type">PromotionTickContext</span></a></span><span>
</span><span id="line-380"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreState"><span class="hs-identifier hs-type">CostCentreState</span></a></span><span>
</span><span id="line-381"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Env.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#DsCompleteMatches"><span class="hs-identifier hs-type">DsCompleteMatches</span></a></span><span>
</span><span id="line-382"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span id="mkDsEnvs"><span class="annot"><span class="annottext">mkDsEnvs :: UnitEnv
-&gt; Module
-&gt; GlobalRdrEnv
-&gt; TypeEnv
-&gt; FamInstEnv
-&gt; PromotionTickContext
-&gt; IORef (Messages DsMessage)
-&gt; IORef CostCentreState
-&gt; TcRef (ModuleEnv Int)
-&gt; [DsCompleteMatch]
-&gt; (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvs"><span class="hs-identifier hs-var hs-var">mkDsEnvs</span></a></span></span><span> </span><span id="local-6989586621683119154"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683119154"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621683119155"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119155"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621683119156"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683119156"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621683119157"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683119157"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621683119158"><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621683119158"><span class="hs-identifier hs-var">fam_inst_env</span></a></span></span><span> </span><span id="local-6989586621683119159"><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621683119159"><span class="hs-identifier hs-var">ptc</span></a></span></span><span> </span><span id="local-6989586621683119160"><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621683119160"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span id="local-6989586621683119161"><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621683119161"><span class="hs-identifier hs-var">cc_st_var</span></a></span></span><span>
</span><span id="line-384"></span><span>         </span><span id="local-6989586621683119162"><span class="annot"><span class="annottext">TcRef (ModuleEnv Int)
</span><a href="#local-6989586621683119162"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span></span><span> </span><span id="local-6989586621683119163"><span class="annot"><span class="annottext">[DsCompleteMatch]
</span><a href="#local-6989586621683119163"><span class="hs-identifier hs-var">complete_matches</span></a></span></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683119164"><span class="annot"><span class="annottext">if_genv :: IfGblEnv
</span><a href="#local-6989586621683119164"><span class="hs-identifier hs-var hs-var">if_genv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkDsEnvs&quot;</span></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-comment">-- Failing tests here are `ghci` and `T11985` if you get this wrong.</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-comment">-- this is very very &quot;at a distance&quot; because the reason for this check is that the type_env in interactive</span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-comment">-- mode is the smushed together of all the interactive modules.</span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-comment">-- See Note [Why is KnotVars not a ModuleEnv]</span><span>
</span><span id="line-390"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">if_rec_types :: KnotVars (IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module]
-&gt; (Module -&gt; Maybe (IfG TypeEnv)) -&gt; KnotVars (IfG TypeEnv)
forall a. [Module] -&gt; (Module -&gt; Maybe a) -&gt; KnotVars a
</span><a href="GHC.Driver.Env.KnotVars.html#KnotVars"><span class="hs-identifier hs-var">KnotVars</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119155"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683119170"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119170"><span class="hs-identifier hs-var">that_mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119170"><span class="hs-identifier hs-var">that_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119155"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier hs-var">isInteractiveModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119155"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-391"></span><span>                                                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IfG TypeEnv -&gt; Maybe (IfG TypeEnv)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeEnv -&gt; IfG TypeEnv
forall a. a -&gt; IOEnv (Env IfGblEnv ()) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621683119157"><span class="hs-identifier hs-var">type_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>                                                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (IfG TypeEnv)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-393"></span><span>        </span><span id="local-6989586621683119173"><span class="annot"><span class="annottext">if_lenv :: IfLclEnv
</span><a href="#local-6989586621683119173"><span class="hs-identifier hs-var hs-var">if_lenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-var">mkIfLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119155"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC error in desugarer lookup in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119155"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>                             </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-395"></span><span>        </span><span id="local-6989586621683119176"><span class="annot"><span class="annottext">real_span :: RealSrcSpan
</span><a href="#local-6989586621683119176"><span class="hs-identifier hs-var hs-var">real_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcLoc -&gt; RealSrcSpan
</span><a href="GHC.Types.SrcLoc.html#realSrcLocSpan"><span class="hs-identifier hs-var">realSrcLocSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; FastString
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119155"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>        </span><span id="local-6989586621683119181"><span class="annot"><span class="annottext">gbl_env :: DsGblEnv
</span><a href="#local-6989586621683119181"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ds_mod :: Module
</span><a href="GHC.HsToCore.Types.html#ds_mod"><span class="hs-identifier hs-var">ds_mod</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621683119155"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-397"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_fam_inst_env :: FamInstEnv
</span><a href="GHC.HsToCore.Types.html#ds_fam_inst_env"><span class="hs-identifier hs-var">ds_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621683119158"><span class="hs-identifier hs-var">fam_inst_env</span></a></span><span>
</span><span id="line-398"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_gbl_rdr_env :: GlobalRdrEnv
</span><a href="GHC.HsToCore.Types.html#ds_gbl_rdr_env"><span class="hs-identifier hs-var">ds_gbl_rdr_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683119156"><span class="hs-identifier hs-var">rdr_env</span></a></span><span>
</span><span id="line-399"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_if_env :: (IfGblEnv, IfLclEnv)
</span><a href="GHC.HsToCore.Types.html#ds_if_env"><span class="hs-identifier hs-var">ds_if_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IfGblEnv
</span><a href="#local-6989586621683119164"><span class="hs-identifier hs-var">if_genv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621683119173"><span class="hs-identifier hs-var">if_lenv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_name_ppr_ctx :: NamePprCtx
</span><a href="GHC.HsToCore.Types.html#ds_name_ppr_ctx"><span class="hs-identifier hs-var">ds_name_ppr_ctx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PromotionTickContext -&gt; UnitEnv -&gt; GlobalRdrEnv -&gt; NamePprCtx
forall info.
Outputable info =&gt;
PromotionTickContext -&gt; UnitEnv -&gt; GlobalRdrEnvX info -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#mkNamePprCtx"><span class="hs-identifier hs-var">mkNamePprCtx</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621683119159"><span class="hs-identifier hs-var">ptc</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621683119154"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621683119156"><span class="hs-identifier hs-var">rdr_env</span></a></span><span>
</span><span id="line-401"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_msgs :: IORef (Messages DsMessage)
</span><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621683119160"><span class="hs-identifier hs-var">msg_var</span></a></span><span>
</span><span id="line-402"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_complete_matches :: [DsCompleteMatch]
</span><a href="GHC.HsToCore.Types.html#ds_complete_matches"><span class="hs-identifier hs-var">ds_complete_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DsCompleteMatch]
</span><a href="#local-6989586621683119163"><span class="hs-identifier hs-var">complete_matches</span></a></span><span>
</span><span id="line-403"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_cc_st :: IORef CostCentreState
</span><a href="GHC.HsToCore.Types.html#ds_cc_st"><span class="hs-identifier hs-var">ds_cc_st</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621683119161"><span class="hs-identifier hs-var">cc_st_var</span></a></span><span>
</span><span id="line-404"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_next_wrapper_num :: TcRef (ModuleEnv Int)
</span><a href="GHC.HsToCore.Types.html#ds_next_wrapper_num"><span class="hs-identifier hs-var">ds_next_wrapper_num</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef (ModuleEnv Int)
</span><a href="#local-6989586621683119162"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span><span>
</span><span id="line-405"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-406"></span><span>        </span><span id="local-6989586621683119188"><span class="annot"><span class="annottext">lcl_env :: DsLclEnv
</span><a href="#local-6989586621683119188"><span class="hs-identifier hs-var hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsl_meta :: DsMetaEnv
</span><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsMetaEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span>
</span><span id="line-407"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsl_loc :: RealSrcSpan
</span><a href="GHC.HsToCore.Types.html#dsl_loc"><span class="hs-identifier hs-var">dsl_loc</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621683119176"><span class="hs-identifier hs-var">real_span</span></a></span><span>
</span><span id="line-408"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsl_nablas :: Nablas
</span><a href="GHC.HsToCore.Types.html#dsl_nablas"><span class="hs-identifier hs-var">dsl_nablas</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nablas
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#initNablas"><span class="hs-identifier hs-var">initNablas</span></a></span><span>
</span><span id="line-409"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsl_unspecables :: Set EvVar
</span><a href="GHC.HsToCore.Types.html#dsl_unspecables"><span class="hs-identifier hs-var">dsl_unspecables</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set EvVar
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-410"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621683119181"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119188"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Operations in the monad
*                                                                      *
************************************************************************

And all this mysterious stuff is so we can occasionally reach out and
grab one or more names.  @newLocalDs@ isn't exported---exported
functions are defined with it.  The difference in name-strings makes
it easier to read debugging output.

-}</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-comment">-- Make a new Id with the same print name, but different type, and new unique</span><span>
</span><span id="line-429"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newUniqueId"><span class="hs-identifier hs-type">newUniqueId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-430"></span><span id="newUniqueId"><span class="annot"><span class="annottext">newUniqueId :: EvVar -&gt; Mult -&gt; Mult -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newUniqueId"><span class="hs-identifier hs-var hs-var">newUniqueId</span></a></span></span><span> </span><span id="local-6989586621683119195"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683119195"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM EvVar
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m EvVar
</span><a href="GHC.Types.Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier hs-var">mkSysLocalOrCoVarM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683119195"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#duplicateLocalDs"><span class="hs-identifier hs-type">duplicateLocalDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-433"></span><span id="duplicateLocalDs"><span class="annot"><span class="annottext">duplicateLocalDs :: EvVar -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#duplicateLocalDs"><span class="hs-identifier hs-var hs-var">duplicateLocalDs</span></a></span></span><span> </span><span id="local-6989586621683119200"><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683119200"><span class="hs-identifier hs-var">old_local</span></a></span></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119201"><span class="annot"><a href="#local-6989586621683119201"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-435"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#setIdUnique"><span class="hs-identifier hs-type">setIdUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119200"><span class="hs-identifier hs-type">old_local</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119201"><span class="hs-identifier hs-type">uniq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newPredVarDs"><span class="hs-identifier hs-type">newPredVarDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-438"></span><span id="newPredVarDs"><span class="annot"><span class="annottext">newPredVarDs :: Mult -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newPredVarDs"><span class="hs-identifier hs-var hs-var">newPredVarDs</span></a></span></span><span>
</span><span id="line-439"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM EvVar
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m EvVar
</span><a href="GHC.Types.Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier hs-var">mkSysLocalOrCoVarM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span>  </span><span class="hs-comment">-- like newSysLocalDs, but we allow covars</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-type">newSysLocalMDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newFailLocalMDs"><span class="hs-identifier hs-type">newFailLocalMDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-442"></span><span class="hs-comment">-- Implicitly have ManyTy multiplicity, hence the &quot;M&quot;</span><span>
</span><span id="line-443"></span><span id="newSysLocalMDs"><span class="annot"><span class="annottext">newSysLocalMDs :: Mult -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-var hs-var">newSysLocalMDs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM EvVar
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m EvVar
</span><a href="GHC.Types.Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds&quot;</span></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span>
</span><span id="line-444"></span><span id="newFailLocalMDs"><span class="annot"><span class="annottext">newFailLocalMDs :: Mult -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newFailLocalMDs"><span class="hs-identifier hs-var hs-var">newFailLocalMDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM EvVar
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m EvVar
</span><a href="GHC.Types.Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fail&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalsMDs"><span class="hs-identifier hs-type">newSysLocalsMDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-447"></span><span id="newSysLocalsMDs"><span class="annot"><span class="annottext">newSysLocalsMDs :: [Mult] -&gt; DsM [EvVar]
</span><a href="GHC.HsToCore.Monad.html#newSysLocalsMDs"><span class="hs-identifier hs-var hs-var">newSysLocalsMDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; DsM EvVar) -&gt; [Mult] -&gt; DsM [EvVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newSysLocalMDs"><span class="hs-identifier hs-var">newSysLocalMDs</span></a></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-450"></span><span id="newSysLocalDs"><span class="annot"><span class="annottext">newSysLocalDs :: Scaled Mult -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var hs-var">newSysLocalDs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621683119209"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683119209"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621683119210"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683119210"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM EvVar
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m EvVar
</span><a href="GHC.Types.Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683119209"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621683119210"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier hs-type">newSysLocalsDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-453"></span><span id="newSysLocalsDs"><span class="annot"><span class="annottext">newSysLocalsDs :: [Scaled Mult] -&gt; DsM [EvVar]
</span><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier hs-var hs-var">newSysLocalsDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled Mult -&gt; DsM EvVar) -&gt; [Scaled Mult] -&gt; DsM [EvVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Scaled Mult -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="hs-comment">{-
We can also reach out and either set/grab location information from
the @SrcSpan@ being carried around.
-}</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getGhcModeDs"><span class="hs-identifier hs-type">getGhcModeDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#GhcMode"><span class="hs-identifier hs-type">GhcMode</span></a></span><span>
</span><span id="line-461"></span><span id="getGhcModeDs"><span class="annot"><span class="annottext">getGhcModeDs :: DsM GhcMode
</span><a href="GHC.HsToCore.Monad.html#getGhcModeDs"><span class="hs-identifier hs-var hs-var">getGhcModeDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
-&gt; (DynFlags -&gt; DsM GhcMode) -&gt; DsM GhcMode
forall a b.
IOEnv (Env DsGblEnv DsLclEnv) a
-&gt; (a -&gt; IOEnv (Env DsGblEnv DsLclEnv) b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">GhcMode -&gt; DsM GhcMode
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(GhcMode -&gt; DsM GhcMode)
-&gt; (DynFlags -&gt; GhcMode) -&gt; DynFlags -&gt; DsM GhcMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcMode
</span><a href="GHC.Driver.DynFlags.html#ghcMode"><span class="hs-identifier hs-var">ghcMode</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="annot"><span class="hs-comment">-- | Get the current pattern match oracle state. See 'dsl_nablas'.</span></span><span>
</span><span id="line-464"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getPmNablas"><span class="hs-identifier hs-type">getPmNablas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span>
</span><span id="line-465"></span><span id="getPmNablas"><span class="annot"><span class="annottext">getPmNablas :: DsM Nablas
</span><a href="GHC.HsToCore.Monad.html#getPmNablas"><span class="hs-identifier hs-var hs-var">getPmNablas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119213"><span class="annot"><a href="#local-6989586621683119213"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_nablas"><span class="hs-identifier hs-var">dsl_nablas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119213"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-comment">-- | Set the pattern match oracle state within the scope of the given action.</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- See 'dsl_nablas'.</span><span>
</span><span id="line-469"></span><span id="local-6989586621683118624"><span class="annot"><a href="GHC.HsToCore.Monad.html#updPmNablas"><span class="hs-identifier hs-type">updPmNablas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118624"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118624"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-470"></span><span id="updPmNablas"><span class="annot"><span class="annottext">updPmNablas :: forall a. Nablas -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#updPmNablas"><span class="hs-identifier hs-var hs-var">updPmNablas</span></a></span></span><span> </span><span id="local-6989586621683119215"><span class="annot"><span class="annottext">Nablas
</span><a href="#local-6989586621683119215"><span class="hs-identifier hs-var">nablas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsLclEnv -&gt; DsLclEnv)
-&gt; TcRnIf DsGblEnv DsLclEnv a -&gt; TcRnIf DsGblEnv DsLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683119217"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119217"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119217"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_nablas"><span class="hs-identifier hs-var">dsl_nablas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119215"><span class="hs-identifier hs-type">nablas</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span id="local-6989586621683118629"><span class="annot"><a href="GHC.HsToCore.Monad.html#addUnspecables"><span class="hs-identifier hs-type">addUnspecables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvId"><span class="hs-identifier hs-type">EvId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118629"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118629"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-473"></span><span id="addUnspecables"><span class="annot"><span class="annottext">addUnspecables :: forall a. Set EvVar -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#addUnspecables"><span class="hs-identifier hs-var hs-var">addUnspecables</span></a></span></span><span> </span><span id="local-6989586621683119219"><span class="annot"><span class="annottext">Set EvVar
</span><a href="#local-6989586621683119219"><span class="hs-identifier hs-var">unspecables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsLclEnv -&gt; DsLclEnv)
-&gt; TcRnIf DsGblEnv DsLclEnv a -&gt; TcRnIf DsGblEnv DsLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683119220"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119220"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119220"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_unspecables"><span class="hs-identifier hs-var">dsl_unspecables</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119219"><span class="hs-identifier hs-type">unspecables</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`mappend`</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_unspecables"><span class="hs-identifier hs-var">dsl_unspecables</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119220"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getUnspecables"><span class="hs-identifier hs-type">getUnspecables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvId"><span class="hs-identifier hs-type">EvId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span id="getUnspecables"><span class="annot"><span class="annottext">getUnspecables :: DsM (Set EvVar)
</span><a href="GHC.HsToCore.Monad.html#getUnspecables"><span class="hs-identifier hs-var hs-var">getUnspecables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsLclEnv -&gt; Set EvVar
</span><a href="GHC.HsToCore.Types.html#dsl_unspecables"><span class="hs-identifier hs-var">dsl_unspecables</span></a></span><span> </span><span class="annot"><span class="annottext">(DsLclEnv -&gt; Set EvVar)
-&gt; TcRnIf DsGblEnv DsLclEnv DsLclEnv -&gt; DsM (Set EvVar)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier hs-type">getSrcSpanDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-479"></span><span id="getSrcSpanDs"><span class="annot"><span class="annottext">getSrcSpanDs :: DsM SrcSpan
</span><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier hs-var hs-var">getSrcSpanDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119221"><span class="annot"><a href="#local-6989586621683119221"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-480"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_loc"><span class="hs-identifier hs-var">dsl_loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119221"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Data.Strict.html#Nothing"><span class="hs-identifier hs-type">Strict.Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span id="local-6989586621683118637"><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-type">putSrcSpanDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118637"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118637"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-483"></span><span id="putSrcSpanDs"><span class="annot"><span class="annottext">putSrcSpanDs :: forall a. SrcSpan -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var hs-var">putSrcSpanDs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#UnhelpfulSpan"><span class="hs-identifier hs-type">UnhelpfulSpan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621683119225"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119225"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119225"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-485"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span id="local-6989586621683119226"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621683119226"><span class="hs-identifier hs-var">real_span</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683119227"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119227"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-486"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsLclEnv -&gt; DsLclEnv) -&gt; DsM a -&gt; DsM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683119228"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119228"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119228"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_loc"><span class="hs-identifier hs-var">dsl_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119226"><span class="hs-identifier hs-type">real_span</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119227"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span id="local-6989586621683118639"><span id="local-6989586621683118640"><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDsA"><span class="hs-identifier hs-type">putSrcSpanDsA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnn"><span class="hs-identifier hs-type">EpAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118639"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118640"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118640"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-489"></span><span id="putSrcSpanDsA"><span class="annot"><span class="annottext">putSrcSpanDsA :: forall ann a. EpAnn ann -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDsA"><span class="hs-identifier hs-var hs-var">putSrcSpanDsA</span></a></span></span><span> </span><span id="local-6989586621683119231"><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683119231"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DsM a -&gt; DsM a
forall a. SrcSpan -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpAnn ann -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnn ann
</span><a href="#local-6989586621683119231"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-comment">-- | Emit a diagnostic for the current source location. In case the diagnostic is a warning,</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- the latter will be ignored and discarded if the relevant 'WarningFlag' is not set in the DynFlags.</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- See Note [Discarding Messages] in 'GHC.Types.Error'.</span><span>
</span><span id="line-494"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-type">diagnosticDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span id="diagnosticDs"><span class="annot"><span class="annottext">diagnosticDs :: DsMessage -&gt; DsM ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var hs-var">diagnosticDs</span></a></span></span><span> </span><span id="local-6989586621683119234"><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621683119234"><span class="hs-identifier hs-var">dsMessage</span></a></span></span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119235"><span class="annot"><a href="#local-6989586621683119235"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-497"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119236"><span class="annot"><a href="#local-6989586621683119236"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier hs-type">getSrcSpanDs</span></a></span><span>
</span><span id="line-498"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683119237"><span class="annot"><a href="#local-6989586621683119237"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-type">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-499"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683119239"><span class="annot"><a href="#local-6989586621683119239"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagOpts
-&gt; SrcSpan -&gt; NamePprCtx -&gt; DsMessage -&gt; MsgEnvelope DsMessage
forall e.
Diagnostic e =&gt;
DiagOpts -&gt; SrcSpan -&gt; NamePprCtx -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkMsgEnvelope"><span class="hs-identifier hs-var">mkMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621683119237"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683119236"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv -&gt; NamePprCtx
</span><a href="GHC.HsToCore.Types.html#ds_name_ppr_ctx"><span class="hs-identifier hs-var">ds_name_ppr_ctx</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621683119235"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621683119234"><span class="hs-identifier hs-var">dsMessage</span></a></span><span>
</span><span id="line-500"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html#updMutVar"><span class="hs-identifier hs-type">updMutVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119235"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621683119242"><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621683119242"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DsMessage
</span><a href="#local-6989586621683119239"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DsMessage -&gt; Messages DsMessage -&gt; Messages DsMessage
forall e. MsgEnvelope e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#addMessage"><span class="hs-operator hs-var">`addMessage`</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621683119242"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#addMessagesDs"><span class="hs-identifier hs-type">addMessagesDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span id="addMessagesDs"><span class="annot"><span class="annottext">addMessagesDs :: Messages DsMessage -&gt; DsM ()
</span><a href="GHC.HsToCore.Monad.html#addMessagesDs"><span class="hs-identifier hs-var hs-var">addMessagesDs</span></a></span></span><span> </span><span id="local-6989586621683119244"><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621683119244"><span class="hs-identifier hs-var">msgs1</span></a></span></span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119245"><span class="annot"><a href="#local-6989586621683119245"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef (Messages DsMessage)
</span><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv -&gt; IORef (Messages DsMessage))
-&gt; TcRnIf DsGblEnv DsLclEnv DsGblEnv
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (IORef (Messages DsMessage))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-505"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119246"><span class="annot"><a href="#local-6989586621683119246"><span class="hs-identifier hs-var">msgs0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683119245"><span class="hs-identifier hs-type">msg_var</span></a></span><span>
</span><span id="line-506"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683119245"><span class="hs-identifier hs-type">msg_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683119246"><span class="hs-identifier hs-type">msgs0</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-type">`unionMessages`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119244"><span class="hs-identifier hs-type">msgs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="hs-comment">-- | Issue an error, but return the expression for (), so that we can continue</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- reporting errors.</span><span>
</span><span id="line-510"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#errDsCoreExpr"><span class="hs-identifier hs-type">errDsCoreExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-511"></span><span id="errDsCoreExpr"><span class="annot"><span class="annottext">errDsCoreExpr :: DsMessage -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Monad.html#errDsCoreExpr"><span class="hs-identifier hs-var hs-var">errDsCoreExpr</span></a></span></span><span> </span><span id="local-6989586621683119249"><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621683119249"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DsMessage -&gt; DsM ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621683119249"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-513"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="GHC.Core.Make.html#unitExpr"><span class="hs-identifier hs-var">unitExpr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span id="local-6989586621683118653"><span class="annot"><a href="GHC.HsToCore.Monad.html#failWithDs"><span class="hs-identifier hs-type">failWithDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118653"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-516"></span><span id="failWithDs"><span class="annot"><span class="annottext">failWithDs :: forall a. DsMessage -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#failWithDs"><span class="hs-identifier hs-var hs-var">failWithDs</span></a></span></span><span> </span><span id="local-6989586621683119251"><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621683119251"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-517"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DsMessage -&gt; DsM ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621683119251"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span id="local-6989586621683118657"><span class="annot"><a href="GHC.HsToCore.Monad.html#failDs"><span class="hs-identifier hs-type">failDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118657"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-521"></span><span id="failDs"><span class="annot"><span class="annottext">failDs :: forall a. DsM a
</span><a href="GHC.HsToCore.Monad.html#failDs"><span class="hs-identifier hs-var hs-var">failDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span id="local-6989586621683118659"><span class="annot"><a href="GHC.HsToCore.Monad.html#captureMessagesDs"><span class="hs-identifier hs-type">captureMessagesDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118659"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683118659"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-524"></span><span id="captureMessagesDs"><span class="annot"><span class="annottext">captureMessagesDs :: forall a. DsM a -&gt; DsM (Messages DsMessage, a)
</span><a href="GHC.HsToCore.Monad.html#captureMessagesDs"><span class="hs-identifier hs-var hs-var">captureMessagesDs</span></a></span></span><span> </span><span id="local-6989586621683119259"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119259"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119260"><span class="annot"><a href="#local-6989586621683119260"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef (Messages DsMessage))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (IORef (Messages DsMessage))
forall a. IO a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (IORef (Messages DsMessage))
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) (IORef (Messages DsMessage)))
-&gt; IO (IORef (Messages DsMessage))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (IORef (Messages DsMessage))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage -&gt; IO (IORef (Messages DsMessage))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-526"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119261"><span class="annot"><a href="#local-6989586621683119261"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683119262"><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621683119262"><span class="hs-identifier hs-var">gbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621683119262"><span class="hs-identifier hs-var">gbl</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683119260"><span class="hs-identifier hs-type">msg_var</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683119259"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-527"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119263"><span class="annot"><a href="#local-6989586621683119263"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">readIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621683119260"><span class="hs-identifier hs-type">msg_var</span></a></span><span>
</span><span id="line-528"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683119263"><span class="hs-identifier hs-type">msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683119261"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkNamePprCtxDs"><span class="hs-identifier hs-type">mkNamePprCtxDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#NamePprCtx"><span class="hs-identifier hs-type">NamePprCtx</span></a></span><span>
</span><span id="line-531"></span><span id="mkNamePprCtxDs"><span class="annot"><span class="annottext">mkNamePprCtxDs :: DsM NamePprCtx
</span><a href="GHC.HsToCore.Monad.html#mkNamePprCtxDs"><span class="hs-identifier hs-var hs-var">mkNamePprCtxDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; NamePprCtx
</span><a href="GHC.HsToCore.Types.html#ds_name_ppr_ctx"><span class="hs-identifier hs-var">ds_name_ppr_ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv -&gt; NamePprCtx)
-&gt; TcRnIf DsGblEnv DsLclEnv DsGblEnv -&gt; DsM NamePprCtx
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621683119268"><span id="local-6989586621683119272"><span id="local-6989586621683119275"><span class="annot"><a href="GHC.Types.TyThing.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-534"></span><span>    </span><span id="local-6989586621683119278"><span class="annot"><span class="annottext">lookupThing :: Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="#local-6989586621683119278"><span class="hs-identifier hs-var hs-var hs-var">lookupThing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-type">dsLookupGlobal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span>
</span><span id="line-537"></span><span class="hs-comment">-- Very like GHC.Tc.Utils.Env.tcLookupGlobal</span><span>
</span><span id="line-538"></span><span id="dsLookupGlobal"><span class="annot"><span class="annottext">dsLookupGlobal :: Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var hs-var">dsLookupGlobal</span></a></span></span><span> </span><span id="local-6989586621683119280"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119280"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119281"><span class="annot"><a href="#local-6989586621683119281"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-540"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-type">setEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_if_env"><span class="hs-identifier hs-var">ds_if_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119281"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.IfaceToCore.html#tcIfaceGlobal"><span class="hs-identifier hs-type">tcIfaceGlobal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119280"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-type">dsLookupGlobalId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-544"></span><span id="dsLookupGlobalId"><span class="annot"><span class="annottext">dsLookupGlobalId :: Name -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var hs-var">dsLookupGlobalId</span></a></span></span><span> </span><span id="local-6989586621683119283"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119283"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TyThing -&gt; EvVar
TyThing -&gt; EvVar
</span><a href="GHC.Types.TyThing.html#tyThingId"><span class="hs-identifier hs-var">tyThingId</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; EvVar)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing -&gt; DsM EvVar
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119283"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-type">dsLookupTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-548"></span><span id="dsLookupTyCon"><span class="annot"><span class="annottext">dsLookupTyCon :: Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-var hs-var">dsLookupTyCon</span></a></span></span><span> </span><span id="local-6989586621683119285"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119285"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TyThing -&gt; TyCon
TyThing -&gt; TyCon
</span><a href="GHC.Types.TyThing.html#tyThingTyCon"><span class="hs-identifier hs-var">tyThingTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; TyCon)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyCon
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119285"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-type">dsLookupDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-552"></span><span id="dsLookupDataCon"><span class="annot"><span class="annottext">dsLookupDataCon :: Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) DataCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-var hs-var">dsLookupDataCon</span></a></span></span><span> </span><span id="local-6989586621683119287"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119287"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TyThing -&gt; DataCon
TyThing -&gt; DataCon
</span><a href="GHC.Types.TyThing.html#tyThingDataCon"><span class="hs-identifier hs-var">tyThingDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; DataCon)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
-&gt; IOEnv (Env DsGblEnv DsLclEnv) DataCon
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119287"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupConLike"><span class="hs-identifier hs-type">dsLookupConLike</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-556"></span><span id="dsLookupConLike"><span class="annot"><span class="annottext">dsLookupConLike :: Name -&gt; DsM ConLike
</span><a href="GHC.HsToCore.Monad.html#dsLookupConLike"><span class="hs-identifier hs-var hs-var">dsLookupConLike</span></a></span></span><span> </span><span id="local-6989586621683119289"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119289"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TyThing -&gt; ConLike
TyThing -&gt; ConLike
</span><a href="GHC.Types.TyThing.html#tyThingConLike"><span class="hs-identifier hs-var">tyThingConLike</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; ConLike)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing -&gt; DsM ConLike
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119289"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-type">dsGetFamInstEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span>
</span><span id="line-561"></span><span class="hs-comment">-- Gets both the external-package inst-env</span><span>
</span><span id="line-562"></span><span class="hs-comment">-- and the home-pkg inst env (includes module being compiled)</span><span>
</span><span id="line-563"></span><span id="dsGetFamInstEnvs"><span class="annot"><span class="annottext">dsGetFamInstEnvs :: DsM FamInstEnvs
</span><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var hs-var">dsGetFamInstEnvs</span></a></span></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119291"><span class="annot"><a href="#local-6989586621683119291"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv ExternalPackageState
forall gbl lcl. TcRnIf gbl lcl ExternalPackageState
</span><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier hs-var">getEps</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119293"><span class="annot"><a href="#local-6989586621683119293"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-565"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.External.html#eps_fam_inst_env"><span class="hs-identifier hs-var">eps_fam_inst_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119291"><span class="hs-identifier hs-type">eps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_fam_inst_env"><span class="hs-identifier hs-var">ds_fam_inst_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119293"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetMetaEnv"><span class="hs-identifier hs-type">dsGetMetaEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span id="dsGetMetaEnv"><span class="annot"><span class="annottext">dsGetMetaEnv :: DsM DsMetaEnv
</span><a href="GHC.HsToCore.Monad.html#dsGetMetaEnv"><span class="hs-identifier hs-var hs-var">dsGetMetaEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119295"><span class="annot"><a href="#local-6989586621683119295"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119295"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="annot"><span class="hs-comment">-- | The @COMPLETE@ pragmas that are in scope.</span></span><span>
</span><span id="line-571"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetCompleteMatches"><span class="hs-identifier hs-type">dsGetCompleteMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#DsCompleteMatches"><span class="hs-identifier hs-type">DsCompleteMatches</span></a></span><span>
</span><span id="line-572"></span><span id="dsGetCompleteMatches"><span class="annot"><span class="annottext">dsGetCompleteMatches :: DsM [DsCompleteMatch]
</span><a href="GHC.HsToCore.Monad.html#dsGetCompleteMatches"><span class="hs-identifier hs-var hs-var">dsGetCompleteMatches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; [DsCompleteMatch]
</span><a href="GHC.HsToCore.Types.html#ds_complete_matches"><span class="hs-identifier hs-var">ds_complete_matches</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv -&gt; [DsCompleteMatch])
-&gt; TcRnIf DsGblEnv DsLclEnv DsGblEnv -&gt; DsM [DsCompleteMatch]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupMetaEnv"><span class="hs-identifier hs-type">dsLookupMetaEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span id="dsLookupMetaEnv"><span class="annot"><span class="annottext">dsLookupMetaEnv :: Name -&gt; DsM (Maybe DsMetaVal)
</span><a href="GHC.HsToCore.Monad.html#dsLookupMetaEnv"><span class="hs-identifier hs-var hs-var">dsLookupMetaEnv</span></a></span></span><span> </span><span id="local-6989586621683119296"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683119296"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119297"><span class="annot"><a href="#local-6989586621683119297"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-type">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119297"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683119296"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span id="local-6989586621683118669"><span class="annot"><a href="GHC.HsToCore.Monad.html#dsExtendMetaEnv"><span class="hs-identifier hs-type">dsExtendMetaEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaEnv"><span class="hs-identifier hs-type">DsMetaEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118669"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118669"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-578"></span><span id="dsExtendMetaEnv"><span class="annot"><span class="annottext">dsExtendMetaEnv :: forall a. DsMetaEnv -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#dsExtendMetaEnv"><span class="hs-identifier hs-var hs-var">dsExtendMetaEnv</span></a></span></span><span> </span><span id="local-6989586621683119299"><span class="annot"><span class="annottext">DsMetaEnv
</span><a href="#local-6989586621683119299"><span class="hs-identifier hs-var">menv</span></a></span></span><span> </span><span id="local-6989586621683119300"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119300"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsLclEnv -&gt; DsLclEnv) -&gt; DsM a -&gt; DsM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621683119301"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119301"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621683119301"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119301"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#plusNameEnv"><span class="hs-operator hs-type">`plusNameEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119299"><span class="hs-identifier hs-type">menv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119300"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span id="local-6989586621683118672"><span class="annot"><a href="GHC.HsToCore.Monad.html#discardWarningsDs"><span class="hs-identifier hs-type">discardWarningsDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118672"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683118672"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-582"></span><span class="hs-comment">-- Ignore warnings inside the thing inside;</span><span>
</span><span id="line-583"></span><span class="hs-comment">-- used to ignore inaccessible cases etc. inside generated code</span><span>
</span><span id="line-584"></span><span id="discardWarningsDs"><span class="annot"><span class="annottext">discardWarningsDs :: forall a. DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#discardWarningsDs"><span class="hs-identifier hs-var hs-var">discardWarningsDs</span></a></span></span><span> </span><span id="local-6989586621683119310"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621683119310"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621683119311"><span class="annot"><a href="#local-6989586621683119311"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119312"><span class="annot"><a href="#local-6989586621683119312"><span class="hs-identifier hs-var">old_msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119311"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621683119314"><span class="annot"><a href="#local-6989586621683119314"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621683119310"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span>        </span><span class="hs-comment">-- Revert messages to old_msgs</span><span>
</span><span id="line-591"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.TcRef.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119311"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683119312"><span class="hs-identifier hs-type">old_msgs</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683119314"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="hs-comment">-- | Inject a trace message into the compiled program. Whereas</span><span>
</span><span id="line-596"></span><span class="hs-comment">-- pprTrace prints out information *while compiling*, pprRuntimeTrace</span><span>
</span><span id="line-597"></span><span class="hs-comment">-- captures that information and causes it to be printed *at runtime*</span><span>
</span><span id="line-598"></span><span class="hs-comment">-- using Debug.Trace.trace.</span><span>
</span><span id="line-599"></span><span class="hs-comment">--</span><span>
</span><span id="line-600"></span><span class="hs-comment">--   pprRuntimeTrace hdr doc expr</span><span>
</span><span id="line-601"></span><span class="hs-comment">--</span><span>
</span><span id="line-602"></span><span class="hs-comment">-- will produce an expression that looks like</span><span>
</span><span id="line-603"></span><span class="hs-comment">--</span><span>
</span><span id="line-604"></span><span class="hs-comment">--   trace (hdr + doc) expr</span><span>
</span><span id="line-605"></span><span class="hs-comment">--</span><span>
</span><span id="line-606"></span><span class="hs-comment">-- When using this to debug a module that Debug.Trace depends on,</span><span>
</span><span id="line-607"></span><span class="hs-comment">-- it is necessary to import {-# SOURCE #-} Debug.Trace () in that</span><span>
</span><span id="line-608"></span><span class="hs-comment">-- module. We could avoid this inconvenience by wiring in Debug.Trace.trace,</span><span>
</span><span id="line-609"></span><span class="hs-comment">-- but that doesn't seem worth the effort and maintenance cost.</span><span>
</span><span id="line-610"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#pprRuntimeTrace"><span class="hs-identifier hs-type">pprRuntimeTrace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ header</span></span><span>
</span><span id="line-611"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ information to output</span></span><span>
</span><span id="line-612"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ expression</span></span><span>
</span><span id="line-613"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-614"></span><span id="pprRuntimeTrace"><span class="annot"><span class="annottext">pprRuntimeTrace :: String -&gt; SDoc -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Monad.html#pprRuntimeTrace"><span class="hs-identifier hs-var hs-var">pprRuntimeTrace</span></a></span></span><span> </span><span id="local-6989586621683119316"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683119316"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621683119317"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683119317"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621683119318"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683119318"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>  </span><span id="local-6989586621683119319"><span class="annot"><a href="#local-6989586621683119319"><span class="hs-identifier hs-var">traceId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM EvVar
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#traceName"><span class="hs-identifier hs-var">traceName</span></a></span><span>
</span><span id="line-616"></span><span>  </span><span id="local-6989586621683119321"><span class="annot"><a href="#local-6989586621683119321"><span class="hs-identifier hs-var">unpackCStringId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-type">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#unpackCStringName"><span class="hs-identifier hs-type">unpackCStringName</span></a></span><span>
</span><span id="line-617"></span><span>  </span><span id="local-6989586621683119323"><span class="annot"><a href="#local-6989586621683119323"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683119324"><span class="hs-identifier hs-type">message</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-619"></span><span>      </span><span id="local-6989586621683119324"><span class="annot"><a href="#local-6989586621683119324"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsWrapper
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvVar -&gt; CoreExpr
forall b. EvVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">EvVar
</span><a href="#local-6989586621683119321"><span class="hs-identifier hs-var">unpackCStringId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DsWrapper -&gt; DsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-620"></span><span>                </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; CoreExpr) -&gt; Literal -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitString"><span class="hs-identifier hs-var">mkLitString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Literal) -&gt; String -&gt; Literal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; String
</span><a href="GHC.Driver.Ppr.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683119323"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621683119316"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683119317"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-type">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119319"><span class="hs-identifier hs-type">traceId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-type">exprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683119318"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683119324"><span class="hs-identifier hs-type">message</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683119318"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="annot"><span class="hs-comment">-- | See 'getCCIndexM'.</span></span><span>
</span><span id="line-624"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getCCIndexDsM"><span class="hs-identifier hs-type">getCCIndexDsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreIndex"><span class="hs-identifier hs-type">CostCentreIndex</span></a></span><span>
</span><span id="line-625"></span><span id="getCCIndexDsM"><span class="annot"><span class="annottext">getCCIndexDsM :: FastString -&gt; DsM CostCentreIndex
</span><a href="GHC.HsToCore.Monad.html#getCCIndexDsM"><span class="hs-identifier hs-var hs-var">getCCIndexDsM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsGblEnv -&gt; IORef CostCentreState)
-&gt; FastString -&gt; DsM CostCentreIndex
forall gbl lcl.
(gbl -&gt; IORef CostCentreState)
-&gt; FastString -&gt; TcRnIf gbl lcl CostCentreIndex
</span><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier hs-var">getCCIndexM</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef CostCentreState
</span><a href="GHC.HsToCore.Types.html#ds_cc_st"><span class="hs-identifier hs-var">ds_cc_st</span></a></span><span>
</span><span id="line-626"></span></pre></body></html>