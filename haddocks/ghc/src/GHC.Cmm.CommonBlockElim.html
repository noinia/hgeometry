<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html"><span class="hs-identifier">GHC.Cmm.CommonBlockElim</span></a></span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#elimCommonBlocks"><span class="hs-identifier">elimCommonBlocks</span></a></span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">iterate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">succ</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zip</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html"><span class="hs-identifier">GHC.Cmm.BlockId</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Switch.html"><span class="hs-identifier">GHC.Cmm.Switch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Switch.html#eqSwitchTargetWith"><span class="hs-identifier">eqSwitchTargetWith</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.ContFlowOpt.html"><span class="hs-identifier">GHC.Cmm.ContFlowOpt</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Block</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Graph.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Graph</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html"><span class="hs-identifier">Data.Functor.Classes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier">liftEq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.7-5a8f/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html"><span class="hs-identifier">GHC.Data.TrieMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TM</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Word64.html"><span class="hs-identifier">GHC.Utils.Word64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Word64.html#truncateWord64ToWord32"><span class="hs-identifier">truncateWord64ToWord32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- Eliminate common blocks</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- If two blocks are identical except for the label on the first node,</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- then we can eliminate one of the blocks. To ensure that the semantics</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- of the program are preserved, we have to rewrite each predecessor of the</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- eliminated block to proceed with the block we keep.</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- The algorithm iterates over the blocks in the graph,</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- checking whether it has seen another block that is equal modulo labels.</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- If so, then it adds an entry in a map indicating that the new block</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- is made redundant by the old block.</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- Otherwise, it is added to the useful blocks.</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- To avoid comparing every block with every other block repeatedly, we group</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- them by</span><span>
</span><span id="line-49"></span><span class="hs-comment">--   * a hash of the block, ignoring labels (explained below)</span><span>
</span><span id="line-50"></span><span class="hs-comment">--   * the list of outgoing labels</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- The hash is invariant under relabeling, so we only ever compare within</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- the same group of blocks.</span><span>
</span><span id="line-53"></span><span class="hs-comment">--</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- The list of outgoing labels is updated as we merge blocks (that is why they</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- are not included in the hash, which we want to calculate only once).</span><span>
</span><span id="line-56"></span><span class="hs-comment">--</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- All in all, two blocks should never be compared if they have different</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- hashes, and at most once otherwise. Previously, we were slower, and people</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- rightfully complained: #10397</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">-- TODO: Use optimization fuel</span><span>
</span><span id="line-62"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#elimCommonBlocks"><span class="hs-identifier hs-type">elimCommonBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span>
</span><span id="line-63"></span><span id="elimCommonBlocks"><span class="annot"><span class="annottext">elimCommonBlocks :: CmmGraph -&gt; CmmGraph
</span><a href="GHC.Cmm.CommonBlockElim.html#elimCommonBlocks"><span class="hs-identifier hs-var hs-var">elimCommonBlocks</span></a></span></span><span> </span><span id="local-6989586621682883701"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682883701"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; CmmGraph -&gt; CmmGraph
</span><a href="GHC.Cmm.ContFlowOpt.html#replaceLabels"><span class="hs-identifier hs-var">replaceLabels</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883703"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmGraph -&gt; CmmGraph) -&gt; CmmGraph -&gt; CmmGraph
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; CmmGraph -&gt; CmmGraph
</span><a href="GHC.Cmm.CommonBlockElim.html#copyTicks"><span class="hs-identifier hs-var">copyTicks</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883703"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682883701"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>     </span><span id="local-6989586621682883703"><span class="annot"><span class="annottext">env :: LabelMap BlockId
</span><a href="#local-6989586621682883703"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; [[(Key, DistinctBlocks)]] -&gt; LabelMap BlockId
</span><a href="GHC.Cmm.CommonBlockElim.html#iterate"><span class="hs-identifier hs-var">iterate</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">[[(Key, DistinctBlocks)]]
</span><a href="#local-6989586621682883707"><span class="hs-identifier hs-var">blocks_with_key</span></a></span><span>
</span><span id="line-66"></span><span>     </span><span class="hs-comment">-- The order of blocks doesn't matter here. While we could use</span><span>
</span><span id="line-67"></span><span>     </span><span class="hs-comment">-- revPostorder which drops unreachable blocks this is done in</span><span>
</span><span id="line-68"></span><span>     </span><span class="hs-comment">-- ContFlowOpt already which runs before this pass. So we use</span><span>
</span><span id="line-69"></span><span>     </span><span class="hs-comment">-- toBlockList since it is faster.</span><span>
</span><span id="line-70"></span><span>     </span><span id="local-6989586621682883708"><span class="annot"><span class="annottext">groups :: [DistinctBlocks]
</span><a href="#local-6989586621682883708"><span class="hs-identifier hs-var hs-var">groups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmBlock -&gt; Int) -&gt; DistinctBlocks -&gt; [DistinctBlocks]
forall a. (a -&gt; Int) -&gt; [a] -&gt; [[a]]
</span><a href="GHC.Cmm.CommonBlockElim.html#groupByInt"><span class="hs-identifier hs-var">groupByInt</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; Int
</span><a href="GHC.Cmm.CommonBlockElim.html#hash_block"><span class="hs-identifier hs-var">hash_block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGraph -&gt; DistinctBlocks
</span><a href="GHC.Cmm.html#toBlockList"><span class="hs-identifier hs-var">toBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682883701"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-71"></span><span>     </span><span id="local-6989586621682883707"><span class="annot"><span class="annottext">blocks_with_key :: [[(Key, DistinctBlocks)]]
</span><a href="#local-6989586621682883707"><span class="hs-identifier hs-var hs-var">blocks_with_key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmBlock -&gt; Key
forall (e :: Extensibility). Block CmmNode e C -&gt; Key
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (e :: Extensibility).
NonLocal thing =&gt;
thing e C -&gt; Key
</span><a href="GHC.Cmm.Dataflow.Graph.html#successors"><span class="hs-identifier hs-var">successors</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883713"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883713"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682883713"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883713"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883714"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682883714"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883714"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DistinctBlocks]
</span><a href="#local-6989586621682883708"><span class="hs-identifier hs-var">groups</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">-- Invariant: The blocks in the list are pairwise distinct</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- (so avoid comparing them again)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">type</span><span> </span><span id="DistinctBlocks"><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-var">DistinctBlocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-76"></span><span class="hs-keyword">type</span><span> </span><span id="Key"><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Key"><span class="hs-identifier hs-var">Key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span class="hs-keyword">type</span><span> </span><span id="Subst"><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Subst"><span class="hs-identifier hs-var">Subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- The outer list groups by hash. We retain this grouping throughout.</span><span>
</span><span id="line-80"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#iterate"><span class="hs-identifier hs-type">iterate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-81"></span><span id="iterate"><span class="annot"><span class="annottext">iterate :: LabelMap BlockId -&gt; [[(Key, DistinctBlocks)]] -&gt; LabelMap BlockId
</span><a href="GHC.Cmm.CommonBlockElim.html#iterate"><span class="hs-identifier hs-var hs-var">iterate</span></a></span></span><span> </span><span id="local-6989586621682883717"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883717"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682883718"><span class="annot"><span class="annottext">[[(Key, DistinctBlocks)]]
</span><a href="#local-6989586621682883718"><span class="hs-identifier hs-var">blocks</span></a></span></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; Bool
forall a. LabelMap a -&gt; Bool
</span><a href="GHC.Cmm.Dataflow.Label.html#mapNull"><span class="hs-identifier hs-var">mapNull</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883720"><span class="hs-identifier hs-var">new_substs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883717"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; [[(Key, DistinctBlocks)]] -&gt; LabelMap BlockId
</span><a href="GHC.Cmm.CommonBlockElim.html#iterate"><span class="hs-identifier hs-var">iterate</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883721"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[[(Key, DistinctBlocks)]]
</span><a href="#local-6989586621682883722"><span class="hs-identifier hs-var">updated_blocks</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="#local-6989586621682883723"><span class="hs-identifier hs-type">grouped_blocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621682883723"><span class="annot"><span class="annottext">grouped_blocks :: [[(Key, NonEmpty DistinctBlocks)]]
</span><a href="#local-6989586621682883723"><span class="hs-identifier hs-var hs-var">grouped_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Key, DistinctBlocks)] -&gt; [(Key, NonEmpty DistinctBlocks)])
-&gt; [[(Key, DistinctBlocks)]] -&gt; [[(Key, NonEmpty DistinctBlocks)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[(Key, DistinctBlocks)] -&gt; [(Key, NonEmpty DistinctBlocks)]
</span><a href="GHC.Cmm.CommonBlockElim.html#groupByLabel"><span class="hs-identifier hs-var">groupByLabel</span></a></span><span> </span><span class="annot"><span class="annottext">[[(Key, DistinctBlocks)]]
</span><a href="#local-6989586621682883718"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="#local-6989586621682883725"><span class="hs-identifier hs-type">merged_blocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682883720"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883720"><span class="hs-identifier hs-var">new_substs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883725"><span class="annot"><span class="annottext">[[(Key, DistinctBlocks)]]
</span><a href="#local-6989586621682883725"><span class="hs-identifier hs-var">merged_blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LabelMap BlockId
 -&gt; [(Key, NonEmpty DistinctBlocks)]
 -&gt; (LabelMap BlockId, [(Key, DistinctBlocks)]))
-&gt; LabelMap BlockId
-&gt; [[(Key, NonEmpty DistinctBlocks)]]
-&gt; (LabelMap BlockId, [[(Key, DistinctBlocks)]])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">List.mapAccumL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LabelMap BlockId
 -&gt; (Key, NonEmpty DistinctBlocks)
 -&gt; (LabelMap BlockId, (Key, DistinctBlocks)))
-&gt; LabelMap BlockId
-&gt; [(Key, NonEmpty DistinctBlocks)]
-&gt; (LabelMap BlockId, [(Key, DistinctBlocks)])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">List.mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
-&gt; (Key, NonEmpty DistinctBlocks)
-&gt; (LabelMap BlockId, (Key, DistinctBlocks))
</span><a href="#local-6989586621682883727"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">[[(Key, NonEmpty DistinctBlocks)]]
</span><a href="#local-6989586621682883723"><span class="hs-identifier hs-var">grouped_blocks</span></a></span><span>
</span><span id="line-90"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>        </span><span id="local-6989586621682883727"><span class="annot"><span class="annottext">go :: LabelMap BlockId
-&gt; (Key, NonEmpty DistinctBlocks)
-&gt; (LabelMap BlockId, (Key, DistinctBlocks))
</span><a href="#local-6989586621682883727"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682883728"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883728"><span class="hs-identifier hs-var">new_subst1</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883729"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621682883729"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682883730"><span class="annot"><span class="annottext">NonEmpty DistinctBlocks
</span><a href="#local-6989586621682883730"><span class="hs-identifier hs-var">dbs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883728"><span class="hs-identifier hs-var">new_subst1</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; LabelMap BlockId -&gt; LabelMap BlockId
forall v. LabelMap v -&gt; LabelMap v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapUnion"><span class="hs-operator hs-var">`mapUnion`</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883732"><span class="hs-identifier hs-var">new_subst2</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621682883729"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883733"><span class="hs-identifier hs-var">db</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682883732"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883732"><span class="hs-identifier hs-var">new_subst2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883733"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883733"><span class="hs-identifier hs-var">db</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
-&gt; NonEmpty DistinctBlocks -&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="GHC.Cmm.CommonBlockElim.html#mergeBlockList"><span class="hs-identifier hs-var">mergeBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883717"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty DistinctBlocks
</span><a href="#local-6989586621682883730"><span class="hs-identifier hs-var">dbs</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621682883721"><span class="annot"><span class="annottext">subst' :: LabelMap BlockId
</span><a href="#local-6989586621682883721"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883717"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; LabelMap BlockId -&gt; LabelMap BlockId
forall v. LabelMap v -&gt; LabelMap v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapUnion"><span class="hs-operator hs-var">`mapUnion`</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883720"><span class="hs-identifier hs-var">new_substs</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span id="local-6989586621682883722"><span class="annot"><span class="annottext">updated_blocks :: [[(Key, DistinctBlocks)]]
</span><a href="#local-6989586621682883722"><span class="hs-identifier hs-var hs-var">updated_blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Key, DistinctBlocks)] -&gt; [(Key, DistinctBlocks)])
-&gt; [[(Key, DistinctBlocks)]] -&gt; [[(Key, DistinctBlocks)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Key, DistinctBlocks) -&gt; (Key, DistinctBlocks))
-&gt; [(Key, DistinctBlocks)] -&gt; [(Key, DistinctBlocks)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Key -&gt; Key) -&gt; (Key, DistinctBlocks) -&gt; (Key, DistinctBlocks)
forall b c d. (b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId) -&gt; Key -&gt; Key
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; BlockId -&gt; BlockId
</span><a href="GHC.Cmm.CommonBlockElim.html#lookupBid"><span class="hs-identifier hs-var">lookupBid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883721"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(Key, DistinctBlocks)]]
</span><a href="#local-6989586621682883725"><span class="hs-identifier hs-var">merged_blocks</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- Combine two lists of blocks.</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- While they are internally distinct they can still share common blocks.</span><span>
</span><span id="line-100"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#mergeBlocks"><span class="hs-identifier hs-type">mergeBlocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="mergeBlocks"><span class="annot"><span class="annottext">mergeBlocks :: LabelMap BlockId
-&gt; DistinctBlocks
-&gt; DistinctBlocks
-&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="GHC.Cmm.CommonBlockElim.html#mergeBlocks"><span class="hs-identifier hs-var hs-var">mergeBlocks</span></a></span></span><span> </span><span id="local-6989586621682883737"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883737"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682883738"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883738"><span class="hs-identifier hs-var">existing</span></a></span></span><span> </span><span id="local-6989586621682883739"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883739"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistinctBlocks -&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="#local-6989586621682883740"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883739"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621682883740"><span class="annot"><span class="annottext">go :: DistinctBlocks -&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="#local-6989586621682883740"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap BlockId
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883738"><span class="hs-identifier hs-var">existing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="#local-6989586621682883740"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883741"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883741"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682883742"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883742"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(CmmBlock -&gt; Bool) -&gt; DistinctBlocks -&gt; Maybe CmmBlock
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">List.find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmBlock -&gt; CmmBlock -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqBlockBodyWith"><span class="hs-identifier hs-var">eqBlockBodyWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; BlockId -&gt; BlockId -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqBid"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883737"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883741"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883738"><span class="hs-identifier hs-var">existing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-105"></span><span>        </span><span class="hs-comment">-- This block is a duplicate. Drop it, and add it to the substitution</span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682883746"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883746"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(LabelMap BlockId -&gt; LabelMap BlockId)
-&gt; (LabelMap BlockId, DistinctBlocks)
-&gt; (LabelMap BlockId, DistinctBlocks)
forall b c d. (b -&gt; c) -&gt; (b, d) -&gt; (c, d)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; LabelMap BlockId -&gt; LabelMap BlockId
forall v. BlockId -&gt; v -&gt; LabelMap v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapInsert"><span class="hs-identifier hs-var">mapInsert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmBlock -&gt; BlockId
forall (x :: Extensibility). Block CmmNode C x -&gt; BlockId
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
NonLocal thing =&gt;
thing C x -&gt; BlockId
</span><a href="GHC.Cmm.Dataflow.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883741"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmBlock -&gt; BlockId
forall (x :: Extensibility). Block CmmNode C x -&gt; BlockId
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
NonLocal thing =&gt;
thing C x -&gt; BlockId
</span><a href="GHC.Cmm.Dataflow.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883746"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((LabelMap BlockId, DistinctBlocks)
 -&gt; (LabelMap BlockId, DistinctBlocks))
-&gt; (LabelMap BlockId, DistinctBlocks)
-&gt; (LabelMap BlockId, DistinctBlocks)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks -&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="#local-6989586621682883740"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883742"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-comment">-- This block is not a duplicate, keep it.</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">Maybe CmmBlock
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DistinctBlocks -&gt; DistinctBlocks)
-&gt; (LabelMap BlockId, DistinctBlocks)
-&gt; (LabelMap BlockId, DistinctBlocks)
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883741"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">CmmBlock -&gt; DistinctBlocks -&gt; DistinctBlocks
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((LabelMap BlockId, DistinctBlocks)
 -&gt; (LabelMap BlockId, DistinctBlocks))
-&gt; (LabelMap BlockId, DistinctBlocks)
-&gt; (LabelMap BlockId, DistinctBlocks)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks -&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="#local-6989586621682883740"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883742"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#mergeBlockList"><span class="hs-identifier hs-type">mergeBlockList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span id="mergeBlockList"><span class="annot"><span class="annottext">mergeBlockList :: LabelMap BlockId
-&gt; NonEmpty DistinctBlocks -&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="GHC.Cmm.CommonBlockElim.html#mergeBlockList"><span class="hs-identifier hs-var hs-var">mergeBlockList</span></a></span></span><span> </span><span id="local-6989586621682883749"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883749"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883750"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883750"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span id="local-6989586621682883752"><span class="annot"><span class="annottext">[DistinctBlocks]
</span><a href="#local-6989586621682883752"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
-&gt; DistinctBlocks
-&gt; [DistinctBlocks]
-&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="#local-6989586621682883753"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
forall v. LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapEmpty"><span class="hs-identifier hs-var">mapEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883750"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[DistinctBlocks]
</span><a href="#local-6989586621682883752"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621682883753"><span class="annot"><span class="annottext">go :: LabelMap BlockId
-&gt; DistinctBlocks
-&gt; [DistinctBlocks]
-&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="#local-6989586621682883753"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682883754"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883754"><span class="hs-identifier hs-var">new_subst1</span></a></span></span><span> </span><span id="local-6989586621682883755"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883755"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883754"><span class="hs-identifier hs-var">new_subst1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883755"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="#local-6989586621682883753"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682883756"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883756"><span class="hs-identifier hs-var">new_subst1</span></a></span></span><span> </span><span id="local-6989586621682883757"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883757"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682883758"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883758"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682883759"><span class="annot"><span class="annottext">[DistinctBlocks]
</span><a href="#local-6989586621682883759"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
-&gt; DistinctBlocks
-&gt; [DistinctBlocks]
-&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="#local-6989586621682883753"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883760"><span class="hs-identifier hs-var">new_subst</span></a></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883761"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[DistinctBlocks]
</span><a href="#local-6989586621682883759"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682883762"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883762"><span class="hs-identifier hs-var">new_subst2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682883761"><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883761"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">LabelMap BlockId
-&gt; DistinctBlocks
-&gt; DistinctBlocks
-&gt; (LabelMap BlockId, DistinctBlocks)
</span><a href="GHC.Cmm.CommonBlockElim.html#mergeBlocks"><span class="hs-identifier hs-var">mergeBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883749"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883757"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">DistinctBlocks
</span><a href="#local-6989586621682883758"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-117"></span><span>        </span><span id="local-6989586621682883760"><span class="annot"><span class="annottext">new_subst :: LabelMap BlockId
</span><a href="#local-6989586621682883760"><span class="hs-identifier hs-var hs-var">new_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883756"><span class="hs-identifier hs-var">new_subst1</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; LabelMap BlockId -&gt; LabelMap BlockId
forall v. LabelMap v -&gt; LabelMap v -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapUnion"><span class="hs-operator hs-var">`mapUnion`</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883762"><span class="hs-identifier hs-var">new_subst2</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- Hashing and equality on blocks</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- Below here is mostly boilerplate: hashing blocks ignoring labels,</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- and comparing blocks modulo a label mapping.</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- To speed up comparisons, we hash each basic block modulo jump labels.</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- The hashing is a bit arbitrary (the numbers are completely arbitrary),</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- but it should be fast and good enough.</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- We want to get as many small buckets as possible, as comparing blocks is</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- expensive. So include as much as possible in the hash. Ideally everything</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- that is compared with (==) in eqBlockBodyWith.</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">type</span><span> </span><span id="HashCode"><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#HashCode"><span class="hs-identifier hs-var">HashCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#hash_block"><span class="hs-identifier hs-type">hash_block</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#HashCode"><span class="hs-identifier hs-type">HashCode</span></a></span><span>
</span><span id="line-137"></span><span id="hash_block"><span class="annot"><span class="annottext">hash_block :: CmmBlock -&gt; Int
</span><a href="GHC.Cmm.CommonBlockElim.html#hash_block"><span class="hs-identifier hs-var hs-var">hash_block</span></a></span></span><span> </span><span id="local-6989586621682883764"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883764"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CmmNode C O -&gt; Word32 -&gt; Word32, CmmNode O O -&gt; Word32 -&gt; Word32,
 CmmNode O C -&gt; Word32 -&gt; Word32)
-&gt; forall (e :: Extensibility) (x :: Extensibility).
   Block CmmNode e x
   -&gt; IndexedCO x Word32 Word32 -&gt; IndexedCO e Word32 Word32
forall (n :: Extensibility -&gt; Extensibility -&gt; *) a b c.
(n C O -&gt; b -&gt; c, n O O -&gt; b -&gt; b, n O C -&gt; a -&gt; b)
-&gt; forall (e :: Extensibility) (x :: Extensibility).
   Block n e x -&gt; IndexedCO x a b -&gt; IndexedCO e c b
</span><a href="GHC.Cmm.Dataflow.Block.html#foldBlockNodesB3"><span class="hs-identifier hs-var">foldBlockNodesB3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O -&gt; Word32 -&gt; Word32
forall {p} {p}. p -&gt; p -&gt; p
</span><a href="#local-6989586621682883766"><span class="hs-identifier hs-var">hash_fst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmNode O O -&gt; Word32 -&gt; Word32
forall {x :: Extensibility}. CmmNode O x -&gt; Word32 -&gt; Word32
</span><a href="#local-6989586621682883767"><span class="hs-identifier hs-var">hash_mid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmNode O C -&gt; Word32 -&gt; Word32
forall {x :: Extensibility}. CmmNode O x -&gt; Word32 -&gt; Word32
</span><a href="#local-6989586621682883768"><span class="hs-identifier hs-var">hash_lst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883764"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x7fffffff</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-comment">-- UniqFM doesn't like negative Ints</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682883766"><span class="annot"><span class="annottext">hash_fst :: p -&gt; p -&gt; p
</span><a href="#local-6989586621682883766"><span class="hs-identifier hs-var hs-var">hash_fst</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883770"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682883770"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682883770"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-141"></span><span>        </span><span id="local-6989586621682883767"><span class="annot"><span class="annottext">hash_mid :: CmmNode O x -&gt; Word32 -&gt; Word32
</span><a href="#local-6989586621682883767"><span class="hs-identifier hs-var hs-var">hash_mid</span></a></span></span><span> </span><span id="local-6989586621682883773"><span class="annot"><span class="annottext">CmmNode O x
</span><a href="#local-6989586621682883773"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682883774"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682883774"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmNode O x -&gt; Word32
forall (x :: Extensibility). CmmNode O x -&gt; Word32
</span><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O x
</span><a href="#local-6989586621682883773"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682883774"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-142"></span><span>        </span><span id="local-6989586621682883768"><span class="annot"><span class="annottext">hash_lst :: CmmNode O x -&gt; Word32 -&gt; Word32
</span><a href="#local-6989586621682883768"><span class="hs-identifier hs-var hs-var">hash_lst</span></a></span></span><span> </span><span id="local-6989586621682883780"><span class="annot"><span class="annottext">CmmNode O x
</span><a href="#local-6989586621682883780"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682883781"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682883781"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmNode O x -&gt; Word32
forall (x :: Extensibility). CmmNode O x -&gt; Word32
</span><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O x
</span><a href="#local-6989586621682883780"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682883781"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-operator hs-var">`shiftL`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>        </span><span id="local-6989586621682883508"><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-type">hash_node</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883508"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span></span><span>
</span><span id="line-145"></span><span>        </span><span id="local-6989586621682883775"><span class="annot"><span class="annottext">hash_node :: forall (x :: Extensibility). CmmNode O x -&gt; Word32
</span><a href="#local-6989586621682883775"><span class="hs-identifier hs-var hs-var">hash_node</span></a></span></span><span> </span><span id="local-6989586621682883785"><span class="annot"><span class="annottext">CmmNode O x
</span><a href="#local-6989586621682883785"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmNode O x -&gt; Bool
forall (x :: Extensibility). CmmNode O x -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#dont_care"><span class="hs-identifier hs-var">dont_care</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O x
</span><a href="#local-6989586621682883785"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- don't care</span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-type">CmmAssign</span></a></span><span> </span><span id="local-6989586621682883791"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883791"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682883792"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883792"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; Word32
</span><a href="#local-6989586621682883793"><span class="hs-identifier hs-var">hash_reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883791"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883792"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span id="local-6989586621682883799"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883799"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682883800"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883800"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883799"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883800"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-type">CmmUnsafeForeignCall</span></a></span><span> </span><span id="local-6989586621682883806"><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682883806"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">[LocalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883807"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883807"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignTarget -&gt; Word32
</span><a href="#local-6989586621682883808"><span class="hs-identifier hs-var">hash_tgt</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682883806"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; Word32) -&gt; [CmmExpr] -&gt; Word32
forall {t :: * -&gt; *} {t}.
Foldable t =&gt;
(t -&gt; Word32) -&gt; t t -&gt; Word32
</span><a href="#local-6989586621682883809"><span class="hs-identifier hs-var">hash_list</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883807"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmBranch"><span class="hs-identifier hs-type">CmmBranch</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">23</span></span><span> </span><span class="hs-comment">-- NB. ignore the label</span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCondBranch"><span class="hs-identifier hs-type">CmmCondBranch</span></a></span><span> </span><span id="local-6989586621682883817"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883817"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883817"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCall"><span class="hs-identifier hs-type">CmmCall</span></a></span><span> </span><span id="local-6989586621682883821"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883821"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BlockId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883821"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmForeignCall"><span class="hs-identifier hs-type">CmmForeignCall</span></a></span><span> </span><span id="local-6989586621682883825"><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682883825"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">[LocalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignTarget -&gt; Word32
</span><a href="#local-6989586621682883808"><span class="hs-identifier hs-var">hash_tgt</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682883825"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmSwitch"><span class="hs-identifier hs-type">CmmSwitch</span></a></span><span> </span><span id="local-6989586621682883829"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883829"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SwitchTargets
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883829"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><a href="#local-6989586621682883775"><span class="hs-identifier hs-var">hash_node</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O x
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Word32
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;hash_node: unknown Cmm node!&quot;</span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><a href="#local-6989586621682883793"><span class="hs-identifier hs-type">hash_reg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-157"></span><span>        </span><span id="local-6989586621682883793"><span class="annot"><span class="annottext">hash_reg :: CmmReg -&gt; Word32
</span><a href="#local-6989586621682883793"><span class="hs-identifier hs-var hs-var">hash_reg</span></a></span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmLocal"><span class="hs-identifier hs-type">CmmLocal</span></a></span><span> </span><span id="local-6989586621682883832"><span class="annot"><span class="annottext">LocalReg
</span><a href="#local-6989586621682883832"><span class="hs-identifier hs-var">localReg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalReg -&gt; Word32
forall a. Uniquable a =&gt; a -&gt; Word32
</span><a href="#local-6989586621682883833"><span class="hs-identifier hs-var">hash_unique</span></a></span><span> </span><span class="annot"><span class="annottext">LocalReg
</span><a href="#local-6989586621682883832"><span class="hs-identifier hs-var">localReg</span></a></span><span> </span><span class="hs-comment">-- important for performance, see #10397</span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="#local-6989586621682883793"><span class="hs-identifier hs-var">hash_reg</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-type">CmmGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRegUse
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">19</span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><a href="#local-6989586621682883794"><span class="hs-identifier hs-type">hash_e</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-161"></span><span>        </span><span id="local-6989586621682883794"><span class="annot"><span class="annottext">hash_e :: CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var hs-var">hash_e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span id="local-6989586621682883836"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883836"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; Word32
</span><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883836"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-type">CmmLoad</span></a></span><span> </span><span id="local-6989586621682883839"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883839"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">67</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883839"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span id="local-6989586621682883841"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883841"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; Word32
</span><a href="#local-6989586621682883793"><span class="hs-identifier hs-var">hash_reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883841"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="annot"><span class="annottext">MachOp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883843"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883843"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; Word32) -&gt; [CmmExpr] -&gt; Word32
forall {t :: * -&gt; *} {t}.
Foldable t =&gt;
(t -&gt; Word32) -&gt; t t -&gt; Word32
</span><a href="#local-6989586621682883809"><span class="hs-identifier hs-var">hash_list</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883843"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-comment">-- pessimal - no operator check</span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmRegOff"><span class="hs-identifier hs-type">CmmRegOff</span></a></span><span> </span><span id="local-6989586621682883845"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883845"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682883846"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883846"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; Word32
</span><a href="#local-6989586621682883793"><span class="hs-identifier hs-var">hash_reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883845"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
</span><a href="#local-6989586621682883847"><span class="hs-identifier hs-var">cvt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883846"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmStackSlot"><span class="hs-identifier hs-type">CmmStackSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Area
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">13</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><a href="#local-6989586621682883837"><span class="hs-identifier hs-type">hash_lit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span>
</span><span id="line-169"></span><span>        </span><span id="local-6989586621682883837"><span class="annot"><span class="annottext">hash_lit :: CmmLit -&gt; Word32
</span><a href="#local-6989586621682883837"><span class="hs-identifier hs-var hs-var">hash_lit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span id="local-6989586621682883850"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682883850"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word32
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682883850"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-170"></span><span>        </span><span class="annot"><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmFloat"><span class="hs-identifier hs-type">CmmFloat</span></a></span><span> </span><span id="local-6989586621682883852"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682883852"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Word32
forall b. Integral b =&gt; Rational -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">truncate</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621682883852"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmVec"><span class="hs-identifier hs-type">CmmVec</span></a></span><span> </span><span id="local-6989586621682883855"><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682883855"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; Word32) -&gt; [CmmLit] -&gt; Word32
forall {t :: * -&gt; *} {t}.
Foldable t =&gt;
(t -&gt; Word32) -&gt; t t -&gt; Word32
</span><a href="#local-6989586621682883809"><span class="hs-identifier hs-var">hash_list</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; Word32
</span><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmLit]
</span><a href="#local-6989586621682883855"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">119</span></span><span> </span><span class="hs-comment">-- ugh</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelOff"><span class="hs-identifier hs-type">CmmLabelOff</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883858"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883858"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
</span><a href="#local-6989586621682883847"><span class="hs-identifier hs-var">cvt</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word32) -&gt; Int -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">199</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883858"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelDiffOff"><span class="hs-identifier hs-type">CmmLabelDiffOff</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682883860"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883860"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
</span><a href="#local-6989586621682883847"><span class="hs-identifier hs-var">cvt</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word32) -&gt; Int -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">299</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883860"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">191</span></span><span> </span><span class="hs-comment">-- ugh</span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><a href="#local-6989586621682883837"><span class="hs-identifier hs-var">hash_lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmHighStackMark"><span class="hs-identifier hs-var">CmmHighStackMark</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
</span><a href="#local-6989586621682883847"><span class="hs-identifier hs-var">cvt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">313</span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>        </span><span id="local-6989586621682883808"><span class="annot"><span class="annottext">hash_tgt :: ForeignTarget -&gt; Word32
</span><a href="#local-6989586621682883808"><span class="hs-identifier hs-var hs-var">hash_tgt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a></span><span> </span><span id="local-6989586621682883865"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883865"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">ForeignConvention
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; Word32
</span><a href="#local-6989586621682883794"><span class="hs-identifier hs-var">hash_e</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883865"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><a href="#local-6989586621682883808"><span class="hs-identifier hs-var">hash_tgt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">31</span></span><span> </span><span class="hs-comment">-- lots of these</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>        </span><span id="local-6989586621682883809"><span class="annot"><span class="annottext">hash_list :: (t -&gt; Word32) -&gt; t t -&gt; Word32
</span><a href="#local-6989586621682883809"><span class="hs-identifier hs-var hs-var">hash_list</span></a></span></span><span> </span><span id="local-6989586621682883871"><span class="annot"><span class="annottext">t -&gt; Word32
</span><a href="#local-6989586621682883871"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; t -&gt; Word32) -&gt; Word32 -&gt; t t -&gt; Word32
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682883873"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682883873"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span id="local-6989586621682883874"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682883874"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; Word32
</span><a href="#local-6989586621682883871"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682883874"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682883873"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>        </span><span id="local-6989586621682883847"><span class="annot"><span class="annottext">cvt :: Int -&gt; Word32
</span><a href="#local-6989586621682883847"><span class="hs-identifier hs-var hs-var">cvt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word32
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Word32) -&gt; (Int -&gt; Integer) -&gt; Int -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-comment">-- Since we are hashing, we can savely downcast Word64 to Word32 here.</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-comment">-- Although a different hashing function may be more effective.</span><span>
</span><span id="line-187"></span><span>        </span><span id="local-6989586621682883522"><span class="annot"><a href="#local-6989586621682883833"><span class="hs-identifier hs-type">hash_unique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883522"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682883522"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span></span><span>
</span><span id="line-188"></span><span>        </span><span id="local-6989586621682883833"><span class="annot"><span class="annottext">hash_unique :: forall a. Uniquable a =&gt; a -&gt; Word32
</span><a href="#local-6989586621682883833"><span class="hs-identifier hs-var hs-var">hash_unique</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word32
</span><a href="GHC.Utils.Word64.html#truncateWord64ToWord32"><span class="hs-identifier hs-var">truncateWord64ToWord32</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Word32) -&gt; (a -&gt; Word64) -&gt; a -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Word64
</span><a href="GHC.Types.Unique.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Unique -&gt; Word64) -&gt; (a -&gt; Unique) -&gt; a -&gt; Word64
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="annot"><span class="hs-comment">-- | Ignore these node types for equality</span></span><span>
</span><span id="line-191"></span><span id="local-6989586621682883513"><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#dont_care"><span class="hs-identifier hs-type">dont_care</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682883513"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-192"></span><span id="dont_care"><span class="annot"><span class="annottext">dont_care :: forall (x :: Extensibility). CmmNode O x -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#dont_care"><span class="hs-identifier hs-var hs-var">dont_care</span></a></span></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmComment"><span class="hs-identifier hs-type">CmmComment</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-193"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#dont_care"><span class="hs-identifier hs-var">dont_care</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmTick"><span class="hs-identifier hs-type">CmmTick</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-194"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#dont_care"><span class="hs-identifier hs-var">dont_care</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnwind"><span class="hs-identifier hs-type">CmmUnwind</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-195"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#dont_care"><span class="hs-identifier hs-var">dont_care</span></a></span><span> </span><span id="local-6989586621682883900"><span class="annot"><span class="annottext">CmmNode O x
</span><a href="#local-6989586621682883900"><span class="hs-identifier hs-var">_other</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-comment">-- Utilities: equality and substitution on the graph.</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- Given a map ``subst'' from BlockID -&gt; BlockID, we define equality.</span><span>
</span><span id="line-200"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqBid"><span class="hs-identifier hs-type">eqBid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-201"></span><span id="eqBid"><span class="annot"><span class="annottext">eqBid :: LabelMap BlockId -&gt; BlockId -&gt; BlockId -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqBid"><span class="hs-identifier hs-var hs-var">eqBid</span></a></span></span><span> </span><span id="local-6989586621682883901"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883901"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682883902"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883902"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span id="local-6989586621682883903"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883903"><span class="hs-identifier hs-var">bid'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; BlockId -&gt; BlockId
</span><a href="GHC.Cmm.CommonBlockElim.html#lookupBid"><span class="hs-identifier hs-var">lookupBid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883901"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883902"><span class="hs-identifier hs-var">bid</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; BlockId -&gt; BlockId
</span><a href="GHC.Cmm.CommonBlockElim.html#lookupBid"><span class="hs-identifier hs-var">lookupBid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883901"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883903"><span class="hs-identifier hs-var">bid'</span></a></span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#lookupBid"><span class="hs-identifier hs-type">lookupBid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span>
</span><span id="line-203"></span><span id="lookupBid"><span class="annot"><span class="annottext">lookupBid :: LabelMap BlockId -&gt; BlockId -&gt; BlockId
</span><a href="GHC.Cmm.CommonBlockElim.html#lookupBid"><span class="hs-identifier hs-var hs-var">lookupBid</span></a></span></span><span> </span><span id="local-6989586621682883904"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883904"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682883905"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883905"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap BlockId -&gt; Maybe BlockId
forall a. BlockId -&gt; LabelMap a -&gt; Maybe a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883905"><span class="hs-identifier hs-var">bid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883904"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-204"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682883907"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883907"><span class="hs-identifier hs-var">bid</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; BlockId -&gt; BlockId
</span><a href="GHC.Cmm.CommonBlockElim.html#lookupBid"><span class="hs-identifier hs-var">lookupBid</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682883904"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883907"><span class="hs-identifier hs-var">bid</span></a></span><span>
</span><span id="line-205"></span><span>                        </span><span class="annot"><span class="annottext">Maybe BlockId
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883905"><span class="hs-identifier hs-var">bid</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Middle nodes and expressions can contain BlockIds, in particular in</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- CmmStackSlot and CmmBlock, so we have to use a special equality for</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- these.</span><span>
</span><span id="line-210"></span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqMiddleWith"><span class="hs-identifier hs-type">eqMiddleWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-213"></span><span id="eqMiddleWith"><span class="annot"><span class="annottext">eqMiddleWith :: (BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmNode O O -&gt; CmmNode O O -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqMiddleWith"><span class="hs-identifier hs-var hs-var">eqMiddleWith</span></a></span></span><span> </span><span id="local-6989586621682883909"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883909"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-type">CmmAssign</span></a></span><span> </span><span id="local-6989586621682883912"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883912"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621682883913"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883913"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-type">CmmAssign</span></a></span><span> </span><span id="local-6989586621682883917"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883917"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span id="local-6989586621682883918"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883918"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883912"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmReg -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883917"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqExprWith"><span class="hs-identifier hs-var">eqExprWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883909"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883913"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883918"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-215"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqMiddleWith"><span class="hs-identifier hs-var">eqMiddleWith</span></a></span><span> </span><span id="local-6989586621682883921"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883921"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span id="local-6989586621682883924"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883924"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621682883925"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883925"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span id="local-6989586621682883928"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883928"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span id="local-6989586621682883929"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883929"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqExprWith"><span class="hs-identifier hs-var">eqExprWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883921"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883924"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883928"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqExprWith"><span class="hs-identifier hs-var">eqExprWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883921"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883925"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883929"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-217"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqMiddleWith"><span class="hs-identifier hs-var">eqMiddleWith</span></a></span><span> </span><span id="local-6989586621682883930"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883930"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-type">CmmUnsafeForeignCall</span></a></span><span> </span><span id="local-6989586621682883933"><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682883933"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682883934"><span class="annot"><span class="annottext">[LocalReg]
</span><a href="#local-6989586621682883934"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621682883935"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883935"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-type">CmmUnsafeForeignCall</span></a></span><span> </span><span id="local-6989586621682883945"><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682883945"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682883946"><span class="annot"><span class="annottext">[LocalReg]
</span><a href="#local-6989586621682883946"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span id="local-6989586621682883947"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883947"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682883933"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignTarget -&gt; ForeignTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682883945"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[LocalReg]
</span><a href="#local-6989586621682883934"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">[LocalReg] -&gt; [LocalReg] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[LocalReg]
</span><a href="#local-6989586621682883946"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; CmmExpr -&gt; Bool) -&gt; [CmmExpr] -&gt; [CmmExpr] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqExprWith"><span class="hs-identifier hs-var">eqExprWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883930"><span class="hs-identifier hs-var">eqBid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883935"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883947"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-220"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqMiddleWith"><span class="hs-identifier hs-var">eqMiddleWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmmNode O O
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmmNode O O
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqExprWith"><span class="hs-identifier hs-type">eqExprWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-224"></span><span id="eqExprWith"><span class="annot"><span class="annottext">eqExprWith :: (BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqExprWith"><span class="hs-identifier hs-var hs-var">eqExprWith</span></a></span></span><span> </span><span id="local-6989586621682883948"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883948"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="#local-6989586621682883949"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-225"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span id="local-6989586621682883950"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883950"><span class="hs-identifier hs-var">l1</span></a></span></span><span>          </span><span id="local-6989586621682883949"><span class="annot"><span class="annottext">eq :: CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="#local-6989586621682883949"><span class="hs-operator hs-var hs-var">`eq`</span></a></span></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span id="local-6989586621682883951"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883951"><span class="hs-identifier hs-var">l2</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmLit -&gt; Bool
</span><a href="#local-6989586621682883952"><span class="hs-identifier hs-var">eqLit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883950"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883951"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-type">CmmLoad</span></a></span><span> </span><span id="local-6989586621682883953"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883953"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682883954"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682883954"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682883955"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682883955"><span class="hs-identifier hs-var">a1</span></a></span></span><span>   </span><span class="annot"><a href="#local-6989586621682883949"><span class="hs-operator hs-var">`eq`</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-type">CmmLoad</span></a></span><span> </span><span id="local-6989586621682883956"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883956"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621682883957"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682883957"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682883958"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682883958"><span class="hs-identifier hs-var">a2</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682883954"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; CmmType -&gt; Bool
</span><a href="GHC.Cmm.Type.html#cmmEqType"><span class="hs-operator hs-var">`cmmEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682883957"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883953"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="#local-6989586621682883949"><span class="hs-operator hs-var">`eq`</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883956"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682883955"><span class="hs-identifier hs-var">a1</span></a></span><span class="annot"><span class="annottext">AlignmentSpec -&gt; AlignmentSpec -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682883958"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span id="local-6989586621682883960"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883960"><span class="hs-identifier hs-var">r1</span></a></span></span><span>          </span><span class="annot"><a href="#local-6989586621682883949"><span class="hs-operator hs-var">`eq`</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span id="local-6989586621682883961"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883961"><span class="hs-identifier hs-var">r2</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883960"><span class="hs-identifier hs-var">r1</span></a></span><span class="annot"><span class="annottext">CmmReg -&gt; CmmReg -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883961"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmRegOff"><span class="hs-identifier hs-type">CmmRegOff</span></a></span><span> </span><span id="local-6989586621682883962"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883962"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621682883963"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883963"><span class="hs-identifier hs-var">i1</span></a></span></span><span>    </span><span class="annot"><a href="#local-6989586621682883949"><span class="hs-operator hs-var">`eq`</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmRegOff"><span class="hs-identifier hs-type">CmmRegOff</span></a></span><span> </span><span id="local-6989586621682883964"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883964"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span id="local-6989586621682883965"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883965"><span class="hs-identifier hs-var">i2</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883962"><span class="hs-identifier hs-var">r1</span></a></span><span class="annot"><span class="annottext">CmmReg -&gt; CmmReg -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682883964"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883963"><span class="hs-identifier hs-var">i1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883965"><span class="hs-identifier hs-var">i2</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682883966"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682883966"><span class="hs-identifier hs-var">op1</span></a></span></span><span> </span><span id="local-6989586621682883967"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883967"><span class="hs-identifier hs-var">es1</span></a></span></span><span>  </span><span class="annot"><a href="#local-6989586621682883949"><span class="hs-operator hs-var">`eq`</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682883968"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682883968"><span class="hs-identifier hs-var">op2</span></a></span></span><span> </span><span id="local-6989586621682883969"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883969"><span class="hs-identifier hs-var">es2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682883966"><span class="hs-identifier hs-var">op1</span></a></span><span class="annot"><span class="annottext">MachOp -&gt; MachOp -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682883968"><span class="hs-identifier hs-var">op2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; CmmExpr -&gt; Bool) -&gt; [CmmExpr] -&gt; [CmmExpr] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmExpr -&gt; Bool
</span><a href="#local-6989586621682883949"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883967"><span class="hs-identifier hs-var">es1</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682883969"><span class="hs-identifier hs-var">es2</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmStackSlot"><span class="hs-identifier hs-type">CmmStackSlot</span></a></span><span> </span><span id="local-6989586621682883970"><span class="annot"><span class="annottext">Area
</span><a href="#local-6989586621682883970"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span id="local-6989586621682883971"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883971"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621682883949"><span class="hs-operator hs-var">`eq`</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmStackSlot"><span class="hs-identifier hs-type">CmmStackSlot</span></a></span><span> </span><span id="local-6989586621682883972"><span class="annot"><span class="annottext">Area
</span><a href="#local-6989586621682883972"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span id="local-6989586621682883973"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883973"><span class="hs-identifier hs-var">i2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Area -&gt; Area -&gt; Bool
</span><a href="#local-6989586621682883974"><span class="hs-identifier hs-var">eqArea</span></a></span><span> </span><span class="annot"><span class="annottext">Area
</span><a href="#local-6989586621682883970"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Area
</span><a href="#local-6989586621682883972"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883971"><span class="hs-identifier hs-var">i1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682883973"><span class="hs-identifier hs-var">i2</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621682883975"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883975"><span class="hs-identifier hs-var">_e1</span></a></span></span><span>                </span><span class="annot"><a href="#local-6989586621682883949"><span class="hs-operator hs-var">`eq`</span></a></span><span> </span><span id="local-6989586621682883976"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682883976"><span class="hs-identifier hs-var">_e2</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621682883952"><span class="annot"><span class="annottext">eqLit :: CmmLit -&gt; CmmLit -&gt; Bool
</span><a href="#local-6989586621682883952"><span class="hs-identifier hs-var hs-var">eqLit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span id="local-6989586621682883977"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883977"><span class="hs-identifier hs-var">id1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span id="local-6989586621682883978"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883978"><span class="hs-identifier hs-var">id2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883948"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883977"><span class="hs-identifier hs-var">id1</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883978"><span class="hs-identifier hs-var">id2</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><a href="#local-6989586621682883952"><span class="hs-identifier hs-var">eqLit</span></a></span><span> </span><span id="local-6989586621682883979"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883979"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621682883980"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883980"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883979"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmLit -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621682883980"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621682883974"><span class="annot"><span class="annottext">eqArea :: Area -&gt; Area -&gt; Bool
</span><a href="#local-6989586621682883974"><span class="hs-identifier hs-var hs-var">eqArea</span></a></span></span><span> </span><span class="annot"><span class="annottext">Area
</span><a href="GHC.Cmm.Expr.html#Old"><span class="hs-identifier hs-var">Old</span></a></span><span> </span><span class="annot"><span class="annottext">Area
</span><a href="GHC.Cmm.Expr.html#Old"><span class="hs-identifier hs-var">Old</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="#local-6989586621682883974"><span class="hs-identifier hs-var">eqArea</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#Young"><span class="hs-identifier hs-type">Young</span></a></span><span> </span><span id="local-6989586621682883983"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883983"><span class="hs-identifier hs-var">id1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#Young"><span class="hs-identifier hs-type">Young</span></a></span><span> </span><span id="local-6989586621682883984"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883984"><span class="hs-identifier hs-var">id2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883948"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883983"><span class="hs-identifier hs-var">id1</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682883984"><span class="hs-identifier hs-var">id2</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="#local-6989586621682883974"><span class="hs-identifier hs-var">eqArea</span></a></span><span> </span><span class="annot"><span class="annottext">Area
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Area
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">-- Equality on the body of a block, modulo a function mapping block</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- IDs to block IDs.</span><span>
</span><span id="line-243"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqBlockBodyWith"><span class="hs-identifier hs-type">eqBlockBodyWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-244"></span><span id="eqBlockBodyWith"><span class="annot"><span class="annottext">eqBlockBodyWith :: (BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmBlock -&gt; CmmBlock -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqBlockBodyWith"><span class="hs-identifier hs-var hs-var">eqBlockBodyWith</span></a></span></span><span> </span><span id="local-6989586621682883985"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883985"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span id="local-6989586621682883986"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883986"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621682883987"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883987"><span class="hs-identifier hs-var">block'</span></a></span></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-comment">{-
  | equal     = pprTrace &quot;equal&quot; (vcat [ppr block, ppr block']) True
  | otherwise = pprTrace &quot;not equal&quot; (vcat [ppr block, ppr block']) False
  -}</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682883988"><span class="hs-identifier hs-var">equal</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682883989"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682883989"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682883990"><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682883990"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; (CmmNode C O, Block CmmNode O O, CmmNode O C)
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n C C -&gt; (n C O, Block n O O, n O C)
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883986"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span id="local-6989586621682883992"><span class="annot"><span class="annottext">nodes :: [CmmNode O O]
</span><a href="#local-6989586621682883992"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; Bool) -&gt; [CmmNode O O] -&gt; [CmmNode O O]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (CmmNode O O -&gt; Bool) -&gt; CmmNode O O -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CmmNode O O -&gt; Bool
forall (x :: Extensibility). CmmNode O x -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#dont_care"><span class="hs-identifier hs-var">dont_care</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block CmmNode O O -&gt; [CmmNode O O]
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n O O -&gt; [n O O]
</span><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682883989"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682883995"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682883995"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682883996"><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682883996"><span class="hs-identifier hs-var">l'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; (CmmNode C O, Block CmmNode O O, CmmNode O C)
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n C C -&gt; (n C O, Block n O O, n O C)
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682883987"><span class="hs-identifier hs-var">block'</span></a></span><span>
</span><span id="line-253"></span><span>        </span><span id="local-6989586621682883997"><span class="annot"><span class="annottext">nodes' :: [CmmNode O O]
</span><a href="#local-6989586621682883997"><span class="hs-identifier hs-var hs-var">nodes'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; Bool) -&gt; [CmmNode O O] -&gt; [CmmNode O O]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (CmmNode O O -&gt; Bool) -&gt; CmmNode O O -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CmmNode O O -&gt; Bool
forall (x :: Extensibility). CmmNode O x -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#dont_care"><span class="hs-identifier hs-var">dont_care</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block CmmNode O O -&gt; [CmmNode O O]
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n O O -&gt; [n O O]
</span><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621682883995"><span class="hs-identifier hs-var">m'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>        </span><span id="local-6989586621682883988"><span class="annot"><span class="annottext">equal :: Bool
</span><a href="#local-6989586621682883988"><span class="hs-identifier hs-var hs-var">equal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; CmmNode O O -&gt; Bool)
-&gt; [CmmNode O O] -&gt; [CmmNode O O] -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; [a] -&gt; [b] -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmNode O O -&gt; CmmNode O O -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqMiddleWith"><span class="hs-identifier hs-var">eqMiddleWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883985"><span class="hs-identifier hs-var">eqBid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmNode O O]
</span><a href="#local-6989586621682883992"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmNode O O]
</span><a href="#local-6989586621682883997"><span class="hs-identifier hs-var">nodes'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-256"></span><span>                </span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmNode O C -&gt; CmmNode O C -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqLastWith"><span class="hs-identifier hs-var">eqLastWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883985"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682883990"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621682883996"><span class="hs-identifier hs-var">l'</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqLastWith"><span class="hs-identifier hs-type">eqLastWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-260"></span><span id="eqLastWith"><span class="annot"><span class="annottext">eqLastWith :: (BlockId -&gt; BlockId -&gt; Bool) -&gt; CmmNode O C -&gt; CmmNode O C -&gt; Bool
</span><a href="GHC.Cmm.CommonBlockElim.html#eqLastWith"><span class="hs-identifier hs-var hs-var">eqLastWith</span></a></span></span><span> </span><span id="local-6989586621682883999"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883999"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmBranch"><span class="hs-identifier hs-type">CmmBranch</span></a></span><span> </span><span id="local-6989586621682884002"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884002"><span class="hs-identifier hs-var">bid1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmBranch"><span class="hs-identifier hs-type">CmmBranch</span></a></span><span> </span><span id="local-6989586621682884005"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884005"><span class="hs-identifier hs-var">bid2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682883999"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884002"><span class="hs-identifier hs-var">bid1</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884005"><span class="hs-identifier hs-var">bid2</span></a></span><span>
</span><span id="line-261"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqLastWith"><span class="hs-identifier hs-var">eqLastWith</span></a></span><span> </span><span id="local-6989586621682884006"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682884006"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCondBranch"><span class="hs-identifier hs-type">CmmCondBranch</span></a></span><span> </span><span id="local-6989586621682884009"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884009"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682884010"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884010"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682884011"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884011"><span class="hs-identifier hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621682884012"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682884012"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCondBranch"><span class="hs-identifier hs-type">CmmCondBranch</span></a></span><span> </span><span id="local-6989586621682884021"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884021"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621682884022"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884022"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682884023"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884023"><span class="hs-identifier hs-var">f2</span></a></span></span><span> </span><span id="local-6989586621682884024"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682884024"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884009"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmExpr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884021"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682884012"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682884024"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682884006"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884010"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884022"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682884006"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884011"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884023"><span class="hs-identifier hs-var">f2</span></a></span><span>
</span><span id="line-263"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqLastWith"><span class="hs-identifier hs-var">eqLastWith</span></a></span><span> </span><span id="local-6989586621682884025"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682884025"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCall"><span class="hs-identifier hs-type">CmmCall</span></a></span><span> </span><span id="local-6989586621682884028"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884028"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682884029"><span class="annot"><span class="annottext">Maybe BlockId
</span><a href="#local-6989586621682884029"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682884030"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682884030"><span class="hs-identifier hs-var">g1</span></a></span></span><span> </span><span id="local-6989586621682884031"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884031"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span id="local-6989586621682884032"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884032"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621682884033"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884033"><span class="hs-identifier hs-var">u1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCall"><span class="hs-identifier hs-type">CmmCall</span></a></span><span> </span><span id="local-6989586621682884045"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884045"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621682884046"><span class="annot"><span class="annottext">Maybe BlockId
</span><a href="#local-6989586621682884046"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621682884047"><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682884047"><span class="hs-identifier hs-var">g2</span></a></span></span><span> </span><span id="local-6989586621682884048"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884048"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span id="local-6989586621682884049"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884049"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span id="local-6989586621682884050"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884050"><span class="hs-identifier hs-var">u2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884028"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmExpr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884045"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool)
-&gt; Maybe BlockId -&gt; Maybe BlockId -&gt; Bool
forall a b. (a -&gt; b -&gt; Bool) -&gt; Maybe a -&gt; Maybe b -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../base-4.21.0.0-ae91/src/Data.Functor.Classes.html#liftEq"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682884025"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BlockId
</span><a href="#local-6989586621682884029"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BlockId
</span><a href="#local-6989586621682884046"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884031"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884048"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884032"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884049"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884033"><span class="hs-identifier hs-var">u1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682884050"><span class="hs-identifier hs-var">u2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682884030"><span class="hs-identifier hs-var">g1</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse] -&gt; [GlobalRegUse] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[GlobalRegUse]
</span><a href="#local-6989586621682884047"><span class="hs-identifier hs-var">g2</span></a></span><span>
</span><span id="line-265"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqLastWith"><span class="hs-identifier hs-var">eqLastWith</span></a></span><span> </span><span id="local-6989586621682884051"><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682884051"><span class="hs-identifier hs-var">eqBid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmSwitch"><span class="hs-identifier hs-type">CmmSwitch</span></a></span><span> </span><span id="local-6989586621682884054"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884054"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682884055"><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682884055"><span class="hs-identifier hs-var">ids1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmSwitch"><span class="hs-identifier hs-type">CmmSwitch</span></a></span><span> </span><span id="local-6989586621682884059"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884059"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621682884060"><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682884060"><span class="hs-identifier hs-var">ids2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884054"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmExpr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682884059"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; BlockId -&gt; Bool)
-&gt; SwitchTargets -&gt; SwitchTargets -&gt; Bool
</span><a href="GHC.Cmm.Switch.html#eqSwitchTargetWith"><span class="hs-identifier hs-var">eqSwitchTargetWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><a href="#local-6989586621682884051"><span class="hs-identifier hs-var">eqBid</span></a></span><span> </span><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682884055"><span class="hs-identifier hs-var">ids1</span></a></span><span> </span><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682884060"><span class="hs-identifier hs-var">ids2</span></a></span><span>
</span><span id="line-267"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#eqLastWith"><span class="hs-identifier hs-var">eqLastWith</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; BlockId -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- | Given a block map, ensure that all &quot;target&quot; blocks are covered by</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- the same ticks as the respective &quot;source&quot; blocks. This not only</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- means copying ticks, but also adjusting tick scopes where</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-273"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#copyTicks"><span class="hs-identifier hs-type">copyTicks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span>
</span><span id="line-274"></span><span id="copyTicks"><span class="annot"><span class="annottext">copyTicks :: LabelMap BlockId -&gt; CmmGraph -&gt; CmmGraph
</span><a href="GHC.Cmm.CommonBlockElim.html#copyTicks"><span class="hs-identifier hs-var hs-var">copyTicks</span></a></span></span><span> </span><span id="local-6989586621682884061"><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682884061"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682884062"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682884062"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId -&gt; Bool
forall a. LabelMap a -&gt; Bool
</span><a href="GHC.Cmm.Dataflow.Label.html#mapNull"><span class="hs-identifier hs-var">mapNull</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682884061"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682884062"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap CmmBlock -&gt; CmmGraph
</span><a href="GHC.Cmm.Utils.html#ofBlockMap"><span class="hs-identifier hs-var">ofBlockMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGraph -&gt; BlockId
forall (s :: * -&gt; *) (n :: Extensibility -&gt; Extensibility -&gt; *).
GenGenCmmGraph s n -&gt; BlockId
</span><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682884062"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LabelMap CmmBlock -&gt; CmmGraph) -&gt; LabelMap CmmBlock -&gt; CmmGraph
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CmmBlock -&gt; CmmBlock) -&gt; LabelMap CmmBlock -&gt; LabelMap CmmBlock
forall a v. (a -&gt; v) -&gt; LabelMap a -&gt; LabelMap v
</span><a href="GHC.Cmm.Dataflow.Label.html#mapMap"><span class="hs-identifier hs-var">mapMap</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; CmmBlock
</span><a href="#local-6989586621682884066"><span class="hs-identifier hs-var">copyTo</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap CmmBlock
</span><a href="#local-6989586621682884067"><span class="hs-identifier hs-var">blockMap</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- Reverse block merge map</span><span>
</span><span id="line-278"></span><span>        </span><span id="local-6989586621682884067"><span class="annot"><span class="annottext">blockMap :: LabelMap CmmBlock
</span><a href="#local-6989586621682884067"><span class="hs-identifier hs-var hs-var">blockMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmGraph -&gt; LabelMap CmmBlock
</span><a href="GHC.Cmm.html#toBlockMap"><span class="hs-identifier hs-var">toBlockMap</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682884062"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-279"></span><span>        </span><span id="local-6989586621682884069"><span class="annot"><span class="annottext">revEnv :: Map BlockId Key
</span><a href="#local-6989586621682884069"><span class="hs-identifier hs-var hs-var">revEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map BlockId Key -&gt; BlockId -&gt; BlockId -&gt; Map BlockId Key)
-&gt; Map BlockId Key -&gt; LabelMap BlockId -&gt; Map BlockId Key
forall t b. (t -&gt; BlockId -&gt; b -&gt; t) -&gt; t -&gt; LabelMap b -&gt; t
</span><a href="GHC.Cmm.Dataflow.Label.html#mapFoldlWithKey"><span class="hs-identifier hs-var">mapFoldlWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map BlockId Key -&gt; BlockId -&gt; BlockId -&gt; Map BlockId Key
forall {k} {a}. Ord k =&gt; Map k [a] -&gt; a -&gt; k -&gt; Map k [a]
</span><a href="#local-6989586621682884071"><span class="hs-identifier hs-var">insertRev</span></a></span><span> </span><span class="annot"><span class="annottext">Map BlockId Key
forall k a. Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap BlockId
</span><a href="#local-6989586621682884061"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span id="local-6989586621682884071"><span class="annot"><span class="annottext">insertRev :: Map k [a] -&gt; a -&gt; k -&gt; Map k [a]
</span><a href="#local-6989586621682884071"><span class="hs-identifier hs-var hs-var">insertRev</span></a></span></span><span> </span><span id="local-6989586621682884078"><span class="annot"><span class="annottext">Map k [a]
</span><a href="#local-6989586621682884078"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682884079"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884079"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682884080"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621682884080"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [a] -&gt; [a]) -&gt; k -&gt; [a] -&gt; Map k [a] -&gt; Map k [a]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([a] -&gt; [a]) -&gt; [a] -&gt; [a] -&gt; [a]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884079"><span class="hs-identifier hs-var">k</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621682884080"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884079"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Map k [a]
</span><a href="#local-6989586621682884078"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-comment">-- Copy ticks and scopes into the given block</span><span>
</span><span id="line-282"></span><span>        </span><span id="local-6989586621682884066"><span class="annot"><span class="annottext">copyTo :: CmmBlock -&gt; CmmBlock
</span><a href="#local-6989586621682884066"><span class="hs-identifier hs-var hs-var">copyTo</span></a></span></span><span> </span><span id="local-6989586621682884083"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682884083"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; Map BlockId Key -&gt; Maybe Key
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.7-5a8f/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmBlock -&gt; BlockId
forall (x :: Extensibility). Block CmmNode C x -&gt; BlockId
forall (thing :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
NonLocal thing =&gt;
thing C x -&gt; BlockId
</span><a href="GHC.Cmm.Dataflow.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682884083"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map BlockId Key
</span><a href="#local-6989586621682884069"><span class="hs-identifier hs-var">revEnv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-283"></span><span>          </span><span class="annot"><span class="annottext">Maybe Key
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682884083"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-284"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682884085"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621682884085"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CmmBlock -&gt; CmmBlock -&gt; CmmBlock)
-&gt; CmmBlock -&gt; DistinctBlocks -&gt; CmmBlock
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; CmmBlock -&gt; CmmBlock
forall {x :: Extensibility}.
CmmBlock -&gt; Block CmmNode C x -&gt; Block CmmNode C x
</span><a href="#local-6989586621682884087"><span class="hs-identifier hs-var">copy</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682884083"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">(DistinctBlocks -&gt; CmmBlock) -&gt; DistinctBlocks -&gt; CmmBlock
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BlockId -&gt; Maybe CmmBlock) -&gt; Key -&gt; DistinctBlocks
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BlockId -&gt; LabelMap CmmBlock -&gt; Maybe CmmBlock)
-&gt; LabelMap CmmBlock -&gt; BlockId -&gt; Maybe CmmBlock
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; LabelMap CmmBlock -&gt; Maybe CmmBlock
forall a. BlockId -&gt; LabelMap a -&gt; Maybe a
</span><a href="GHC.Cmm.Dataflow.Label.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap CmmBlock
</span><a href="#local-6989586621682884067"><span class="hs-identifier hs-var">blockMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621682884085"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span id="local-6989586621682884087"><span class="annot"><span class="annottext">copy :: CmmBlock -&gt; Block CmmNode C x -&gt; Block CmmNode C x
</span><a href="#local-6989586621682884087"><span class="hs-identifier hs-var hs-var">copy</span></a></span></span><span> </span><span id="local-6989586621682884090"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682884090"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621682884091"><span class="annot"><span class="annottext">Block CmmNode C x
</span><a href="#local-6989586621682884091"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682884092"><span class="annot"><span class="annottext">ticks :: [CmmTickish]
</span><a href="#local-6989586621682884092"><span class="hs-identifier hs-var hs-var">ticks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; [CmmTickish]
</span><a href="GHC.Cmm.Utils.html#blockTicks"><span class="hs-identifier hs-var">blockTicks</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682884090"><span class="hs-identifier hs-var">from</span></a></span><span>
</span><span id="line-287"></span><span>              </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmEntry"><span class="hs-identifier hs-type">CmmEntry</span></a></span><span>  </span><span class="annot"><span class="annottext">BlockId
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621682884097"><span class="annot"><span class="annottext">CmmTickScope
</span><a href="#local-6989586621682884097"><span class="hs-identifier hs-var">scp0</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; CmmNode C O
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
Block n C x -&gt; n C O
</span><a href="GHC.Cmm.Dataflow.Block.html#firstNode"><span class="hs-identifier hs-var">firstNode</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682884090"><span class="hs-identifier hs-var">from</span></a></span><span>
</span><span id="line-288"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmEntry"><span class="hs-identifier hs-type">CmmEntry</span></a></span><span> </span><span id="local-6989586621682884101"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884101"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682884102"><span class="annot"><span class="annottext">CmmTickScope
</span><a href="#local-6989586621682884102"><span class="hs-identifier hs-var">scp1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682884103"><span class="annot"><span class="annottext">Block CmmNode O x
</span><a href="#local-6989586621682884103"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode C x -&gt; (CmmNode C O, Block CmmNode O x)
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
Block n C x -&gt; (n C O, Block n O x)
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSplitHead"><span class="hs-identifier hs-var">blockSplitHead</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode C x
</span><a href="#local-6989586621682884091"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CmmTickScope -&gt; CmmNode C O
</span><a href="GHC.Cmm.Node.html#CmmEntry"><span class="hs-identifier hs-var">CmmEntry</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682884101"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmTickScope -&gt; CmmTickScope -&gt; CmmTickScope
</span><a href="GHC.Cmm.Node.html#combineTickScopes"><span class="hs-identifier hs-var">combineTickScopes</span></a></span><span> </span><span class="annot"><span class="annottext">CmmTickScope
</span><a href="#local-6989586621682884097"><span class="hs-identifier hs-var">scp0</span></a></span><span> </span><span class="annot"><span class="annottext">CmmTickScope
</span><a href="#local-6989586621682884102"><span class="hs-identifier hs-var">scp1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmNode C O -&gt; Block CmmNode O x -&gt; Block CmmNode C x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
n C O -&gt; Block n O x -&gt; Block n C x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockJoinHead"><span class="hs-operator hs-var">`blockJoinHead`</span></a></span><span>
</span><span id="line-290"></span><span>             </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; Block CmmNode O x -&gt; Block CmmNode O x)
-&gt; Block CmmNode O x -&gt; [CmmNode O O] -&gt; Block CmmNode O x
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">CmmNode O O -&gt; Block CmmNode O x -&gt; Block CmmNode O x
forall (n :: Extensibility -&gt; Extensibility -&gt; *)
       (x :: Extensibility).
n O O -&gt; Block n O x -&gt; Block n O x
</span><a href="GHC.Cmm.Dataflow.Block.html#blockCons"><span class="hs-identifier hs-var">blockCons</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O x
</span><a href="#local-6989586621682884103"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CmmTickish -&gt; CmmNode O O) -&gt; [CmmTickish] -&gt; [CmmNode O O]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CmmTickish -&gt; CmmNode O O
</span><a href="GHC.Cmm.Node.html#CmmTick"><span class="hs-identifier hs-var">CmmTick</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmTickish]
</span><a href="#local-6989586621682884092"><span class="hs-identifier hs-var">ticks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- Group by [Label]</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- See Note [Compressed TrieMap] in GHC.Core.Map.Expr about the usage of GenMap.</span><span>
</span><span id="line-294"></span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#groupByLabel"><span class="hs-identifier hs-type">groupByLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-295"></span><span id="groupByLabel"><span class="annot"><span class="annottext">groupByLabel :: [(Key, DistinctBlocks)] -&gt; [(Key, NonEmpty DistinctBlocks)]
</span><a href="GHC.Cmm.CommonBlockElim.html#groupByLabel"><span class="hs-identifier hs-var hs-var">groupByLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><span class="annottext">ListMap
  (GenMap LabelMap)
  (Key (ListMap (GenMap LabelMap)), NonEmpty DistinctBlocks)
-&gt; [(Key (ListMap (GenMap LabelMap)), DistinctBlocks)]
-&gt; [(Key (ListMap (GenMap LabelMap)), NonEmpty DistinctBlocks)]
forall {m :: * -&gt; *} {a}.
TrieMap m =&gt;
m (Key m, NonEmpty a) -&gt; [(Key m, a)] -&gt; [(Key m, NonEmpty a)]
</span><a href="#local-6989586621682884108"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ListMap (GenMap LabelMap) (Key, NonEmpty DistinctBlocks)
forall a. ListMap (GenMap LabelMap) a
forall (m :: * -&gt; *) a. TrieMap m =&gt; m a
</span><a href="GHC.Data.TrieMap.html#emptyTM"><span class="hs-identifier hs-var">TM.emptyTM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">TM.ListMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#GenMap"><span class="hs-identifier hs-type">TM.GenMap</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#DistinctBlocks"><span class="hs-identifier hs-type">DistinctBlocks</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>      </span><span id="local-6989586621682884108"><span class="annot"><span class="annottext">go :: m (Key m, NonEmpty a) -&gt; [(Key m, a)] -&gt; [(Key m, NonEmpty a)]
</span><a href="#local-6989586621682884108"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682884118"><span class="annot"><span class="annottext">m (Key m, NonEmpty a)
</span><a href="#local-6989586621682884118"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Key m, NonEmpty a)
 -&gt; [(Key m, NonEmpty a)] -&gt; [(Key m, NonEmpty a)])
-&gt; m (Key m, NonEmpty a)
-&gt; [(Key m, NonEmpty a)]
-&gt; [(Key m, NonEmpty a)]
forall a b. (a -&gt; b -&gt; b) -&gt; m a -&gt; b -&gt; b
forall (m :: * -&gt; *) a b.
TrieMap m =&gt;
(a -&gt; b -&gt; b) -&gt; m a -&gt; b -&gt; b
</span><a href="GHC.Data.TrieMap.html#foldTM"><span class="hs-identifier hs-var">TM.foldTM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Key m, NonEmpty a)
</span><a href="#local-6989586621682884118"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span>      </span><span class="annot"><a href="#local-6989586621682884108"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682884120"><span class="annot"><span class="annottext">m (Key m, NonEmpty a)
</span><a href="#local-6989586621682884120"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682884121"><span class="annot"><span class="annottext">Key m
</span><a href="#local-6989586621682884121"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682884122"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884122"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682884123"><span class="annot"><span class="annottext">[(Key m, a)]
</span><a href="#local-6989586621682884123"><span class="hs-identifier hs-var">entries</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Key m, NonEmpty a) -&gt; [(Key m, a)] -&gt; [(Key m, NonEmpty a)]
</span><a href="#local-6989586621682884108"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key m
-&gt; XT (Key m, NonEmpty a)
-&gt; m (Key m, NonEmpty a)
-&gt; m (Key m, NonEmpty a)
forall b. Key m -&gt; XT b -&gt; m b -&gt; m b
forall (m :: * -&gt; *) b. TrieMap m =&gt; Key m -&gt; XT b -&gt; m b -&gt; m b
</span><a href="GHC.Data.TrieMap.html#alterTM"><span class="hs-identifier hs-var">TM.alterTM</span></a></span><span> </span><span class="annot"><span class="annottext">Key m
</span><a href="#local-6989586621682884121"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">XT (Key m, NonEmpty a)
</span><a href="#local-6989586621682884125"><span class="hs-identifier hs-var">adjust</span></a></span><span> </span><span class="annot"><span class="annottext">m (Key m, NonEmpty a)
</span><a href="#local-6989586621682884120"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Key m, a)]
</span><a href="#local-6989586621682884123"><span class="hs-identifier hs-var">entries</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">--k' = map (getKey . getUnique) k</span><span>
</span><span id="line-301"></span><span>              </span><span id="local-6989586621682884125"><span class="annot"><span class="annottext">adjust :: XT (Key m, NonEmpty a)
</span><a href="#local-6989586621682884125"><span class="hs-identifier hs-var hs-var">adjust</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Key m, NonEmpty a)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Key m, NonEmpty a) -&gt; Maybe (Key m, NonEmpty a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key m
</span><a href="#local-6989586621682884121"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; NonEmpty a
forall a. a -&gt; NonEmpty a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884122"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>              </span><span class="annot"><a href="#local-6989586621682884125"><span class="hs-identifier hs-var">adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key m
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682884126"><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621682884126"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Key m, NonEmpty a) -&gt; Maybe (Key m, NonEmpty a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key m
</span><a href="#local-6989586621682884121"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884122"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; NonEmpty a -&gt; NonEmpty a
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#%3C%7C"><span class="hs-operator hs-var">NE.&lt;|</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621682884126"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="local-6989586621682883469"><span class="annot"><a href="GHC.Cmm.CommonBlockElim.html#groupByInt"><span class="hs-identifier hs-type">groupByInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682883469"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682883469"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682883469"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span></span><span>
</span><span id="line-305"></span><span id="groupByInt"><span class="annot"><span class="annottext">groupByInt :: forall a. (a -&gt; Int) -&gt; [a] -&gt; [[a]]
</span><a href="GHC.Cmm.CommonBlockElim.html#groupByInt"><span class="hs-identifier hs-var hs-var">groupByInt</span></a></span></span><span> </span><span id="local-6989586621682884131"><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621682884131"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682884132"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884132"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM Int [a] -&gt; [[a]]
forall {k} (key :: k) elt. UniqFM key elt -&gt; [elt]
</span><a href="GHC.Types.Unique.FM.html#nonDetEltsUFM"><span class="hs-identifier hs-var">nonDetEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqFM Int [a] -&gt; [[a]]) -&gt; UniqFM Int [a] -&gt; [[a]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(UniqFM Int [a] -&gt; a -&gt; UniqFM Int [a])
-&gt; UniqFM Int [a] -&gt; [a] -&gt; UniqFM Int [a]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="annot"><span class="annottext">UniqFM Int [a] -&gt; a -&gt; UniqFM Int [a]
</span><a href="#local-6989586621682884134"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Int [a]
forall {k} (key :: k) elt. UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682884132"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-306"></span><span>   </span><span class="hs-comment">-- See Note [Unique Determinism and code generation]</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621682884134"><span class="annot"><span class="annottext">go :: UniqFM Int [a] -&gt; a -&gt; UniqFM Int [a]
</span><a href="#local-6989586621682884134"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682884136"><span class="annot"><span class="annottext">UniqFM Int [a]
</span><a href="#local-6989586621682884136"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682884137"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884137"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe [a] -&gt; Maybe [a]) -&gt; UniqFM Int [a] -&gt; Int -&gt; UniqFM Int [a]
forall key elt.
Uniquable key =&gt;
(Maybe elt -&gt; Maybe elt) -&gt; UniqFM key elt -&gt; key -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#alterUFM"><span class="hs-identifier hs-var">alterUFM</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [a] -&gt; Maybe [a]
</span><a href="#local-6989586621682884139"><span class="hs-identifier hs-var">addEntry</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Int [a]
</span><a href="#local-6989586621682884136"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621682884131"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884137"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-310"></span><span>        </span><span id="local-6989586621682884139"><span class="annot"><span class="annottext">addEntry :: Maybe [a] -&gt; Maybe [a]
</span><a href="#local-6989586621682884139"><span class="hs-identifier hs-var hs-var">addEntry</span></a></span></span><span> </span><span id="local-6989586621682884140"><span class="annot"><span class="annottext">Maybe [a]
</span><a href="#local-6989586621682884140"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; Maybe [a]) -&gt; [a] -&gt; Maybe [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; ([a] -&gt; [a]) -&gt; Maybe [a] -&gt; [a]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884137"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682884137"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [a]
</span><a href="#local-6989586621682884140"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-311"></span></pre></body></html>