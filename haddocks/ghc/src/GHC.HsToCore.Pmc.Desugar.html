<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs             #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DisambiguateRecordFields #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | Desugaring step of the</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- [Lower Your Guards paper](https://dl.acm.org/doi/abs/10.1145/3408989).</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Desugars Haskell source syntax into guard tree variants Pm*.</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- In terms of the paper, this module is concerned with Sections 3.1, Figure 4,</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- in particular.</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html"><span class="hs-identifier">GHC.HsToCore.Pmc.Desugar</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>      </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPatBind"><span class="hs-identifier">desugarPatBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarGRHSs"><span class="hs-identifier">desugarGRHSs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarMatches"><span class="hs-identifier">desugarMatches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarEmptyCase"><span class="hs-identifier">desugarEmptyCase</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html"><span class="hs-identifier">GHC.HsToCore.Pmc.Types</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Utils.html"><span class="hs-identifier">GHC.HsToCore.Pmc.Utils</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier">Expr</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier">App</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier">unpackFS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#lengthFS"><span class="hs-identifier">lengthFS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#shortCutLit"><span class="hs-identifier">shortCutLit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Names.html#rationalTyConName"><span class="hs-identifier">rationalTyConName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#toListName"><span class="hs-identifier">toListName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier">EvVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier">HsWrapper</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#isIdHsWrapper"><span class="hs-identifier">isIdHsWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html"><span class="hs-identifier">GHC.HsToCore.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsExpr"><span class="hs-identifier">dsExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier">dsLExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsSyntaxExpr"><span class="hs-identifier">dsSyntaxExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html"><span class="hs-identifier">GHC.HsToCore.Binds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier">dsHsWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html"><span class="hs-identifier">GHC.HsToCore.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier">isTrueLHsExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier">selectMatchVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#decideBangHood"><span class="hs-identifier">decideBangHood</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html#checkMultiplicityCoercions"><span class="hs-identifier">checkMultiplicityCoercions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Match.Literal.html"><span class="hs-identifier">GHC.HsToCore.Match.Literal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Match.Literal.html#dsLit"><span class="hs-identifier">dsLit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Match.Literal.html#dsOverLit"><span class="hs-identifier">dsOverLit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html"><span class="hs-identifier">GHC.Core.TyCo.Compare</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier">eqType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SourceText.html#FractionalLit"><span class="hs-identifier">FractionalLit</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">zipWithM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">replicateM</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">elemIndex</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">-- import GHC.Driver.Ppr</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><span class="hs-comment">-- | Smart constructor that eliminates trivial lets</span></span><span>
</span><span id="line-56"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLetVar"><span class="hs-identifier hs-type">mkPmLetVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-57"></span><span id="mkPmLetVar"><span class="annot"><span class="annottext">mkPmLetVar :: Id -&gt; Id -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLetVar"><span class="hs-identifier hs-var hs-var">mkPmLetVar</span></a></span></span><span> </span><span id="local-6989586621683128398"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128398"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683128399"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128399"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PmGrd] -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#sequencePmGrds"><span class="hs-identifier hs-var">sequencePmGrds</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-var">PmLet</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128398"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128399"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128398"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128399"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="annot"><span class="hs-comment">-- | ADT constructor pattern =&gt; no existentials, no local constraints</span></span><span>
</span><span id="line-60"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-type">vanillaConGrd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmGrd"><span class="hs-identifier hs-type">PmGrd</span></a></span><span>
</span><span id="line-61"></span><span id="vanillaConGrd"><span class="annot"><span class="annottext">vanillaConGrd :: Id -&gt; DataCon -&gt; [Id] -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-var hs-var">vanillaConGrd</span></a></span></span><span> </span><span id="local-6989586621683128404"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128404"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621683128405"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683128405"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621683128406"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128406"><span class="hs-identifier hs-var">arg_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmCon"><span class="hs-identifier hs-type">PmCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pm_id :: Id
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_id"><span class="hs-identifier hs-var">pm_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128404"><span class="hs-identifier hs-var">scrut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pm_con_con :: PmAltCon
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_con_con"><span class="hs-identifier hs-var">pm_con_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-var">PmAltConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621683128405"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pm_con_tvs :: [Id]
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_con_tvs"><span class="hs-identifier hs-var">pm_con_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pm_con_dicts :: [Id]
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_con_dicts"><span class="hs-identifier hs-var">pm_con_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pm_con_args :: [Id]
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_con_args"><span class="hs-identifier hs-var">pm_con_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128406"><span class="hs-identifier hs-var">arg_ids</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Creates a 'GrdDag' refining a match var of list type to a list,</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- where list fields are matched against the incoming tagged 'GrdDag's.</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- For example:</span><span>
</span><span id="line-68"></span><span class="hs-comment">--   @mkListGrds &quot;a&quot; &quot;[(x, True &lt;- x),(y, !y)]&quot;@</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- to</span><span>
</span><span id="line-70"></span><span class="hs-comment">--   @&quot;[(x:b) &lt;- a, True &lt;- x, (y:c) &lt;- b, !y, [] &lt;- c]&quot;@</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- where @b@ and @c@ are freshly allocated in @mkListGrds@ and @a@ is the match</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- variable.</span><span>
</span><span id="line-73"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkListGrds"><span class="hs-identifier hs-type">mkListGrds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- See Note [Order of guards matters] for why we need to intertwine guards</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- on list elements.</span><span>
</span><span id="line-76"></span><span id="mkListGrds"><span class="annot"><span class="annottext">mkListGrds :: Id -&gt; [(Id, GrdDag)] -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#mkListGrds"><span class="hs-identifier hs-var hs-var">mkListGrds</span></a></span></span><span> </span><span id="local-6989586621683128416"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128416"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmGrd -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdOne"><span class="hs-identifier hs-var">GdOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; DataCon -&gt; [Id] -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-var">vanillaConGrd</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128416"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#nilDataCon"><span class="hs-identifier hs-var">nilDataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkListGrds"><span class="hs-identifier hs-var">mkListGrds</span></a></span><span> </span><span id="local-6989586621683128419"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128419"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621683128420"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128420"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128421"><span class="annot"><span class="annottext">GrdDag
</span><a href="#local-6989586621683128421"><span class="hs-identifier hs-var">head_grds</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621683128422"><span class="annot"><span class="annottext">[(Id, GrdDag)]
</span><a href="#local-6989586621683128422"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621683128423"><span class="annot"><a href="#local-6989586621683128423"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128419"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621683128426"><span class="annot"><a href="#local-6989586621683128426"><span class="hs-identifier hs-var">tail_grds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkListGrds"><span class="hs-identifier hs-type">mkListGrds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128423"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128422"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-type">vanillaConGrd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128419"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#consDataCon"><span class="hs-identifier hs-type">consDataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683128420"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683128423"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#consGrdDag"><span class="hs-operator hs-type">`consGrdDag`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128421"><span class="hs-identifier hs-type">head_grds</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#gdSeq"><span class="hs-operator hs-type">`gdSeq`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128426"><span class="hs-identifier hs-type">tail_grds</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="annot"><span class="hs-comment">-- | Create a 'GrdDag' refining a match variable to a 'PmLit'.</span></span><span>
</span><span id="line-83"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLitGrds"><span class="hs-identifier hs-type">mkPmLitGrds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-84"></span><span id="mkPmLitGrds"><span class="annot"><span class="annottext">mkPmLitGrds :: Id -&gt; PmLit -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLitGrds"><span class="hs-identifier hs-var hs-var">mkPmLitGrds</span></a></span></span><span> </span><span id="local-6989586621683128432"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128432"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLitString"><span class="hs-identifier hs-type">PmLitString</span></a></span><span> </span><span id="local-6989586621683128434"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683128434"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-comment">-- We desugar String literals to list literals for better overlap reasoning.</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-comment">-- It's a little unfortunate we do this here rather than in</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-comment">-- 'GHC.HsToCore.Pmc.Solver.trySolve' and</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-comment">-- 'GHC.HsToCore.Pmc.Solver.addRefutableAltCon', but it's so much simpler</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- here. See Note [Representation of Strings in TmState] in</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- GHC.HsToCore.Pmc.Solver</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621683128435"><span class="annot"><a href="#local-6989586621683128435"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DsM Id -&gt; IOEnv (Env DsGblEnv DsLclEnv) [Id]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#lengthFS"><span class="hs-identifier hs-var">lengthFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621683128434"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#charTy"><span class="hs-identifier hs-var">charTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128437"><span class="annot"><a href="#local-6989586621683128437"><span class="hs-identifier hs-var hs-var">mk_char_lit</span></a></span></span><span> </span><span id="local-6989586621683128438"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128438"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621683128439"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683128439"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; PmLit -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLitGrds"><span class="hs-identifier hs-var">mkPmLitGrds</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128438"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; PmLitValue -&gt; PmLit
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#charTy"><span class="hs-identifier hs-var">charTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; PmLitValue
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLitChar"><span class="hs-identifier hs-var">PmLitChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621683128439"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>  </span><span id="local-6989586621683128441"><span class="annot"><a href="#local-6989586621683128441"><span class="hs-identifier hs-var">char_grdss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWithM</span></span><span> </span><span class="annot"><a href="#local-6989586621683128437"><span class="hs-identifier hs-type">mk_char_lit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128435"><span class="hs-identifier hs-type">vars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-type">unpackFS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128434"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkListGrds"><span class="hs-identifier hs-type">mkListGrds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128432"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="annot"><a href="#local-6989586621683128435"><span class="hs-identifier hs-type">vars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128441"><span class="hs-identifier hs-type">char_grdss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLitGrds"><span class="hs-identifier hs-var">mkPmLitGrds</span></a></span><span> </span><span id="local-6989586621683128442"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128442"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683128443"><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621683128443"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128444"><span class="annot"><span class="annottext">grd :: PmGrd
</span><a href="#local-6989586621683128444"><span class="hs-identifier hs-var hs-var">grd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmCon"><span class="hs-identifier hs-type">PmCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pm_id :: Id
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_id"><span class="hs-identifier hs-var">pm_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128442"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-97"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pm_con_con :: PmAltCon
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_con_con"><span class="hs-identifier hs-var">pm_con_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmLit -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltLit"><span class="hs-identifier hs-var">PmAltLit</span></a></span><span> </span><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621683128443"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-98"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pm_con_tvs :: [Id]
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_con_tvs"><span class="hs-identifier hs-var">pm_con_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-99"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pm_con_dicts :: [Id]
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_con_dicts"><span class="hs-identifier hs-var">pm_con_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-100"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pm_con_args :: [Id]
</span><a href="GHC.HsToCore.Pmc.Types.html#pm_con_args"><span class="hs-identifier hs-var">pm_con_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmGrd -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdOne"><span class="hs-identifier hs-var">GdOne</span></a></span><span> </span><span class="annot"><span class="annottext">PmGrd
</span><a href="#local-6989586621683128444"><span class="hs-identifier hs-var">grd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | @desugarPat _ x pat@ transforms @pat@ into a 'GrdDag', where</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- the variable representing the match is @x@.</span><span>
</span><span id="line-105"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPat"><span class="hs-identifier hs-type">desugarPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-106"></span><span id="desugarPat"><span class="annot"><span class="annottext">desugarPat :: Id -&gt; Pat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPat"><span class="hs-identifier hs-var hs-var">desugarPat</span></a></span></span><span> </span><span id="local-6989586621683128447"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683128448"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128448"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128448"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#WildPat"><span class="hs-identifier hs-type">WildPat</span></a></span><span>  </span><span id="local-6989586621683128450"><span class="annot"><span class="annottext">XWildPat GhcTc
</span><a href="#local-6989586621683128450"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdEnd"><span class="hs-identifier hs-var">GdEnd</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="annot"><span class="annottext">XVarPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128453"><span class="annot"><span class="annottext">LIdP GhcTc
</span><a href="#local-6989586621683128453"><span class="hs-identifier hs-var">y</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLetVar"><span class="hs-identifier hs-var">mkPmLetVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Id -&gt; Id
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcTc
GenLocated SrcSpanAnnN Id
</span><a href="#local-6989586621683128453"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128456"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128456"><span class="hs-identifier hs-var">p</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; LPat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-var">desugarLPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128456"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-type">LazyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XLazyPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdEnd"><span class="hs-identifier hs-var">GdEnd</span></a></span><span> </span><span class="hs-comment">-- like a wildcard</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span> </span><span class="annot"><span class="annottext">XBangPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128460"><span class="annot"><span class="annottext">p :: LPat GhcTc
</span><a href="#local-6989586621683128460"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683128462"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683128462"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621683128463"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128463"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- Add the bang in front of the list, because it will happen before any</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- nested stuff.</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">PmGrd -&gt; GrdDag -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#consGrdDag"><span class="hs-identifier hs-var">consGrdDag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Maybe SrcInfo -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Types.html#PmBang"><span class="hs-identifier hs-var">PmBang</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcInfo
</span><a href="#local-6989586621683128465"><span class="hs-identifier hs-var">pm_loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GrdDag -&gt; GrdDag) -&gt; DsM GrdDag -&gt; DsM GrdDag
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; LPat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-var">desugarLPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128460"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621683128465"><span class="annot"><span class="annottext">pm_loc :: Maybe SrcInfo
</span><a href="#local-6989586621683128465"><span class="hs-identifier hs-var hs-var">pm_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcInfo -&gt; Maybe SrcInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located SDoc -&gt; SrcInfo
</span><a href="GHC.HsToCore.Pmc.Types.html#SrcInfo"><span class="hs-identifier hs-var">SrcInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; Located SDoc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683128462"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128463"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-comment">-- (x@pat)   ==&gt;   Desugar pat with x as match var and handle impedance</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-comment">--                 mismatch with incoming match var</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-type">AsPat</span></a></span><span> </span><span class="annot"><span class="annottext">XAsPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128471"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128471"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683128472"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128472"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLetVar"><span class="hs-identifier hs-var">mkPmLetVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128471"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; GrdDag -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#gdSeq"><span class="hs-operator hs-var">`gdSeq`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GrdDag -&gt; GrdDag) -&gt; DsM GrdDag -&gt; DsM GrdDag
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; LPat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-var">desugarLPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128471"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128472"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SigPat"><span class="hs-identifier hs-type">SigPat</span></a></span><span> </span><span class="annot"><span class="annottext">XSigPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128474"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128474"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683128475"><span class="annot"><span class="annottext">HsPatSigType (NoGhcTc GhcTc)
</span><a href="#local-6989586621683128475"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; LPat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-var">desugarLPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128474"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#EmbTyPat"><span class="hs-identifier hs-type">EmbTyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTyPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc GhcTc)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdEnd"><span class="hs-identifier hs-var">GdEnd</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#InvisPat"><span class="hs-identifier hs-type">InvisPat</span></a></span><span> </span><span class="annot"><span class="annottext">XInvisPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc GhcTc)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdEnd"><span class="hs-identifier hs-var">GdEnd</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#XPat"><span class="hs-identifier hs-type">XPat</span></a></span><span> </span><span id="local-6989586621683128479"><span class="annot"><span class="annottext">XXPat GhcTc
</span><a href="#local-6989586621683128479"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">XXPat GhcTc
</span><a href="#local-6989586621683128479"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="GHC.Hs.Pat.html#ExpansionPat"><span class="hs-identifier hs-type">ExpansionPat</span></a></span><span> </span><span id="local-6989586621683128481"><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621683128481"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621683128482"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128482"><span class="hs-identifier hs-var">expansion</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621683128481"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-comment">-- We add special logic for overloaded list patterns. When:</span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-comment">--   - a ViewPat is the expansion of a ListPat,</span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-comment">--   - the type of the pattern is the built-in list type,</span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-comment">-- then we assume that the view function, 'toList', is the identity.</span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-comment">-- This improves pattern-match overload checks, as this will allow</span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-comment">-- the pattern match checker to directly inspect the inner pattern.</span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-comment">-- See #14547, and Note [Desugaring overloaded list patterns] (Wrinkle).</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-type">ListPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ViewPat"><span class="hs-identifier hs-type">ViewPat</span></a></span><span> </span><span id="local-6989586621683128485"><span class="annot"><span class="annottext">XViewPat GhcTc
</span><a href="#local-6989586621683128485"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span id="local-6989586621683128486"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128486"><span class="hs-identifier hs-var">lrhs</span></a></span></span><span> </span><span id="local-6989586621683128487"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128487"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128482"><span class="hs-identifier hs-var">expansion</span></a></span><span>
</span><span id="line-137"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683128488"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683128488"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">XViewPat GhcTc
Kind
</span><a href="#local-6989586621683128485"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-138"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683128488"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#listTyCon"><span class="hs-identifier hs-var">listTyCon</span></a></span><span>
</span><span id="line-139"></span><span>          </span><span class="hs-comment">-- `pat` looks like `coerce toList -&gt; [p1,...,pn]`.</span><span>
</span><span id="line-140"></span><span>          </span><span class="hs-comment">-- Now take care of -XRebindableSyntax:</span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128492"><span class="annot"><span class="annottext">is_to_list :: HsExpr GhcTc -&gt; Bool
</span><a href="#local-6989586621683128492"><span class="hs-identifier hs-var hs-var">is_to_list</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128494"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128494"><span class="hs-identifier hs-var">to_list</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128494"><span class="hs-identifier hs-var">to_list</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#toListName"><span class="hs-identifier hs-var">toListName</span></a></span><span>
</span><span id="line-142"></span><span>                </span><span class="annot"><a href="#local-6989586621683128492"><span class="hs-identifier hs-var">is_to_list</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#WrapExpr"><span class="hs-identifier hs-type">WrapExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128498"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683128498"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Bool
</span><a href="#local-6989586621683128492"><span class="hs-identifier hs-var">is_to_list</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683128498"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-143"></span><span>                </span><span class="annot"><a href="#local-6989586621683128492"><span class="hs-identifier hs-var">is_to_list</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><span class="hs-identifier">_</span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-144"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Bool
</span><a href="#local-6989586621683128492"><span class="hs-identifier hs-var">is_to_list</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; HsExpr GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683128486"><span class="hs-identifier hs-var">lrhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; LPat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-var">desugarLPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128487"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>        </span><span class="annot"><span class="annottext">Pat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Pat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPat"><span class="hs-identifier hs-var">desugarPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128482"><span class="hs-identifier hs-var">expansion</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-comment">-- See Note [Desugar CoPats]</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">-- Generally the translation is</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-comment">-- pat |&gt; co   ===&gt;   let y = x |&gt; co, pat &lt;- y  where y is a match var of pat</span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="GHC.Hs.Pat.html#CoPat"><span class="hs-identifier hs-type">CoPat</span></a></span><span> </span><span id="local-6989586621683128500"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683128500"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span> </span><span id="local-6989586621683128501"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128501"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683128502"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683128502"><span class="hs-identifier hs-var">_ty</span></a></span></span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; Bool
</span><a href="GHC.Tc.Types.Evidence.html#isIdHsWrapper"><span class="hs-identifier hs-var">isIdHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683128500"><span class="hs-identifier hs-var">wrapper</span></a></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Pat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPat"><span class="hs-identifier hs-var">desugarPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128501"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-154"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#WpCast"><span class="hs-identifier hs-type">WpCast</span></a></span><span> </span><span id="local-6989586621683128504"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683128504"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683128500"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621683128504"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Pat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPat"><span class="hs-identifier hs-var">desugarPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128501"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-155"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-156"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621683128506"><span class="annot"><a href="#local-6989586621683128506"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128507"><span class="annot"><a href="#local-6989586621683128507"><span class="hs-identifier hs-var">grds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPatV"><span class="hs-identifier hs-var">desugarPatV</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128501"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-157"></span><span>          </span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-type">dsHsWrapper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128500"><span class="hs-identifier hs-type">wrapper</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621683128509"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683128509"><span class="hs-identifier hs-var">wrap_rhs_y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>            </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-var">PmLet</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128506"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621683128509"><span class="hs-identifier hs-var">wrap_rhs_y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PmGrd -&gt; GrdDag -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#consGrdDag"><span class="hs-operator hs-var">`consGrdDag`</span></a></span><span> </span><span class="annot"><span class="annottext">GrdDag
</span><a href="#local-6989586621683128507"><span class="hs-identifier hs-var">grds</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- (n + k)  ===&gt;   let b = x &gt;= k, True &lt;- b, let n = x-k</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPlusKPat"><span class="hs-identifier hs-type">NPlusKPat</span></a></span><span> </span><span id="local-6989586621683128511"><span class="annot"><span class="annottext">XNPlusKPat GhcTc
</span><a href="#local-6989586621683128511"><span class="hs-identifier hs-var">_pat_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128512"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128512"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683128513"><span class="annot"><span class="annottext">XRec GhcTc (HsOverLit GhcTc)
</span><a href="#local-6989586621683128513"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621683128514"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621683128514"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span id="local-6989586621683128515"><span class="annot"><span class="annottext">SyntaxExpr GhcTc
</span><a href="#local-6989586621683128515"><span class="hs-identifier hs-var">ge</span></a></span></span><span> </span><span id="local-6989586621683128516"><span class="annot"><span class="annottext">SyntaxExpr GhcTc
</span><a href="#local-6989586621683128516"><span class="hs-identifier hs-var">minus</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621683128517"><span class="annot"><a href="#local-6989586621683128517"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128519"><span class="annot"><a href="#local-6989586621683128519"><span class="hs-identifier hs-var hs-var">grd_b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; DataCon -&gt; [Id] -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-var">vanillaConGrd</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128517"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#trueDataCon"><span class="hs-identifier hs-var">trueDataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621683128521"><span class="annot"><a href="#local-6989586621683128521"><span class="hs-identifier hs-var">ke1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128522"><span class="annot"><a href="#local-6989586621683128522"><span class="hs-identifier hs-var">ke2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Match.Literal.html#dsOverLit"><span class="hs-identifier hs-type">dsOverLit</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128513"><span class="hs-identifier hs-type">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683128514"><span class="hs-identifier hs-type">k2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621683128524"><span class="annot"><a href="#local-6989586621683128524"><span class="hs-identifier hs-var">rhs_b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsSyntaxExpr"><span class="hs-identifier hs-type">dsSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128515"><span class="hs-identifier hs-type">ge</span></a></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128447"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683128521"><span class="hs-identifier hs-type">ke1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621683128525"><span class="annot"><a href="#local-6989586621683128525"><span class="hs-identifier hs-var">rhs_n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsSyntaxExpr"><span class="hs-identifier hs-type">dsSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128516"><span class="hs-identifier hs-type">minus</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128447"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683128522"><span class="hs-identifier hs-type">ke2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#sequencePmGrds"><span class="hs-identifier hs-type">sequencePmGrds</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-type">PmLet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128517"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128524"><span class="hs-identifier hs-type">rhs_b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683128519"><span class="hs-identifier hs-type">grd_b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-type">PmLet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128512"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128525"><span class="hs-identifier hs-type">rhs_n</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-comment">-- (fun -&gt; pat)   ===&gt;   let y = fun x, pat &lt;- y where y is a match var of pat</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ViewPat"><span class="hs-identifier hs-type">ViewPat</span></a></span><span> </span><span id="local-6989586621683128526"><span class="annot"><span class="annottext">XViewPat GhcTc
</span><a href="#local-6989586621683128526"><span class="hs-identifier hs-var">_arg_ty</span></a></span></span><span> </span><span id="local-6989586621683128527"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128527"><span class="hs-identifier hs-var">lexpr</span></a></span></span><span> </span><span id="local-6989586621683128528"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128528"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683128529"><span class="annot"><a href="#local-6989586621683128529"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128530"><span class="annot"><a href="#local-6989586621683128530"><span class="hs-identifier hs-var">grds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPatV"><span class="hs-identifier hs-var">desugarLPatV</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128528"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621683128532"><span class="annot"><a href="#local-6989586621683128532"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-type">dsLExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128527"><span class="hs-identifier hs-type">lexpr</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#consGrdDag"><span class="hs-identifier hs-type">consGrdDag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-type">PmLet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128529"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128532"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128447"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683128530"><span class="hs-identifier hs-type">grds</span></a></span><span>  </span><span class="hs-comment">-- list</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-type">ListPat</span></a></span><span> </span><span class="annot"><span class="annottext">XListPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128533"><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683128533"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="annottext">Id -&gt; [LPat GhcTc] -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarListPat"><span class="hs-identifier hs-var">desugarListPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683128533"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_con :: forall p. Pat p -&gt; XRec p (ConLikeP p)
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con"><span class="hs-identifier hs-var">pat_con</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128537"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683128537"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-176"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_args :: forall p. Pat p -&gt; HsConPatDetails p
</span><a href="Language.Haskell.Syntax.Pat.html#pat_args"><span class="hs-identifier hs-var">pat_args</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128539"><span class="annot"><span class="annottext">HsConPatDetails GhcTc
</span><a href="#local-6989586621683128539"><span class="hs-identifier hs-var">ps</span></a></span></span><span>
</span><span id="line-177"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_con_ext :: forall p. Pat p -&gt; XConPat p
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con_ext"><span class="hs-identifier hs-var">pat_con_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#ConPatTc"><span class="hs-identifier hs-type">ConPatTc</span></a></span><span>
</span><span id="line-178"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpt_arg_tys :: ConPatTc -&gt; [Kind]
</span><a href="GHC.Hs.Pat.html#cpt_arg_tys"><span class="hs-identifier hs-var">cpt_arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128543"><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621683128543"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span>
</span><span id="line-179"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_tvs :: ConPatTc -&gt; [Id]
</span><a href="GHC.Hs.Pat.html#cpt_tvs"><span class="hs-identifier hs-var">cpt_tvs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128545"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128545"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span>
</span><span id="line-180"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_dicts :: ConPatTc -&gt; [Id]
</span><a href="GHC.Hs.Pat.html#cpt_dicts"><span class="hs-identifier hs-var">cpt_dicts</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128547"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128547"><span class="hs-identifier hs-var">dicts</span></a></span></span><span>
</span><span id="line-181"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>         </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">Id
-&gt; ConLike
-&gt; [Kind]
-&gt; [Id]
-&gt; [Id]
-&gt; HsConPatDetails GhcTc
-&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarConPatOut"><span class="hs-identifier hs-var">desugarConPatOut</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683128537"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621683128543"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128545"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128547"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcTc
</span><a href="#local-6989586621683128539"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPat"><span class="hs-identifier hs-type">NPat</span></a></span><span> </span><span id="local-6989586621683128550"><span class="annot"><span class="annottext">XNPat GhcTc
</span><a href="#local-6989586621683128550"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128551"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621683128551"><span class="hs-identifier hs-var">olit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621683128552"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
</span><a href="#local-6989586621683128552"><span class="hs-identifier hs-var">mb_neg</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">-- See Note [Literal short cut] in &quot;GHC.HsToCore.Match.Literal&quot;</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- We inline the Literal short cut for @ty@ here, because @ty@ is more</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-comment">-- precise than the field of OverLitTc, which is all that dsOverLit (which</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">-- normally does the literal short cut) can look at. Also @ty@ matches the</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">-- type of the scrutinee, so info on both pattern and scrutinee (for which</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-comment">-- short cutting in dsOverLit works properly) is overloaded iff either is.</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621683128553"><span class="annot"><a href="#local-6989586621683128553"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128555"><span class="annot"><a href="#local-6989586621683128555"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683128553"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621683128557"><span class="annot"><a href="#local-6989586621683128557"><span class="hs-identifier hs-var">pm_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621683128551"><span class="hs-identifier hs-type">olit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#OverLit"><span class="hs-identifier hs-type">OverLit</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ol_val :: forall p. HsOverLit p -&gt; OverLitVal
</span><a href="Language.Haskell.Syntax.Lit.html#ol_val"><span class="hs-identifier hs-var">ol_val</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128560"><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621683128560"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ol_ext :: forall p. HsOverLit p -&gt; XOverLit p
</span><a href="Language.Haskell.Syntax.Lit.html#ol_ext"><span class="hs-identifier hs-var">ol_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#OverLitTc"><span class="hs-identifier hs-type">OverLitTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ol_rebindable :: OverLitTc -&gt; Bool
</span><a href="GHC.Hs.Lit.html#ol_rebindable"><span class="hs-identifier hs-var">ol_rebindable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128564"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683128564"><span class="hs-identifier hs-var">rebindable</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683128564"><span class="hs-identifier hs-var">rebindable</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683128566"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683128566"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OverLitVal -&gt; Kind -&gt; Maybe (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.TcMType.html#shortCutLit"><span class="hs-identifier hs-var">shortCutLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621683128555"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621683128560"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">XNPat GhcTc
Kind
</span><a href="#local-6989586621683128550"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe PmLit
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#coreExprAsPmLit"><span class="hs-identifier hs-var">coreExprAsPmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Maybe PmLit)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Maybe PmLit)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621683128566"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621683128564"><span class="hs-identifier hs-var">rebindable</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsFractional"><span class="hs-identifier hs-type">HsFractional</span></a></span><span> </span><span id="local-6989586621683128569"><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621683128569"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621683128560"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128570"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683128570"><span class="hs-identifier hs-var">negates</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FractionalLit -&gt; Bool
</span><a href="GHC.Types.SourceText.html#fl_neg"><span class="hs-identifier hs-var">fl_neg</span></a></span><span> </span><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621683128569"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>            </span><span id="local-6989586621683128572"><span class="annot"><a href="#local-6989586621683128572"><span class="hs-identifier hs-var">rat_tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM TyCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-var">dsLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#rationalTyConName"><span class="hs-identifier hs-var">rationalTyConName</span></a></span><span>
</span><span id="line-204"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128574"><span class="annot"><a href="#local-6989586621683128574"><span class="hs-identifier hs-var hs-var">rat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Kind
</span><a href="GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621683128572"><span class="hs-identifier hs-var">rat_tc</span></a></span><span>
</span><span id="line-205"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128574"><span class="hs-identifier hs-type">rat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLitOverRat"><span class="hs-identifier hs-type">PmLitOverRat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128570"><span class="hs-identifier hs-type">negates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128569"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>           </span><span id="local-6989586621683128577"><span class="annot"><a href="#local-6989586621683128577"><span class="hs-identifier hs-var">dsLit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc -&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
</span><a href="GHC.HsToCore.Match.Literal.html#dsOverLit"><span class="hs-identifier hs-var">dsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621683128551"><span class="hs-identifier hs-var">olit</span></a></span><span>
</span><span id="line-209"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621683128578"><span class="annot"><a href="#local-6989586621683128578"><span class="hs-identifier hs-var hs-var">pmLit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe PmLit
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#coreExprAsPmLit"><span class="hs-identifier hs-var">coreExprAsPmLit</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683128577"><span class="hs-identifier hs-var">dsLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a></span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-comment">--  pprTraceM &quot;desugarPat&quot;</span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-comment">--     (</span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-comment">--       text &quot;val&quot; &lt;+&gt; ppr val $$</span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-comment">--       text &quot;witness&quot; &lt;+&gt; ppr (ol_witness olit) $$</span><span>
</span><span id="line-214"></span><span>          </span><span class="hs-comment">--       text &quot;dsLit&quot; &lt;+&gt; ppr dsLit $$</span><span>
</span><span id="line-215"></span><span>          </span><span class="hs-comment">--       text &quot;asPmLit&quot; &lt;+&gt; ppr pmLit</span><span>
</span><span id="line-216"></span><span>          </span><span class="hs-comment">--     )</span><span>
</span><span id="line-217"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621683128578"><span class="hs-identifier hs-type">pmLit</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128579"><span class="annot"><a href="#local-6989586621683128579"><span class="hs-identifier hs-var hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PmLit
</span><a href="#local-6989586621683128557"><span class="hs-identifier hs-var">pm_lit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-220"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683128580"><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621683128580"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621683128580"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-221"></span><span>          </span><span class="annot"><span class="annottext">Maybe PmLit
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; PmLit
forall a. HasCallStack =&gt; [Char] -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;failed to detect OverLit&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsOverLit GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621683128551"><span class="hs-identifier hs-var">olit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128582"><span class="annot"><a href="#local-6989586621683128582"><span class="hs-identifier hs-var hs-var">lit'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
</span><a href="#local-6989586621683128552"><span class="hs-identifier hs-var">mb_neg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe PmLit -&gt; PmLit
forall a. HasDebugCallStack =&gt; [Char] -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;failed to negate lit&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmLit -&gt; Maybe PmLit
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#negatePmLit"><span class="hs-identifier hs-var">negatePmLit</span></a></span><span> </span><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621683128579"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>          </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621683128579"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLitGrds"><span class="hs-identifier hs-type">mkPmLitGrds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128447"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128582"><span class="hs-identifier hs-type">lit'</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LitPat"><span class="hs-identifier hs-type">LitPat</span></a></span><span> </span><span class="annot"><span class="annottext">XLitPat GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128586"><span class="annot"><span class="annottext">HsLit GhcTc
</span><a href="#local-6989586621683128586"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621683128587"><span class="annot"><a href="#local-6989586621683128587"><span class="hs-identifier hs-var">core_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn -&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
</span><a href="GHC.HsToCore.Match.Literal.html#dsLit"><span class="hs-identifier hs-var">dsLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsLit GhcTc -&gt; HsLit GhcRn
forall (p1 :: Pass) (p2 :: Pass).
HsLit (GhcPass p1) -&gt; HsLit (GhcPass p2)
</span><a href="GHC.Hs.Lit.html#convertLit"><span class="hs-identifier hs-var">convertLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcTc
</span><a href="#local-6989586621683128586"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128589"><span class="annot"><a href="#local-6989586621683128589"><span class="hs-identifier hs-var hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe PmLit -&gt; PmLit
forall a. HasDebugCallStack =&gt; [Char] -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;failed to detect Lit&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe PmLit
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#coreExprAsPmLit"><span class="hs-identifier hs-var">coreExprAsPmLit</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683128587"><span class="hs-identifier hs-var">core_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkPmLitGrds"><span class="hs-identifier hs-type">mkPmLitGrds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128447"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128589"><span class="hs-identifier hs-type">lit</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span id="local-6989586621683128591"><span class="annot"><span class="annottext">XTuplePat GhcTc
</span><a href="#local-6989586621683128591"><span class="hs-identifier hs-var">_tys</span></a></span></span><span> </span><span id="local-6989586621683128592"><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683128592"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span id="local-6989586621683128593"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621683128593"><span class="hs-identifier hs-var">boxity</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683128594"><span class="annot"><a href="#local-6989586621683128594"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128595"><span class="annot"><a href="#local-6989586621683128595"><span class="hs-identifier hs-var">grdss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; DsM (Id, GrdDag))
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ([Id], [GrdDag])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; DsM (Id, GrdDag)
GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPatV"><span class="hs-identifier hs-var">desugarLPatV</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc]
[GenLocated SrcSpanAnnA (Pat GhcTc)]
</span><a href="#local-6989586621683128592"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128597"><span class="annot"><a href="#local-6989586621683128597"><span class="hs-identifier hs-var hs-var">tuple_con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621683128593"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128594"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-type">vanillaConGrd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128447"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128597"><span class="hs-identifier hs-type">tuple_con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128594"><span class="hs-identifier hs-type">vars</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#consGrdDag"><span class="hs-operator hs-type">`consGrdDag`</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#sequenceGrdDags"><span class="hs-identifier hs-type">sequenceGrdDags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128595"><span class="hs-identifier hs-type">grdss</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#OrPat"><span class="hs-identifier hs-type">OrPat</span></a></span><span> </span><span id="local-6989586621683128602"><span class="annot"><span class="annottext">XOrPat GhcTc
</span><a href="#local-6989586621683128602"><span class="hs-identifier hs-var">_tys</span></a></span></span><span> </span><span id="local-6989586621683128603"><span class="annot"><span class="annottext">NonEmpty (LPat GhcTc)
</span><a href="#local-6989586621683128603"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty GrdDag -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#alternativesGrdDags"><span class="hs-identifier hs-var">alternativesGrdDags</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty GrdDag -&gt; GrdDag)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (NonEmpty GrdDag) -&gt; DsM GrdDag
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; DsM GrdDag)
-&gt; NonEmpty (GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (NonEmpty GrdDag)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; NonEmpty a -&gt; f (NonEmpty b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; LPat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-var">desugarLPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128447"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (LPat GhcTc)
NonEmpty (GenLocated SrcSpanAnnA (Pat GhcTc))
</span><a href="#local-6989586621683128603"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SumPat"><span class="hs-identifier hs-type">SumPat</span></a></span><span> </span><span id="local-6989586621683128606"><span class="annot"><span class="annottext">XSumPat GhcTc
</span><a href="#local-6989586621683128606"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span id="local-6989586621683128607"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128607"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683128608"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683128608"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621683128609"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683128609"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683128610"><span class="annot"><a href="#local-6989586621683128610"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128611"><span class="annot"><a href="#local-6989586621683128611"><span class="hs-identifier hs-var">grds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPatV"><span class="hs-identifier hs-var">desugarLPatV</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128607"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128612"><span class="annot"><a href="#local-6989586621683128612"><span class="hs-identifier hs-var hs-var">sum_con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#sumDataCon"><span class="hs-identifier hs-var">sumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683128608"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683128609"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-type">vanillaConGrd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128447"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128612"><span class="hs-identifier hs-type">sum_con</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683128610"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#consGrdDag"><span class="hs-operator hs-type">`consGrdDag`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128611"><span class="hs-identifier hs-type">grds</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SplicePat"><span class="hs-identifier hs-type">SplicePat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DsM GrdDag
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Check.desugarPat: SplicePat&quot;</span></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="annot"><span class="hs-comment">-- | 'desugarPat', but also select and return a new match var.</span></span><span>
</span><span id="line-249"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPatV"><span class="hs-identifier hs-type">desugarPatV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span id="desugarPatV"><span class="annot"><span class="annottext">desugarPatV :: Pat GhcTc -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPatV"><span class="hs-identifier hs-var hs-var">desugarPatV</span></a></span></span><span> </span><span id="local-6989586621683128616"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128616"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621683128617"><span class="annot"><a href="#local-6989586621683128617"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Pat GhcTc -&gt; DsM Id
</span><a href="GHC.HsToCore.Utils.html#selectMatchVar"><span class="hs-identifier hs-var">selectMatchVar</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128616"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span id="local-6989586621683128619"><span class="annot"><a href="#local-6989586621683128619"><span class="hs-identifier hs-var">grds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPat"><span class="hs-identifier hs-type">desugarPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128617"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128616"><span class="hs-identifier hs-type">pat</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683128617"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683128619"><span class="hs-identifier hs-type">grds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-type">desugarLPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-256"></span><span id="desugarLPat"><span class="annot"><span class="annottext">desugarLPat :: Id -&gt; LPat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-var hs-var">desugarLPat</span></a></span></span><span> </span><span id="local-6989586621683128620"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128620"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Pat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPat"><span class="hs-identifier hs-var">desugarPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128620"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(Pat GhcTc -&gt; DsM GrdDag)
-&gt; (GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc)
-&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
-&gt; DsM GrdDag
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="annot"><span class="hs-comment">-- | 'desugarLPat', but also select and return a new match var.</span></span><span>
</span><span id="line-259"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPatV"><span class="hs-identifier hs-type">desugarLPatV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span id="desugarLPatV"><span class="annot"><span class="annottext">desugarLPatV :: LPat GhcTc -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPatV"><span class="hs-identifier hs-var hs-var">desugarLPatV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPatV"><span class="hs-identifier hs-var">desugarPatV</span></a></span><span> </span><span class="annot"><span class="annottext">(Pat GhcTc -&gt; DsM (Id, GrdDag))
-&gt; (GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc)
-&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
-&gt; DsM (Id, GrdDag)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; Pat GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | @desugarListPat _ x [p1, ..., pn]@ is basically</span><span>
</span><span id="line-263"></span><span class="hs-comment">--   @desugarConPatOut _ x $(mkListConPatOuts [p1, ..., pn]&gt;@ without ever</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- constructing the 'ConPatOut's.</span><span>
</span><span id="line-265"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarListPat"><span class="hs-identifier hs-type">desugarListPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-266"></span><span id="desugarListPat"><span class="annot"><span class="annottext">desugarListPat :: Id -&gt; [LPat GhcTc] -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarListPat"><span class="hs-identifier hs-var hs-var">desugarListPat</span></a></span></span><span> </span><span id="local-6989586621683128622"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128622"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683128623"><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683128623"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>  </span><span id="local-6989586621683128624"><span class="annot"><a href="#local-6989586621683128624"><span class="hs-identifier hs-var">vars_and_grdss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; DsM (Id, GrdDag))
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) [(Id, GrdDag)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; DsM (Id, GrdDag)
GenLocated SrcSpanAnnA (Pat GhcTc) -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPatV"><span class="hs-identifier hs-var">desugarLPatV</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc]
[GenLocated SrcSpanAnnA (Pat GhcTc)]
</span><a href="#local-6989586621683128623"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#mkListGrds"><span class="hs-identifier hs-type">mkListGrds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128622"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128624"><span class="hs-identifier hs-type">vars_and_grdss</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><span class="hs-comment">-- | Desugar a constructor pattern</span></span><span>
</span><span id="line-271"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarConPatOut"><span class="hs-identifier hs-type">desugarConPatOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-272"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-273"></span><span id="desugarConPatOut"><span class="annot"><span class="annottext">desugarConPatOut :: Id
-&gt; ConLike
-&gt; [Kind]
-&gt; [Id]
-&gt; [Id]
-&gt; HsConPatDetails GhcTc
-&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarConPatOut"><span class="hs-identifier hs-var hs-var">desugarConPatOut</span></a></span></span><span> </span><span id="local-6989586621683128627"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128627"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621683128628"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683128628"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621683128629"><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621683128629"><span class="hs-identifier hs-var">univ_tys</span></a></span></span><span> </span><span id="local-6989586621683128630"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128630"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span> </span><span id="local-6989586621683128631"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128631"><span class="hs-identifier hs-var">dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#PrefixCon"><span class="hs-identifier hs-type">PrefixCon</span></a></span><span> </span><span class="annot"><span class="annottext">[HsConPatTyArg (NoGhcTc GhcTc)]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128633"><span class="annot"><span class="annottext">[LPat GhcTc]
</span><a href="#local-6989586621683128633"><span class="hs-identifier hs-var">ps</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Int, GenLocated SrcSpanAnnA (Pat GhcTc))] -&gt; DsM GrdDag
</span><a href="#local-6989586621683128634"><span class="hs-identifier hs-var">go_field_pats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)]
-&gt; [(Int, GenLocated SrcSpanAnnA (Pat GhcTc))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc]
[GenLocated SrcSpanAnnA (Pat GhcTc)]
</span><a href="#local-6989586621683128633"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#InfixCon"><span class="hs-identifier hs-type">InfixCon</span></a></span><span>  </span><span id="local-6989586621683128636"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128636"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span id="local-6989586621683128637"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128637"><span class="hs-identifier hs-var">p2</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Int, GenLocated SrcSpanAnnA (Pat GhcTc))] -&gt; DsM GrdDag
</span><a href="#local-6989586621683128634"><span class="hs-identifier hs-var">go_field_pats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)]
-&gt; [(Int, GenLocated SrcSpanAnnA (Pat GhcTc))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683128636"><span class="hs-identifier hs-var">p1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683128637"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#RecCon"><span class="hs-identifier hs-type">RecCon</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span id="local-6989586621683128640"><span class="annot"><span class="annottext">XHsRecFields GhcTc
</span><a href="#local-6989586621683128640"><span class="hs-identifier hs-var">mult_cos</span></a></span></span><span> </span><span id="local-6989586621683128641"><span class="annot"><span class="annottext">[LHsRecField GhcTc (LPat GhcTc)]
</span><a href="#local-6989586621683128641"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (XRec GhcTc RecFieldsDotDot)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>      </span><span class="annot"><span class="annottext">MultiplicityCheckCoercions -&gt; DsM ()
</span><a href="GHC.HsToCore.Utils.html#checkMultiplicityCoercions"><span class="hs-identifier hs-var">checkMultiplicityCoercions</span></a></span><span> </span><span class="annot"><span class="annottext">MultiplicityCheckCoercions
XHsRecFields GhcTc
</span><a href="#local-6989586621683128640"><span class="hs-identifier hs-var">mult_cos</span></a></span><span>
</span><span id="line-278"></span><span>      </span><span class="annot"><span class="annottext">[(Int, GenLocated SrcSpanAnnA (Pat GhcTc))] -&gt; DsM GrdDag
</span><a href="#local-6989586621683128634"><span class="hs-identifier hs-var">go_field_pats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
      (GenLocated SrcSpanAnnA (Pat GhcTc)))]
-&gt; [(Int, GenLocated SrcSpanAnnA (Pat GhcTc))]
</span><a href="#local-6989586621683128642"><span class="hs-identifier hs-var">rec_field_ps</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField GhcTc (LPat GhcTc)]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
      (GenLocated SrcSpanAnnA (Pat GhcTc)))]
</span><a href="#local-6989586621683128641"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-comment">-- The actual argument types (instantiated)</span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621683128643"><span class="annot"><span class="annottext">arg_tys :: [Kind]
</span><a href="#local-6989586621683128643"><span class="hs-identifier hs-var hs-var">arg_tys</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled Kind -&gt; Kind) -&gt; [Scaled Kind] -&gt; [Kind]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled Kind -&gt; Kind
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">([Scaled Kind] -&gt; [Kind]) -&gt; [Scaled Kind] -&gt; [Kind]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [Kind] -&gt; [Scaled Kind]
</span><a href="GHC.Core.ConLike.html#conLikeInstOrigArgTys"><span class="hs-identifier hs-var">conLikeInstOrigArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683128628"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621683128629"><span class="hs-identifier hs-var">univ_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Kind] -&gt; [Kind] -&gt; [Kind]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Kind]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128630"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">-- Extract record field patterns tagged by field index from a list of</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-comment">-- LHsRecField</span><span>
</span><span id="line-285"></span><span>    </span><span id="local-6989586621683128642"><span class="annot"><span class="annottext">rec_field_ps :: [GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
      (GenLocated SrcSpanAnnA (Pat GhcTc)))]
-&gt; [(Int, GenLocated SrcSpanAnnA (Pat GhcTc))]
</span><a href="#local-6989586621683128642"><span class="hs-identifier hs-var hs-var">rec_field_ps</span></a></span></span><span> </span><span id="local-6989586621683128647"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
      (GenLocated SrcSpanAnnA (Pat GhcTc)))]
</span><a href="#local-6989586621683128647"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
      (GenLocated SrcSpanAnnA (Pat GhcTc)))
 -&gt; (Int, GenLocated SrcSpanAnnA (Pat GhcTc)))
-&gt; [GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
         (GenLocated SrcSpanAnnA (Pat GhcTc)))]
-&gt; [(Int, GenLocated SrcSpanAnnA (Pat GhcTc))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; (Int, GenLocated SrcSpanAnnA (Pat GhcTc))
</span><a href="#local-6989586621683128648"><span class="hs-identifier hs-var">tagged_pat</span></a></span><span> </span><span class="annot"><span class="annottext">(HsFieldBind
   (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
   (GenLocated SrcSpanAnnA (Pat GhcTc))
 -&gt; (Int, GenLocated SrcSpanAnnA (Pat GhcTc)))
-&gt; (GenLocated
      SrcSpanAnnA
      (HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
         (GenLocated SrcSpanAnnA (Pat GhcTc)))
    -&gt; HsFieldBind
         (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
         (GenLocated SrcSpanAnnA (Pat GhcTc)))
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
        (GenLocated SrcSpanAnnA (Pat GhcTc)))
-&gt; (Int, GenLocated SrcSpanAnnA (Pat GhcTc))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsFieldBind
     (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
     (GenLocated SrcSpanAnnA (Pat GhcTc)))
-&gt; HsFieldBind
     (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
     (GenLocated SrcSpanAnnA (Pat GhcTc))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
      (GenLocated SrcSpanAnnA (Pat GhcTc)))]
</span><a href="#local-6989586621683128647"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-287"></span><span>        </span><span id="local-6989586621683128648"><span class="annot"><span class="annottext">tagged_pat :: HsFieldBind
  (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; (Int, GenLocated SrcSpanAnnA (Pat GhcTc))
</span><a href="#local-6989586621683128648"><span class="hs-identifier hs-var hs-var">tagged_pat</span></a></span></span><span> </span><span id="local-6989586621683128649"><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
</span><a href="#local-6989586621683128649"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Int
</span><a href="#local-6989586621683128650"><span class="hs-identifier hs-var">lbl_to_index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecField GhcTc (GenLocated SrcSpanAnnA (Pat GhcTc)) -&gt; Id
forall arg. HsRecField GhcTc arg -&gt; Id
</span><a href="GHC.Hs.Pat.html#hsRecFieldId"><span class="hs-identifier hs-var">hsRecFieldId</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField GhcTc (GenLocated SrcSpanAnnA (Pat GhcTc))
HsFieldBind
  (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
</span><a href="#local-6989586621683128649"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall lhs rhs. HsFieldBind lhs rhs -&gt; rhs
</span><a href="Language.Haskell.Syntax.Pat.html#hfbRHS"><span class="hs-identifier hs-var">hfbRHS</span></a></span><span> </span><span class="annot"><span class="annottext">HsFieldBind
  (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
</span><a href="#local-6989586621683128649"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-comment">-- Unfortunately the label info is empty when the DataCon wasn't defined</span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-comment">-- with record field labels, hence we desugar to field index.</span><span>
</span><span id="line-290"></span><span>        </span><span id="local-6989586621683128654"><span class="annot"><span class="annottext">orig_lbls :: [Name]
</span><a href="#local-6989586621683128654"><span class="hs-identifier hs-var hs-var">orig_lbls</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLabel] -&gt; [Name]) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683128628"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span id="local-6989586621683128650"><span class="annot"><span class="annottext">lbl_to_index :: Name -&gt; Int
</span><a href="#local-6989586621683128650"><span class="hs-identifier hs-var hs-var">lbl_to_index</span></a></span></span><span> </span><span id="local-6989586621683128657"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683128657"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe Int -&gt; Int
forall a. HasDebugCallStack =&gt; [Char] -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lbl_to_index&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><span class="hs-identifier hs-var">elemIndex</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621683128657"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621683128654"><span class="hs-identifier hs-var">orig_lbls</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621683128634"><span class="annot"><span class="annottext">go_field_pats :: [(Int, GenLocated SrcSpanAnnA (Pat GhcTc))] -&gt; DsM GrdDag
</span><a href="#local-6989586621683128634"><span class="hs-identifier hs-var hs-var">go_field_pats</span></a></span></span><span> </span><span id="local-6989586621683128658"><span class="annot"><span class="annottext">[(Int, GenLocated SrcSpanAnnA (Pat GhcTc))]
</span><a href="#local-6989586621683128658"><span class="hs-identifier hs-var">tagged_pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-comment">-- The fields that appear might not be in the correct order. So</span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-comment">--   1. Do the PmCon match</span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-comment">--   2. Then pattern match on the fields in the order given by the first</span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-comment">--      field of @tagged_pats@.</span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-comment">-- See Note [Field match order for RecCon]</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-comment">-- Desugar the mentioned field patterns. We're doing this first to get</span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-comment">-- the Ids for pm_con_args and bring them in order afterwards.</span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128661"><span class="annot"><span class="annottext">trans_pat :: (a, GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ((a, Id), GrdDag)
</span><a href="#local-6989586621683128661"><span class="hs-identifier hs-var hs-var hs-var">trans_pat</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621683128662"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621683128662"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128663"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683128663"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621683128664"><span class="annot"><a href="#local-6989586621683128664"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128665"><span class="annot"><a href="#local-6989586621683128665"><span class="hs-identifier hs-var">pvec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPatV"><span class="hs-identifier hs-var">desugarLPatV</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621683128663"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683128662"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683128664"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621683128665"><span class="hs-identifier hs-type">pvec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621683128666"><span class="annot"><a href="#local-6989586621683128666"><span class="hs-identifier hs-var">tagged_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128667"><span class="annot"><a href="#local-6989586621683128667"><span class="hs-identifier hs-var">arg_grdss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Int, GenLocated SrcSpanAnnA (Pat GhcTc))
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) ((Int, Id), GrdDag))
-&gt; [(Int, GenLocated SrcSpanAnnA (Pat GhcTc))]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ([(Int, Id)], [GrdDag])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="annot"><span class="annottext">(Int, GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ((Int, Id), GrdDag)
forall {a}.
(a, GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ((a, Id), GrdDag)
</span><a href="#local-6989586621683128661"><span class="hs-identifier hs-var">trans_pat</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, GenLocated SrcSpanAnnA (Pat GhcTc))]
</span><a href="#local-6989586621683128658"><span class="hs-identifier hs-var">tagged_pats</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128668"><span class="annot"><a href="#local-6989586621683128668"><span class="hs-identifier hs-var hs-var">get_pat_id</span></a></span></span><span> </span><span id="local-6989586621683128669"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683128669"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621683128670"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683128670"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Int, Id)] -&gt; Maybe Id
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621683128669"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Id)]
</span><a href="#local-6989586621683128666"><span class="hs-identifier hs-var">tagged_vars</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-308"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621683128672"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128672"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; DsM Id
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128672"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-309"></span><span>            </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621683128670"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>      </span><span class="hs-comment">-- 1. the constructor pattern match itself</span><span>
</span><span id="line-312"></span><span>      </span><span id="local-6989586621683128673"><span class="annot"><a href="#local-6989586621683128673"><span class="hs-identifier hs-var">arg_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWithM</span></span><span> </span><span class="annot"><a href="#local-6989586621683128668"><span class="hs-identifier hs-type">get_pat_id</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621683128643"><span class="hs-identifier hs-type">arg_tys</span></a></span><span>
</span><span id="line-313"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128674"><span class="annot"><a href="#local-6989586621683128674"><span class="hs-identifier hs-var hs-var">con_grd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; PmAltCon -&gt; [Id] -&gt; [Id] -&gt; [Id] -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Types.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128627"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-var">PmAltConLike</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621683128628"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128630"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128631"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128673"><span class="hs-identifier hs-var">arg_ids</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>      </span><span class="hs-comment">-- 2. guards from field selector patterns</span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128675"><span class="annot"><a href="#local-6989586621683128675"><span class="hs-identifier hs-var hs-var">arg_grds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GrdDag] -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#sequenceGrdDags"><span class="hs-identifier hs-var">sequenceGrdDags</span></a></span><span> </span><span class="annot"><span class="annottext">[GrdDag]
</span><a href="#local-6989586621683128667"><span class="hs-identifier hs-var">arg_grdss</span></a></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-comment">-- tracePm &quot;ConPatOut&quot; (ppr x $$ ppr con $$ ppr arg_ids)</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683128674"><span class="hs-identifier hs-type">con_grd</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#consGrdDag"><span class="hs-operator hs-type">`consGrdDag`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128675"><span class="hs-identifier hs-type">arg_grds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPatBind"><span class="hs-identifier hs-type">desugarPatBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmPatBind"><span class="hs-identifier hs-type">PmPatBind</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#Pre"><span class="hs-identifier hs-type">Pre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- See 'GrdPatBind' for how this simply repurposes GrdGRHS.</span><span>
</span><span id="line-323"></span><span id="desugarPatBind"><span class="annot"><span class="annottext">desugarPatBind :: SrcSpan -&gt; Id -&gt; Pat GhcTc -&gt; DsM (PmPatBind GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPatBind"><span class="hs-identifier hs-var hs-var">desugarPatBind</span></a></span></span><span> </span><span id="local-6989586621683128677"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683128677"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621683128678"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128678"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621683128679"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128679"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="annottext">PmGRHS GrdDag -&gt; PmPatBind GrdDag
forall p. PmGRHS p -&gt; PmPatBind p
</span><a href="GHC.HsToCore.Pmc.Types.html#PmPatBind"><span class="hs-identifier hs-var">PmPatBind</span></a></span><span> </span><span class="annot"><span class="annottext">(PmGRHS GrdDag -&gt; PmPatBind GrdDag)
-&gt; (GrdDag -&gt; PmGRHS GrdDag) -&gt; GrdDag -&gt; PmPatBind GrdDag
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(GrdDag -&gt; SrcInfo -&gt; PmGRHS GrdDag)
-&gt; SrcInfo -&gt; GrdDag -&gt; PmGRHS GrdDag
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; SrcInfo -&gt; PmGRHS GrdDag
forall p. p -&gt; SrcInfo -&gt; PmGRHS p
</span><a href="GHC.HsToCore.Pmc.Types.html#PmGRHS"><span class="hs-identifier hs-var">PmGRHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located SDoc -&gt; SrcInfo
</span><a href="GHC.HsToCore.Pmc.Types.html#SrcInfo"><span class="hs-identifier hs-var">SrcInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; Located SDoc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683128677"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128679"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GrdDag -&gt; PmPatBind GrdDag)
-&gt; DsM GrdDag -&gt; DsM (PmPatBind GrdDag)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Pat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarPat"><span class="hs-identifier hs-var">desugarPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128678"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621683128679"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarEmptyCase"><span class="hs-identifier hs-type">desugarEmptyCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmEmptyCase"><span class="hs-identifier hs-type">PmEmptyCase</span></a></span><span>
</span><span id="line-327"></span><span id="desugarEmptyCase"><span class="annot"><span class="annottext">desugarEmptyCase :: Id -&gt; DsM PmEmptyCase
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarEmptyCase"><span class="hs-identifier hs-var hs-var">desugarEmptyCase</span></a></span></span><span> </span><span id="local-6989586621683128683"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128683"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmEmptyCase -&gt; DsM PmEmptyCase
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmEmptyCase"><span class="hs-identifier hs-type">PmEmptyCase</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_var :: Id
</span><a href="GHC.HsToCore.Pmc.Types.html#pe_var"><span class="hs-identifier hs-var">pe_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128683"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="annot"><span class="hs-comment">-- | Desugar the non-empty 'Match'es of a 'MatchGroup'.</span></span><span>
</span><span id="line-330"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarMatches"><span class="hs-identifier hs-type">desugarMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmMatchGroup"><span class="hs-identifier hs-type">PmMatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#Pre"><span class="hs-identifier hs-type">Pre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span id="desugarMatches"><span class="annot"><span class="annottext">desugarMatches :: [Id]
-&gt; NonEmpty (LMatch GhcTc (LHsExpr GhcTc))
-&gt; DsM (PmMatchGroup GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarMatches"><span class="hs-identifier hs-var hs-var">desugarMatches</span></a></span></span><span> </span><span id="local-6989586621683128687"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128687"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621683128688"><span class="annot"><span class="annottext">NonEmpty (LMatch GhcTc (LHsExpr GhcTc))
</span><a href="#local-6989586621683128688"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><span class="annottext">NonEmpty (PmMatch GrdDag) -&gt; PmMatchGroup GrdDag
forall p. NonEmpty (PmMatch p) -&gt; PmMatchGroup p
</span><a href="GHC.HsToCore.Pmc.Types.html#PmMatchGroup"><span class="hs-identifier hs-var">PmMatchGroup</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (PmMatch GrdDag) -&gt; PmMatchGroup GrdDag)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (NonEmpty (PmMatch GrdDag))
-&gt; DsM (PmMatchGroup GrdDag)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (Match GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) (PmMatch GrdDag))
-&gt; NonEmpty
     (GenLocated
        SrcSpanAnnA (Match GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (NonEmpty (PmMatch GrdDag))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; NonEmpty a -&gt; f (NonEmpty b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
-&gt; LMatch GhcTc (LHsExpr GhcTc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (PmMatch GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128687"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (LMatch GhcTc (LHsExpr GhcTc))
NonEmpty
  (GenLocated
     SrcSpanAnnA (Match GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
</span><a href="#local-6989586621683128688"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-- Desugar a single match</span><span>
</span><span id="line-336"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarMatch"><span class="hs-identifier hs-type">desugarMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmMatch"><span class="hs-identifier hs-type">PmMatch</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#Pre"><span class="hs-identifier hs-type">Pre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span id="desugarMatch"><span class="annot"><span class="annottext">desugarMatch :: [Id]
-&gt; LMatch GhcTc (LHsExpr GhcTc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (PmMatch GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarMatch"><span class="hs-identifier hs-var hs-var">desugarMatch</span></a></span></span><span> </span><span id="local-6989586621683128691"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621683128691"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683128692"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683128692"><span class="hs-identifier hs-var">match_loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">m_pats :: forall p body. Match p body -&gt; XRec p [LPat p]
</span><a href="Language.Haskell.Syntax.Expr.html#m_pats"><span class="hs-identifier hs-var">m_pats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpaLocation
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128694"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat GhcTc)]
</span><a href="#local-6989586621683128694"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">m_grhss :: forall p body. Match p body -&gt; GRHSs p body
</span><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128696"><span class="annot"><span class="annottext">GRHSs GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683128696"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-338"></span><span>  </span><span id="local-6989586621683128697"><span class="annot"><a href="#local-6989586621683128697"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-comment">-- decideBangHood: See Note [Desugaring -XStrict matches in Pmc]</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128698"><span class="annot"><a href="#local-6989586621683128698"><span class="hs-identifier hs-var hs-var">banged_pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcTc)
 -&gt; GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)]
-&gt; [GenLocated SrcSpanAnnA (Pat GhcTc)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; LPat GhcTc -&gt; LPat GhcTc
</span><a href="GHC.HsToCore.Utils.html#decideBangHood"><span class="hs-identifier hs-var">decideBangHood</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621683128697"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat GhcTc)]
</span><a href="#local-6989586621683128694"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-341"></span><span>  </span><span id="local-6989586621683128699"><span class="annot"><a href="#local-6989586621683128699"><span class="hs-identifier hs-var">pats'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#sequenceGrdDags"><span class="hs-identifier hs-type">sequenceGrdDags</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWithM</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-type">desugarLPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128691"><span class="hs-identifier hs-type">vars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128698"><span class="hs-identifier hs-type">banged_pats</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span id="local-6989586621683128700"><span class="annot"><a href="#local-6989586621683128700"><span class="hs-identifier hs-var">grhss'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarGRHSs"><span class="hs-identifier hs-type">desugarGRHSs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-type">locA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128692"><span class="hs-identifier hs-type">match_loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128694"><span class="hs-identifier hs-type">pats</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621683128696"><span class="hs-identifier hs-type">grhss</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-comment">-- tracePm &quot;desugarMatch&quot; (vcat [ppr pats, ppr pats', ppr grhss'])</span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmMatch"><span class="hs-identifier hs-type">PmMatch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#pm_pats"><span class="hs-identifier hs-var">pm_pats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683128699"><span class="hs-identifier hs-type">pats'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#pm_grhss"><span class="hs-identifier hs-var">pm_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683128700"><span class="hs-identifier hs-type">grhss'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarGRHSs"><span class="hs-identifier hs-type">desugarGRHSs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmGRHSs"><span class="hs-identifier hs-type">PmGRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#Pre"><span class="hs-identifier hs-type">Pre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span id="desugarGRHSs"><span class="annot"><span class="annottext">desugarGRHSs :: SrcSpan
-&gt; SDoc -&gt; GRHSs GhcTc (LHsExpr GhcTc) -&gt; DsM (PmGRHSs GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarGRHSs"><span class="hs-identifier hs-var hs-var">desugarGRHSs</span></a></span></span><span> </span><span id="local-6989586621683128705"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683128705"><span class="hs-identifier hs-var">match_loc</span></a></span></span><span> </span><span id="local-6989586621683128706"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683128706"><span class="hs-identifier hs-var">pp_pats</span></a></span></span><span> </span><span id="local-6989586621683128707"><span class="annot"><span class="annottext">GRHSs GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621683128707"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-348"></span><span>  </span><span id="local-6989586621683128708"><span class="annot"><a href="#local-6989586621683128708"><span class="hs-identifier hs-var">lcls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLocalBinds"><span class="hs-identifier hs-var">desugarLocalBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GRHSs GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; HsLocalBinds GhcTc
forall p body. GRHSs p body -&gt; HsLocalBinds p
</span><a href="Language.Haskell.Syntax.Expr.html#grhssLocalBinds"><span class="hs-identifier hs-var">grhssLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcTc (LHsExpr GhcTc)
GRHSs GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683128707"><span class="hs-identifier hs-var">grhss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>  </span><span id="local-6989586621683128711"><span class="annot"><a href="#local-6989586621683128711"><span class="hs-identifier hs-var">grhss'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLGRHS"><span class="hs-identifier hs-type">desugarLGRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128705"><span class="hs-identifier hs-type">match_loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128706"><span class="hs-identifier hs-type">pp_pats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>              </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-type">expectJust</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;desugarGRHSs&quot;</span></span><span>
</span><span id="line-351"></span><span>              </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="../../base-4.21.0.0-ae91/src/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-type">NE.nonEmpty</span></a></span><span>
</span><span id="line-352"></span><span>              </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#grhssGRHSs"><span class="hs-identifier hs-var">grhssGRHSs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128707"><span class="hs-identifier hs-type">grhss</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmGRHSs"><span class="hs-identifier hs-type">PmGRHSs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#pgs_lcls"><span class="hs-identifier hs-var">pgs_lcls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683128708"><span class="hs-identifier hs-type">lcls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#pgs_grhss"><span class="hs-identifier hs-var">pgs_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621683128711"><span class="hs-identifier hs-type">grhss'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><span class="hs-comment">-- | Desugar a guarded right-hand side to a single 'GrdTree'</span></span><span>
</span><span id="line-356"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLGRHS"><span class="hs-identifier hs-type">desugarLGRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LGRHS"><span class="hs-identifier hs-type">LGRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmGRHS"><span class="hs-identifier hs-type">PmGRHS</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#Pre"><span class="hs-identifier hs-type">Pre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span id="desugarLGRHS"><span class="annot"><span class="annottext">desugarLGRHS :: SrcSpan
-&gt; SDoc
-&gt; LGRHS GhcTc (LHsExpr GhcTc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (PmGRHS GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLGRHS"><span class="hs-identifier hs-var hs-var">desugarLGRHS</span></a></span></span><span> </span><span id="local-6989586621683128718"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683128718"><span class="hs-identifier hs-var">match_loc</span></a></span></span><span> </span><span id="local-6989586621683128719"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683128719"><span class="hs-identifier hs-var">pp_pats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683128720"><span class="annot"><span class="annottext">EpAnnCO
</span><a href="#local-6989586621683128720"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128722"><span class="annot"><span class="annottext">[GuardLStmt GhcTc]
</span><a href="#local-6989586621683128722"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-comment">-- _loc points to the match separator (ie =, -&gt;) that comes after the guards.</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-comment">-- Hence we have to pass in the match_loc, which we use in case that the RHS</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- is unguarded.</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-comment">-- pp_pats is the space-separated pattern of the current Match this</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-comment">-- GRHS belongs to, so the @A B x@ part in @A B x | 0 &lt;- x@.</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128723"><span class="annot"><span class="annottext">rhs_info :: Located SDoc
</span><a href="#local-6989586621683128723"><span class="hs-identifier hs-var hs-var hs-var">rhs_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcTc]
</span><a href="#local-6989586621683128722"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; Located SDoc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621683128718"><span class="hs-identifier hs-var">match_loc</span></a></span><span>      </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683128719"><span class="hs-identifier hs-var">pp_pats</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621683128724"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683128724"><span class="hs-identifier hs-var">grd_loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[GuardLStmt GhcTc]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; Located SDoc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621683128724"><span class="hs-identifier hs-var">grd_loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621683128719"><span class="hs-identifier hs-var">pp_pats</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#vbar"><span class="hs-identifier hs-var">vbar</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
-&gt; SDoc
forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#interpp%27SP"><span class="hs-identifier hs-var">interpp'SP</span></a></span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcTc]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621683128722"><span class="hs-identifier hs-var">gs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>  </span><span id="local-6989586621683128728"><span class="annot"><a href="#local-6989586621683128728"><span class="hs-identifier hs-var">grdss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
 -&gt; DsM GrdDag)
-&gt; [GenLocated
      SrcSpanAnnA
      (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) [GrdDag]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GuardStmt GhcTc -&gt; DsM GrdDag
StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarGuard"><span class="hs-identifier hs-var">desugarGuard</span></a></span><span> </span><span class="annot"><span class="annottext">(StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; DsM GrdDag)
-&gt; (GenLocated
      SrcSpanAnnA
      (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
    -&gt; StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; GenLocated
     SrcSpanAnnA
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; DsM GrdDag
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcTc]
[GenLocated
   SrcSpanAnnA
   (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621683128722"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmGRHS"><span class="hs-identifier hs-type">PmGRHS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#pg_grds"><span class="hs-identifier hs-var">pg_grds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#sequenceGrdDags"><span class="hs-identifier hs-type">sequenceGrdDags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128728"><span class="hs-identifier hs-type">grdss</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#pg_rhs"><span class="hs-identifier hs-var">pg_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#SrcInfo"><span class="hs-identifier hs-type">SrcInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128723"><span class="hs-identifier hs-type">rhs_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><span class="hs-comment">-- | Desugar a guard statement to a 'GrdDag'</span></span><span>
</span><span id="line-370"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarGuard"><span class="hs-identifier hs-type">desugarGuard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GuardStmt"><span class="hs-identifier hs-type">GuardStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-371"></span><span id="desugarGuard"><span class="annot"><span class="annottext">desugarGuard :: GuardStmt GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarGuard"><span class="hs-identifier hs-var hs-var">desugarGuard</span></a></span></span><span> </span><span id="local-6989586621683128732"><span class="annot"><span class="annottext">GuardStmt GhcTc
</span><a href="#local-6989586621683128732"><span class="hs-identifier hs-var">guard</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GuardStmt GhcTc
</span><a href="#local-6989586621683128732"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcTc GhcTc (LHsExpr GhcTc)
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621683128734"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128734"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarBoolGuard"><span class="hs-identifier hs-var">desugarBoolGuard</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128734"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span>  </span><span class="annot"><span class="annottext">XLetStmt GhcTc GhcTc (LHsExpr GhcTc)
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621683128737"><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621683128737"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLocalBinds"><span class="hs-identifier hs-var">desugarLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621683128737"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcTc GhcTc (LHsExpr GhcTc)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128739"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128739"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683128740"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128740"><span class="hs-identifier hs-var">e</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; LHsExpr GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarBind"><span class="hs-identifier hs-var">desugarBind</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128739"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128740"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span>        </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DsM GrdDag
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;desugarGuard LastStmt&quot;</span></span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span>         </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DsM GrdDag
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;desugarGuard ParStmt&quot;</span></span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span>       </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DsM GrdDag
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;desugarGuard TransStmt&quot;</span></span><span>
</span><span id="line-378"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span>         </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DsM GrdDag
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;desugarGuard RecStmt&quot;</span></span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XStmtLR"><span class="hs-identifier hs-type">XStmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ApplicativeStmt"><span class="hs-identifier hs-type">ApplicativeStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DsM GrdDag
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;desugarGuard ApplicativeLastStmt&quot;</span></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span id="local-6989586621683128133"><span id="local-6989586621683128134"><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#sequenceGrdDagMapM"><span class="hs-identifier hs-type">sequenceGrdDagMapM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621683128133"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621683128134"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683128133"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621683128134"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621683128133"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span></span></span><span>
</span><span id="line-382"></span><span id="sequenceGrdDagMapM"><span class="annot"><span class="annottext">sequenceGrdDagMapM :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
(a -&gt; f GrdDag) -&gt; [a] -&gt; f GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#sequenceGrdDagMapM"><span class="hs-identifier hs-var hs-var">sequenceGrdDagMapM</span></a></span></span><span> </span><span id="local-6989586621683128755"><span class="annot"><span class="annottext">a -&gt; f GrdDag
</span><a href="#local-6989586621683128755"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621683128756"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683128756"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GrdDag] -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#sequenceGrdDags"><span class="hs-identifier hs-var">sequenceGrdDags</span></a></span><span> </span><span class="annot"><span class="annottext">([GrdDag] -&gt; GrdDag) -&gt; f [GrdDag] -&gt; f GrdDag
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; f GrdDag) -&gt; [a] -&gt; f [GrdDag]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; f GrdDag
</span><a href="#local-6989586621683128755"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621683128756"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="hs-comment">-- | Desugar local bindings to a bunch of 'PmLet' guards.</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- Deals only with simple @let@ or @where@ bindings without any polymorphism,</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- recursion, pattern bindings etc.</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- See Note [Long-distance information for HsLocalBinds].</span><span>
</span><span id="line-388"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLocalBinds"><span class="hs-identifier hs-type">desugarLocalBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsLocalBinds"><span class="hs-identifier hs-type">HsLocalBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-389"></span><span id="desugarLocalBinds"><span class="annot"><span class="annottext">desugarLocalBinds :: HsLocalBinds GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLocalBinds"><span class="hs-identifier hs-var hs-var">desugarLocalBinds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a></span><span> </span><span class="annot"><span class="annottext">XHsValBinds GhcTc GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#XValBindsLR"><span class="hs-identifier hs-type">XValBindsLR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#NValBinds"><span class="hs-identifier hs-type">NValBinds</span></a></span><span> </span><span id="local-6989586621683128760"><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcTc)]
</span><a href="#local-6989586621683128760"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="annottext">([GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)] -&gt; DsM GrdDag)
-&gt; [[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]] -&gt; DsM GrdDag
forall (f :: * -&gt; *) a.
Applicative f =&gt;
(a -&gt; f GrdDag) -&gt; [a] -&gt; f GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#sequenceGrdDagMapM"><span class="hs-identifier hs-var">sequenceGrdDagMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc) -&gt; DsM GrdDag)
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)] -&gt; DsM GrdDag
forall (f :: * -&gt; *) a.
Applicative f =&gt;
(a -&gt; f GrdDag) -&gt; [a] -&gt; f GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#sequenceGrdDagMapM"><span class="hs-identifier hs-var">sequenceGrdDagMapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBind GhcTc -&gt; DsM GrdDag
GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc) -&gt; DsM GrdDag
</span><a href="#local-6989586621683128761"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RecFlag, [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])
 -&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])
-&gt; [(RecFlag, [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])]
-&gt; [[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(RecFlag, [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(RecFlag, LHsBinds GhcTc)]
[(RecFlag, [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)])]
</span><a href="#local-6989586621683128760"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><a href="#local-6989586621683128761"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621683128761"><span class="annot"><span class="annottext">go :: LHsBind GhcTc -&gt; DsM GrdDag
</span><a href="#local-6989586621683128761"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#FunBind"><span class="hs-identifier hs-type">FunBind</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">fun_id :: forall idL idR. HsBindLR idL idR -&gt; LIdP idL
</span><a href="Language.Haskell.Syntax.Binds.html#fun_id"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128765"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128765"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_matches :: forall idL idR. HsBindLR idL idR -&gt; MatchGroup idR (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Binds.html#fun_matches"><span class="hs-identifier hs-var">fun_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128767"><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621683128767"><span class="hs-identifier hs-var">mg</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>      </span><span class="hs-comment">-- See Note [Long-distance information for HsLocalBinds] for why this</span><span>
</span><span id="line-395"></span><span>      </span><span class="hs-comment">-- pattern match is so very specific.</span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnLW
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">m_pats :: forall p body. Match p body -&gt; XRec p [LPat p]
</span><a href="Language.Haskell.Syntax.Expr.html#m_pats"><span class="hs-identifier hs-var">m_pats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpaLocation
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">m_grhss :: forall p body. Match p body -&gt; GRHSs p body
</span><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128768"><span class="annot"><span class="annottext">GRHSs GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683128768"><span class="hs-identifier hs-var">grhss</span></a></span></span><span class="hs-special">}</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; XRec
     GhcTc [LMatch GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))]
forall p body. MatchGroup p body -&gt; XRec p [LMatch p body]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683128767"><span class="hs-identifier hs-var">mg</span></a></span><span>
</span><span id="line-397"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">grhssGRHSs :: forall p body. GRHSs p body -&gt; [LGRHS p body]
</span><a href="Language.Haskell.Syntax.Expr.html#grhssGRHSs"><span class="hs-identifier hs-var">grhssGRHSs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621683128771"><span class="annot"><span class="annottext">[GuardLStmt GhcTc]
</span><a href="#local-6989586621683128771"><span class="hs-identifier hs-var">_grds</span></a></span></span><span> </span><span id="local-6989586621683128772"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683128772"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GRHSs GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621683128768"><span class="hs-identifier hs-var">grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-398"></span><span>          </span><span id="local-6989586621683128773"><span class="annot"><a href="#local-6989586621683128773"><span class="hs-identifier hs-var">core_rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621683128772"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-399"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GdOne"><span class="hs-identifier hs-type">GdOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-type">PmLet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128765"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128773"><span class="hs-identifier hs-type">core_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>    </span><span class="annot"><a href="#local-6989586621683128761"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#XHsBindsLR"><span class="hs-identifier hs-type">XHsBindsLR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#AbsBinds"><span class="hs-identifier hs-type">AbsBinds</span></a></span><span>
</span><span id="line-401"></span><span>                          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">abs_tvs :: AbsBinds -&gt; [Id]
</span><a href="GHC.Hs.Binds.html#abs_tvs"><span class="hs-identifier hs-var">abs_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_ev_vars :: AbsBinds -&gt; [Id]
</span><a href="GHC.Hs.Binds.html#abs_ev_vars"><span class="hs-identifier hs-var">abs_ev_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-402"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_exports :: AbsBinds -&gt; [ABExport]
</span><a href="GHC.Hs.Binds.html#abs_exports"><span class="hs-identifier hs-var">abs_exports</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621683128779"><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683128779"><span class="hs-identifier hs-var">exports</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abs_binds :: AbsBinds -&gt; LHsBinds GhcTc
</span><a href="GHC.Hs.Binds.html#abs_binds"><span class="hs-identifier hs-var">abs_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128781"><span class="annot"><span class="annottext">LHsBinds GhcTc
</span><a href="#local-6989586621683128781"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-comment">-- Typechecked HsLocalBinds are wrapped in AbsBinds, which carry</span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-comment">-- renamings. See Note [Long-distance information for HsLocalBinds]</span><span>
</span><span id="line-405"></span><span>      </span><span class="hs-comment">-- for the details.</span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621683128782"><span class="hs-identifier hs-type">go_export</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#ABExport"><span class="hs-identifier hs-type">ABExport</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmGrd"><span class="hs-identifier hs-type">PmGrd</span></a></span><span>
</span><span id="line-407"></span><span>          </span><span id="local-6989586621683128782"><span class="annot"><span class="annottext">go_export :: ABExport -&gt; Maybe PmGrd
</span><a href="#local-6989586621683128782"><span class="hs-identifier hs-var hs-var hs-var">go_export</span></a></span></span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#ABE"><span class="hs-identifier hs-type">ABE</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">abe_poly :: ABExport -&gt; Id
</span><a href="GHC.Hs.Binds.html#abe_poly"><span class="hs-identifier hs-var">abe_poly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128785"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128785"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_mono :: ABExport -&gt; Id
</span><a href="GHC.Hs.Binds.html#abe_mono"><span class="hs-identifier hs-var">abe_mono</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128787"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128787"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">abe_wrap :: ABExport -&gt; HsWrapper
</span><a href="GHC.Hs.Binds.html#abe_wrap"><span class="hs-identifier hs-var">abe_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621683128789"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683128789"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-408"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; Bool
</span><a href="GHC.Tc.Types.Evidence.html#isIdHsWrapper"><span class="hs-identifier hs-var">isIdHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621683128789"><span class="hs-identifier hs-var">wrap</span></a></span><span>
</span><span id="line-409"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Maybe PmGrd -&gt; Maybe PmGrd
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128785"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Kind -&gt; Kind -&gt; Bool
Kind -&gt; Kind -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128787"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128785"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128785"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128787"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128787"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe PmGrd -&gt; Maybe PmGrd) -&gt; Maybe PmGrd -&gt; Maybe PmGrd
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-411"></span><span>              </span><span class="annot"><span class="annottext">PmGrd -&gt; Maybe PmGrd
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(PmGrd -&gt; Maybe PmGrd) -&gt; PmGrd -&gt; Maybe PmGrd
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-var">PmLet</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128785"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128787"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-413"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PmGrd
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621683128792"><span class="annot"><span class="annottext">exps :: [PmGrd]
</span><a href="#local-6989586621683128792"><span class="hs-identifier hs-var hs-var hs-var">exps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ABExport -&gt; Maybe PmGrd) -&gt; [ABExport] -&gt; [PmGrd]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">ABExport -&gt; Maybe PmGrd
</span><a href="#local-6989586621683128782"><span class="hs-identifier hs-var">go_export</span></a></span><span> </span><span class="annot"><span class="annottext">[ABExport]
</span><a href="#local-6989586621683128779"><span class="hs-identifier hs-var">exports</span></a></span><span>
</span><span id="line-415"></span><span>      </span><span id="local-6989586621683128794"><span class="annot"><a href="#local-6989586621683128794"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc) -&gt; DsM GrdDag)
-&gt; [GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)] -&gt; DsM GrdDag
forall (f :: * -&gt; *) a.
Applicative f =&gt;
(a -&gt; f GrdDag) -&gt; [a] -&gt; f GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#sequenceGrdDagMapM"><span class="hs-identifier hs-var">sequenceGrdDagMapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBind GhcTc -&gt; DsM GrdDag
GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc) -&gt; DsM GrdDag
</span><a href="#local-6989586621683128761"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
[GenLocated SrcSpanAnnA (HsBindLR GhcTc GhcTc)]
</span><a href="#local-6989586621683128781"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-416"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#sequencePmGrds"><span class="hs-identifier hs-type">sequencePmGrds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128792"><span class="hs-identifier hs-type">exps</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#gdSeq"><span class="hs-operator hs-type">`gdSeq`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128794"><span class="hs-identifier hs-type">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><a href="#local-6989586621683128761"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBind GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdEnd"><span class="hs-identifier hs-var">GdEnd</span></a></span><span>
</span><span id="line-418"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLocalBinds"><span class="hs-identifier hs-var">desugarLocalBinds</span></a></span><span> </span><span id="local-6989586621683128795"><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621683128795"><span class="hs-identifier hs-var">_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdEnd"><span class="hs-identifier hs-var">GdEnd</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">-- | Desugar a pattern guard</span><span>
</span><span id="line-421"></span><span class="hs-comment">--   @pat &lt;- e ==&gt;  let x = e;  &lt;guards for pat &lt;- x&gt;@</span><span>
</span><span id="line-422"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarBind"><span class="hs-identifier hs-type">desugarBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-423"></span><span id="desugarBind"><span class="annot"><span class="annottext">desugarBind :: LPat GhcTc -&gt; LHsExpr GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarBind"><span class="hs-identifier hs-var hs-var">desugarBind</span></a></span></span><span> </span><span id="local-6989586621683128796"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128796"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621683128797"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128797"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128797"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
-&gt; (CoreExpr -&gt; DsM GrdDag) -&gt; DsM GrdDag
forall a b.
IOEnv (Env DsGblEnv DsLclEnv) a
-&gt; (a -&gt; IOEnv (Env DsGblEnv DsLclEnv) b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621683128798"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128798"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe DataCon
</span><a href="GHC.Types.Id.html#isDataConId_maybe"><span class="hs-identifier hs-var">isDataConId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128798"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-comment">-- RHS is a variable, so that will allow us to omit the let</span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; LPat GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPat"><span class="hs-identifier hs-var">desugarLPat</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128798"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128796"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span id="local-6989586621683128800"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683128800"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621683128801"><span class="annot"><a href="#local-6989586621683128801"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621683128802"><span class="annot"><a href="#local-6989586621683128802"><span class="hs-identifier hs-var">grds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc -&gt; DsM (Id, GrdDag)
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarLPatV"><span class="hs-identifier hs-var">desugarLPatV</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621683128796"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-type">PmLet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128801"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128800"><span class="hs-identifier hs-type">rhs</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#consGrdDag"><span class="hs-operator hs-type">`consGrdDag`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128802"><span class="hs-identifier hs-type">grds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-comment">-- | Desugar a boolean guard</span><span>
</span><span id="line-433"></span><span class="hs-comment">--   @e ==&gt;  let x = e; True &lt;- x@</span><span>
</span><span id="line-434"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#desugarBoolGuard"><span class="hs-identifier hs-type">desugarBoolGuard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#GrdDag"><span class="hs-identifier hs-type">GrdDag</span></a></span><span>
</span><span id="line-435"></span><span id="desugarBoolGuard"><span class="annot"><span class="annottext">desugarBoolGuard :: LHsExpr GhcTc -&gt; DsM GrdDag
</span><a href="GHC.HsToCore.Pmc.Desugar.html#desugarBoolGuard"><span class="hs-identifier hs-var hs-var">desugarBoolGuard</span></a></span></span><span> </span><span id="local-6989586621683128803"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128803"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe (CoreExpr -&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc
-&gt; Maybe (CoreExpr -&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr)
</span><a href="GHC.HsToCore.Utils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128803"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdEnd"><span class="hs-identifier hs-var">GdEnd</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-comment">-- The formal thing to do would be to generate (True &lt;- True)</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-comment">-- but it is trivial to solve so instead we give back an empty</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">-- GrdDag for efficiency</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621683128803"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) CoreExpr
-&gt; (CoreExpr -&gt; DsM GrdDag) -&gt; DsM GrdDag
forall a b.
IOEnv (Env DsGblEnv DsLclEnv) a
-&gt; (a -&gt; IOEnv (Env DsGblEnv DsLclEnv) b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-441"></span><span>      </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621683128805"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128805"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe DataCon
</span><a href="GHC.Types.Id.html#isDataConId_maybe"><span class="hs-identifier hs-var">isDataConId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128805"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-443"></span><span>        </span><span class="hs-comment">-- Omit the let by matching on y</span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GrdDag -&gt; DsM GrdDag
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmGrd -&gt; GrdDag
</span><a href="GHC.HsToCore.Pmc.Types.html#GdOne"><span class="hs-identifier hs-var">GdOne</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; DataCon -&gt; [Id] -&gt; PmGrd
</span><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-var">vanillaConGrd</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621683128805"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#trueDataCon"><span class="hs-identifier hs-var">trueDataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>      </span><span id="local-6989586621683128806"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621683128806"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-446"></span><span>        </span><span id="local-6989586621683128807"><span class="annot"><a href="#local-6989586621683128807"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span>
</span><span id="line-447"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#sequencePmGrds"><span class="hs-identifier hs-type">sequencePmGrds</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html#PmLet"><span class="hs-identifier hs-type">PmLet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128807"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128806"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Desugar.html#vanillaConGrd"><span class="hs-identifier hs-type">vanillaConGrd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621683128807"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#trueDataCon"><span class="hs-identifier hs-type">trueDataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="hs-comment">{- Note [Field match order for RecCon]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The order for RecCon field patterns actually determines evaluation order of
the pattern match. For example:

  data T = T { a :: Char, b :: Int }
  f :: T -&gt; ()
  f T{ b = 42, a = 'a' } = ()

Then @f (T (error &quot;a&quot;) (error &quot;b&quot;))@ errors out with &quot;b&quot; because it is mentioned
first in the pattern match.

This means we can't just desugar the pattern match to
@[T a b &lt;- x, 'a' &lt;- a, 42 &lt;- b]@. Instead we have to force them in the
right order: @[T a b &lt;- x, 42 &lt;- b, 'a' &lt;- a]@.

Note [Order of guards matters]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Similar to Note [Field match order for RecCon], the order in which the guards
for a pattern match appear matter. Consider a situation similar to T5117:

  f (0:_)  = ()
  f (0:[]) = ()

The latter clause is clearly redundant. Yet if we desugar the second clause as

  [x:xs' &lt;- xs, [] &lt;- xs', 0 &lt;- x]

We will say that the second clause only has an inaccessible RHS. That's because
we force the tail of the list before comparing its head! So the correct
translation would have been

  [x:xs' &lt;- xs, 0 &lt;- x, [] &lt;- xs']

And we have to take in the guards on list cells into @mkListGrds@.

Note [Desugar CoPats]
~~~~~~~~~~~~~~~~~~~~~~~
The pattern match checker did not know how to handle coerced patterns
`CoPat` efficiently, which gave rise to #11276. The original approach
desugared `CoPat`s:

    pat |&gt; co    ===&gt;    x (pat &lt;- (x |&gt; co))

Why did we do this seemingly unnecessary expansion in the first place?
The reason is that the type of @pat |&gt; co@ (which is the type of the value
abstraction we match against) might be different than that of @pat@. Data
instances such as @Sing (a :: Bool)@ are a good example of this: If we would
just drop the coercion, we'd get a type error when matching @pat@ against its
value abstraction, with the result being that pmIsSatisfiable decides that every
possible data constructor fitting @pat@ is rejected as uninhabited, leading to
a lot of false warnings.

But we can check whether the coercion is a hole or if it is just refl, in
which case we can drop it.

Note [Long-distance information for HsLocalBinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#18626)

  f :: Int -&gt; ()
  f x | y = ()
    where
      y = True

  x :: ()
  x | let y = True, y = ()

Both definitions are exhaustive, but to make the necessary long-distance
connection from @y@'s binding to its use site in a guard, we have to collect
'PmLet' guards for the 'HsLocalBinds' which contain @y@'s definitions.

In principle, we are only interested in desugaring local binds that are
'FunBind's, that

  * Have no pattern matches. If @y@ above had any patterns, it would be a
    function and we can't reason about them anyway.
  * Have singleton match group with a single GRHS.
    Otherwise, what expression to pick in the generated guard @let y = &lt;rhs&gt;@?

It turns out that desugaring type-checked local binds in this way is a bit
more complex than expected: Apparently, all bindings are wrapped in 'AbsBinds'
Nfter type-checking. See Note [AbsBinds] in &quot;GHC.Hs.Binds&quot;.

We make sure that there is no polymorphism in the way by checking that there
are no 'abs_tvs' or 'abs_ev_vars' (we don't reason about
@y :: forall a. Eq a =&gt; ...@) and that the exports carry no 'HsWrapper's. In
this case, the exports are a simple renaming substitution that we can capture
with 'PmLet'. Ultimately we'll hit those renamed 'FunBind's, though, which is
the whole point.

The place to store the 'PmLet' guards for @where@ clauses (which are per
'GRHSs') is as a field of 'PmGRHSs'. For plain @let@ guards as in the guards of
@x@, we can simply add them to the 'pg_grds' field of 'PmGRHS'.

Note [Desugaring -XStrict matches in Pmc]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#21761)

  {-# LANGUAGE Strict #-}
  idV :: Void -&gt; Void
  idV v = v

Without -XStrict, we would not warn here. But with -XStrict, there is an
implicit bang on `v` and we should give an inaccessible warning for the RHS.
The way we account for that is by calling `decideBangHood` on patterns
in a `Match`, which inserts the implicit bang.

Making the call here actually seems redundant with the call to `decideBangHood`
in `GHC.HsToCore.Match.matchWrapper`, which does it *after* it calls the
pattern-match checker on the Match's patterns. It would be great if we could expect
`matchWrapper` to pass the bang-adorned `Match` to the pattern-match checker,
but sadly then we get worse warning messages which would print `idV` as if the
user *had* written a bang:

     Pattern match has inaccessible right hand side
-    In an equation for &#8216;idV&#8217;: idV v = ...
+    In an equation for &#8216;idV&#8217;: idV !v = ...

So we live with the duplication.
-}</span><span>
</span><span id="line-570"></span></pre></body></html>