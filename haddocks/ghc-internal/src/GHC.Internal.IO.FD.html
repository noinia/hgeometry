<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP
           , NoImplicitPrelude
           , BangPatterns
           , RankNTypes
  #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-identities #-}</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Whether there are identities depends on the platform</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# OPTIONS_HADDOCK not-home #-}</span><span>
</span><span id="line-10"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Module      :  GHC.Internal.IO.FD</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow, 1994-2008</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- License     :  see libraries/base/LICENSE</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- Stability   :  internal</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Portability :  non-portable</span><span>
</span><span id="line-19"></span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- Raw read/write operations on file descriptors</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html"><span class="hs-identifier">GHC.Internal.IO.FD</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier">FD</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Internal.IO.FD.html#openFileWith"><span class="hs-identifier">openFileWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#openFile"><span class="hs-identifier">openFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#mkFD"><span class="hs-identifier">mkFD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#release"><span class="hs-identifier">release</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Internal.IO.FD.html#setNonBlockingMode"><span class="hs-identifier">setNonBlockingMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Internal.IO.FD.html#readRawBufferPtr"><span class="hs-identifier">readRawBufferPtr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#readRawBufferPtrNoBlock"><span class="hs-identifier">readRawBufferPtrNoBlock</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#writeRawBufferPtr"><span class="hs-identifier">writeRawBufferPtr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Internal.IO.FD.html#stdin"><span class="hs-identifier">stdin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#stdout"><span class="hs-identifier">stdout</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#stderr"><span class="hs-identifier">stderr</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html"><span class="hs-identifier">GHC.Internal.Base</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Bits.html"><span class="hs-identifier">GHC.Internal.Bits</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Num.html"><span class="hs-identifier">GHC.Internal.Num</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Real.html"><span class="hs-identifier">GHC.Internal.Real</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Show.html"><span class="hs-identifier">GHC.Internal.Show</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Enum.html"><span class="hs-identifier">GHC.Internal.Enum</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html"><span class="hs-identifier">GHC.Internal.Word</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Int.html"><span class="hs-identifier">GHC.Internal.Int</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html"><span class="hs-identifier">GHC.Internal.Ptr</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.IO.html"><span class="hs-identifier">GHC.Internal.IO</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.IO.IOMode.html"><span class="hs-identifier">GHC.Internal.IO.IOMode</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Buffer.html"><span class="hs-identifier">GHC.Internal.IO.Buffer</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.IO.BufferedIO.html"><span class="hs-identifier">GHC.Internal.IO.BufferedIO</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html"><span class="hs-identifier">GHC.Internal.IO.Device</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html"><span class="hs-identifier">GHC.Internal.IO.Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.Device.html#SeekMode"><span class="hs-identifier">SeekMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#IODeviceType"><span class="hs-identifier">IODeviceType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Conc.IO.html"><span class="hs-identifier">GHC.Internal.Conc.IO</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Exception.html"><span class="hs-identifier">GHC.Internal.IO.Exception</span></a></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Internal.Windows</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Internal.Data.Bool</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Internal.IO.SubSystem</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator">&lt;!&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Internal.Foreign.Storable</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html"><span class="hs-identifier">GHC.Internal.Foreign.C.Types</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Error.html"><span class="hs-identifier">GHC.Internal.Foreign.C.Error</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.Marshal.Utils.html"><span class="hs-identifier">GHC.Internal.Foreign.Marshal.Utils</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.Marshal.Alloc.html"><span class="hs-identifier">GHC.Internal.Foreign.Marshal.Alloc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Foreign.Marshal.Alloc.html#allocaBytes"><span class="hs-identifier">allocaBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Internals.html"><span class="hs-identifier">GHC.Internal.System.Posix.Internals</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Internals.html"><span class="hs-identifier">GHC.Internal.System.Posix.Internals</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.System.Posix.Internals.html#FD"><span class="hs-identifier">FD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Internals.html#setEcho"><span class="hs-identifier">setEcho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Internals.html#getEcho"><span class="hs-identifier">getEcho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html"><span class="hs-identifier">GHC.Internal.System.Posix.Types</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#c_DEBUG_DUMP"><span class="hs-identifier hs-type">c_DEBUG_DUMP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-67"></span><span id="c_DEBUG_DUMP"><span class="annot"><span class="annottext">c_DEBUG_DUMP :: Bool
</span><a href="GHC.Internal.IO.FD.html#c_DEBUG_DUMP"><span class="hs-identifier hs-var hs-var">c_DEBUG_DUMP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- Darwin limits the length of writes to 2GB. See #17414.</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- Moreover, Linux will only transfer up to 0x7ffff000 and interpreting the</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- result of write/read is tricky above 2GB due to its signed type. For</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- simplicity we therefore clamp on all platforms.</span><span>
</span><span id="line-73"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#clampWriteSize"><span class="hs-identifier hs-type">clampWriteSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#clampReadSize"><span class="hs-identifier hs-type">clampReadSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-74"></span><span id="clampWriteSize"><span class="annot"><span class="annottext">clampWriteSize :: Int -&gt; Int
</span><a href="GHC.Internal.IO.FD.html#clampWriteSize"><span class="hs-identifier hs-var hs-var">clampWriteSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#min"><span class="hs-identifier hs-var">min</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x7ffff000</span></span><span>
</span><span id="line-75"></span><span id="clampReadSize"><span class="annot"><span class="annottext">clampReadSize :: Int -&gt; Int
</span><a href="GHC.Internal.IO.FD.html#clampReadSize"><span class="hs-identifier hs-var hs-var">clampReadSize</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#min"><span class="hs-identifier hs-var">min</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0x7ffff000</span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- The file-descriptor IO device</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">data</span><span> </span><span id="FD"><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-var">FD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FD"><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-var">FD</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-81"></span><span>  </span><span id="fdFD"><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var hs-var">fdFD</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span class="hs-special">,</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>  </span><span class="hs-comment">-- | On Windows, a socket file descriptor needs to be read and written</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-comment">-- using different functions (send/recv).</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-identifier">fdIsSocket_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">Int</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-comment">-- | On Unix we need to know whether this 'FD' has @O_NONBLOCK@ set.</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-comment">-- If it has, then we can use more efficient routines (namely, unsafe FFI)</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- to read/write to it. Otherwise safe FFI is used.</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-comment">-- @O_NONBLOCK@ has no effect on regular files and block devices at the moment,</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- thus this flag should be off for them. While reading from a file cannot</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- block indefinitely (as opposed to reading from a socket or a pipe), it can block</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-comment">-- the entire runtime for a &quot;brief&quot; moment of time: you cannot read a file from</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-comment">-- a floppy drive or network share without delay.</span><span>
</span><span id="line-96"></span><span>  </span><span id="fdIsNonBlocking"><span class="annot"><span class="annottext">FD -&gt; Int
</span><a href="GHC.Internal.IO.FD.html#fdIsNonBlocking"><span class="hs-identifier hs-var hs-var">fdIsNonBlocking</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-cpp">
#endif
</span><span> </span><span class="hs-special">}</span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><span id="line-102"></span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fdIsSocket_</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-105"></span><span class="annot"><span class="hs-comment">-- | @since base-4.1.0.0</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679822772"><span id="local-6989586621679822776"><span class="annot"><a href="GHC.Internal.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>  </span><span id="local-6989586621679822781"><span class="annot"><span class="annottext">show :: FD -&gt; String
</span><a href="#local-6989586621679822781"><span class="hs-identifier hs-var hs-var hs-var">show</span></a></span></span><span> </span><span id="local-6989586621679822783"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822783"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Internal.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822783"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-pragma hs-type">ifSupported</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-110"></span><span id="local-6989586621679822440"><span class="annot"><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-type">ifSupported</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679822440"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679822440"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span class="hs-identifier">ifSupported</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-operator">&lt;!&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">error</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;FD:&quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot; not supported&quot;</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span id="ifSupported"><span class="annot"><span class="annottext">ifSupported :: forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var hs-var">ifSupported</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><a href="GHC.Internal.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-117"></span><span class="annot"><span class="hs-comment">-- | @since base-4.1.0.0</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#RawIO"><span class="hs-identifier hs-type">GHC.Internal.IO.Device.RawIO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621679822791"><span class="annot"><span class="annottext">read :: FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO Int
</span><a href="#local-6989586621679822791"><span class="hs-identifier hs-var hs-var hs-var">read</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO Int)
-&gt; FD
-&gt; Ptr Word8
-&gt; Word64
-&gt; Int
-&gt; IO Int
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fdRead&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO Int
</span><a href="GHC.Internal.IO.FD.html#fdRead"><span class="hs-identifier hs-var">fdRead</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span id="local-6989586621679822794"><span class="annot"><span class="annottext">readNonBlocking :: FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621679822794"><span class="hs-identifier hs-var hs-var hs-var">readNonBlocking</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO (Maybe Int))
-&gt; FD
-&gt; Ptr Word8
-&gt; Word64
-&gt; Int
-&gt; IO (Maybe Int)
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fdReadNonBlocking&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO (Maybe Int)
</span><a href="GHC.Internal.IO.FD.html#fdReadNonBlocking"><span class="hs-identifier hs-var">fdReadNonBlocking</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621679822797"><span class="annot"><span class="annottext">write :: FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679822797"><span class="hs-identifier hs-var hs-var hs-var">write</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO ())
-&gt; FD
-&gt; Ptr Word8
-&gt; Word64
-&gt; Int
-&gt; IO ()
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fdWrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#fdWrite"><span class="hs-identifier hs-var">fdWrite</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621679822800"><span class="annot"><span class="annottext">writeNonBlocking :: FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO Int
</span><a href="#local-6989586621679822800"><span class="hs-identifier hs-var hs-var hs-var">writeNonBlocking</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO Int)
-&gt; FD
-&gt; Ptr Word8
-&gt; Word64
-&gt; Int
-&gt; IO Int
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fdWriteNonBlocking&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO Int
</span><a href="GHC.Internal.IO.FD.html#fdWriteNonBlocking"><span class="hs-identifier hs-var">fdWriteNonBlocking</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><span class="hs-comment">-- | @since base-4.1.0.0</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#IODevice"><span class="hs-identifier hs-type">GHC.Internal.IO.Device.IODevice</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621679822819"><span class="annot"><span class="annottext">ready :: FD -&gt; Bool -&gt; Int -&gt; IO Bool
</span><a href="#local-6989586621679822819"><span class="hs-identifier hs-var hs-var hs-var">ready</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (FD -&gt; Bool -&gt; Int -&gt; IO Bool) -&gt; FD -&gt; Bool -&gt; Int -&gt; IO Bool
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ready&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Bool -&gt; Int -&gt; IO Bool
</span><a href="GHC.Internal.IO.FD.html#ready"><span class="hs-identifier hs-var">ready</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621679822822"><span class="annot"><span class="annottext">close :: FD -&gt; IO ()
</span><a href="#local-6989586621679822822"><span class="hs-identifier hs-var hs-var hs-var">close</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; IO ()) -&gt; FD -&gt; IO ()
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;close&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#close"><span class="hs-identifier hs-var">close</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621679822825"><span class="annot"><span class="annottext">isTerminal :: FD -&gt; IO Bool
</span><a href="#local-6989586621679822825"><span class="hs-identifier hs-var hs-var hs-var">isTerminal</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; IO Bool) -&gt; FD -&gt; IO Bool
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;isTerm&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO Bool
</span><a href="GHC.Internal.IO.FD.html#isTerminal"><span class="hs-identifier hs-var">isTerminal</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621679822828"><span class="annot"><span class="annottext">isSeekable :: FD -&gt; IO Bool
</span><a href="#local-6989586621679822828"><span class="hs-identifier hs-var hs-var hs-var">isSeekable</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; IO Bool) -&gt; FD -&gt; IO Bool
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;isSeek&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO Bool
</span><a href="GHC.Internal.IO.FD.html#isSeekable"><span class="hs-identifier hs-var">isSeekable</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621679822831"><span class="annot"><span class="annottext">seek :: FD -&gt; SeekMode -&gt; Integer -&gt; IO Integer
</span><a href="#local-6989586621679822831"><span class="hs-identifier hs-var hs-var hs-var">seek</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (FD -&gt; SeekMode -&gt; Integer -&gt; IO Integer)
-&gt; FD
-&gt; SeekMode
-&gt; Integer
-&gt; IO Integer
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;seek&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; SeekMode -&gt; Integer -&gt; IO Integer
</span><a href="GHC.Internal.IO.FD.html#seek"><span class="hs-identifier hs-var">seek</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621679822834"><span class="annot"><span class="annottext">tell :: FD -&gt; IO Integer
</span><a href="#local-6989586621679822834"><span class="hs-identifier hs-var hs-var hs-var">tell</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; IO Integer) -&gt; FD -&gt; IO Integer
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tell&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO Integer
</span><a href="GHC.Internal.IO.FD.html#tell"><span class="hs-identifier hs-var">tell</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span id="local-6989586621679822837"><span class="annot"><span class="annottext">getSize :: FD -&gt; IO Integer
</span><a href="#local-6989586621679822837"><span class="hs-identifier hs-var hs-var hs-var">getSize</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; IO Integer) -&gt; FD -&gt; IO Integer
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getSize&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO Integer
</span><a href="GHC.Internal.IO.FD.html#getSize"><span class="hs-identifier hs-var">getSize</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span id="local-6989586621679822840"><span class="annot"><span class="annottext">setSize :: FD -&gt; Integer -&gt; IO ()
</span><a href="#local-6989586621679822840"><span class="hs-identifier hs-var hs-var hs-var">setSize</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; Integer -&gt; IO ()) -&gt; FD -&gt; Integer -&gt; IO ()
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setSize&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Integer -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#setSize"><span class="hs-identifier hs-var">setSize</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span id="local-6989586621679822843"><span class="annot"><span class="annottext">setEcho :: FD -&gt; Bool -&gt; IO ()
</span><a href="#local-6989586621679822843"><span class="hs-identifier hs-var hs-var hs-var">setEcho</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; Bool -&gt; IO ()) -&gt; FD -&gt; Bool -&gt; IO ()
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setEcho&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Bool -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#setEcho"><span class="hs-identifier hs-var">setEcho</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span id="local-6989586621679822846"><span class="annot"><span class="annottext">getEcho :: FD -&gt; IO Bool
</span><a href="#local-6989586621679822846"><span class="hs-identifier hs-var hs-var hs-var">getEcho</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; IO Bool) -&gt; FD -&gt; IO Bool
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getEcho&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO Bool
</span><a href="GHC.Internal.IO.FD.html#getEcho"><span class="hs-identifier hs-var">getEcho</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621679822849"><span class="annot"><span class="annottext">setRaw :: FD -&gt; Bool -&gt; IO ()
</span><a href="#local-6989586621679822849"><span class="hs-identifier hs-var hs-var hs-var">setRaw</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; Bool -&gt; IO ()) -&gt; FD -&gt; Bool -&gt; IO ()
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setRaw&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Bool -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#setRaw"><span class="hs-identifier hs-var">setRaw</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621679822852"><span class="annot"><span class="annottext">devType :: FD -&gt; IO IODeviceType
</span><a href="#local-6989586621679822852"><span class="hs-identifier hs-var hs-var hs-var">devType</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; IO IODeviceType) -&gt; FD -&gt; IO IODeviceType
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;devType&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO IODeviceType
</span><a href="GHC.Internal.IO.FD.html#devType"><span class="hs-identifier hs-var">devType</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span id="local-6989586621679822855"><span class="annot"><span class="annottext">dup :: FD -&gt; IO FD
</span><a href="#local-6989586621679822855"><span class="hs-identifier hs-var hs-var hs-var">dup</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; IO FD) -&gt; FD -&gt; IO FD
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dup&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO FD
</span><a href="GHC.Internal.IO.FD.html#dup"><span class="hs-identifier hs-var">dup</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span id="local-6989586621679822858"><span class="annot"><span class="annottext">dup2 :: FD -&gt; FD -&gt; IO FD
</span><a href="#local-6989586621679822858"><span class="hs-identifier hs-var hs-var hs-var">dup2</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (FD -&gt; FD -&gt; IO FD) -&gt; FD -&gt; FD -&gt; IO FD
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dup2&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD -&gt; FD -&gt; IO FD
</span><a href="GHC.Internal.IO.FD.html#dup2"><span class="hs-identifier hs-var">dup2</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- We used to use GHC.Internal.System.Posix.Internals.dEFAULT_BUFFER_SIZE, which is</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- taken from the value of BUFSIZ on the current platform.  This value</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- varies too much though: it is 512 on Windows, 1024 on OS X and 8192</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- on Linux.  So let's just use a decent size on every platform:</span><span>
</span><span id="line-145"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#dEFAULT_FD_BUFFER_SIZE"><span class="hs-identifier hs-type">dEFAULT_FD_BUFFER_SIZE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-146"></span><span id="dEFAULT_FD_BUFFER_SIZE"><span class="annot"><span class="annottext">dEFAULT_FD_BUFFER_SIZE :: Int
</span><a href="GHC.Internal.IO.FD.html#dEFAULT_FD_BUFFER_SIZE"><span class="hs-identifier hs-var hs-var">dEFAULT_FD_BUFFER_SIZE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8192</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><span class="hs-comment">-- | @since base-4.1.0.0</span></span><span>
</span><span id="line-149"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679822866"><span class="annot"><a href="GHC.Internal.IO.BufferedIO.html#BufferedIO"><span class="hs-identifier hs-type">BufferedIO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621679822872"><span class="annot"><span class="annottext">newBuffer :: FD -&gt; BufferState -&gt; IO (Buffer Word8)
</span><a href="#local-6989586621679822872"><span class="hs-identifier hs-var hs-var hs-var">newBuffer</span></a></span></span><span> </span><span id="local-6989586621679822874"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822874"><span class="hs-identifier hs-var">_dev</span></a></span></span><span> </span><span id="local-6989586621679822875"><span class="annot"><span class="annottext">BufferState
</span><a href="#local-6989586621679822875"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Buffer Word8) -&gt; IO (Buffer Word8)
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newBuf&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO (Buffer Word8) -&gt; IO (Buffer Word8))
-&gt; IO (Buffer Word8) -&gt; IO (Buffer Word8)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; BufferState -&gt; IO (Buffer Word8)
</span><a href="GHC.Internal.IO.Buffer.html#newByteBuffer"><span class="hs-identifier hs-var">newByteBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Internal.IO.FD.html#dEFAULT_FD_BUFFER_SIZE"><span class="hs-identifier hs-var">dEFAULT_FD_BUFFER_SIZE</span></a></span><span> </span><span class="annot"><span class="annottext">BufferState
</span><a href="#local-6989586621679822875"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621679822877"><span class="annot"><span class="annottext">fillReadBuffer :: FD -&gt; Buffer Word8 -&gt; IO (Int, Buffer Word8)
</span><a href="#local-6989586621679822877"><span class="hs-identifier hs-var hs-var hs-var">fillReadBuffer</span></a></span></span><span>    </span><span id="local-6989586621679822879"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822879"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679822880"><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822880"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Int, Buffer Word8) -&gt; IO (Int, Buffer Word8)
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readBuf&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO (Int, Buffer Word8) -&gt; IO (Int, Buffer Word8))
-&gt; IO (Int, Buffer Word8) -&gt; IO (Int, Buffer Word8)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Buffer Word8 -&gt; IO (Int, Buffer Word8)
</span><a href="GHC.Internal.IO.FD.html#readBuf%27"><span class="hs-identifier hs-var">readBuf'</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822879"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822880"><span class="hs-identifier hs-var">buf</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span id="local-6989586621679822883"><span class="annot"><span class="annottext">fillReadBuffer0 :: FD -&gt; Buffer Word8 -&gt; IO (Maybe Int, Buffer Word8)
</span><a href="#local-6989586621679822883"><span class="hs-identifier hs-var hs-var hs-var">fillReadBuffer0</span></a></span></span><span>   </span><span id="local-6989586621679822885"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822885"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679822886"><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822886"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; IO (Maybe Int, Buffer Word8) -&gt; IO (Maybe Int, Buffer Word8)
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readBufNonBlock&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Int, Buffer Word8) -&gt; IO (Maybe Int, Buffer Word8))
-&gt; IO (Maybe Int, Buffer Word8) -&gt; IO (Maybe Int, Buffer Word8)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Buffer Word8 -&gt; IO (Maybe Int, Buffer Word8)
forall dev.
RawIO dev =&gt;
dev -&gt; Buffer Word8 -&gt; IO (Maybe Int, Buffer Word8)
</span><a href="GHC.Internal.IO.BufferedIO.html#readBufNonBlocking"><span class="hs-identifier hs-var">readBufNonBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822885"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822886"><span class="hs-identifier hs-var">buf</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621679822888"><span class="annot"><span class="annottext">flushWriteBuffer :: FD -&gt; Buffer Word8 -&gt; IO (Buffer Word8)
</span><a href="#local-6989586621679822888"><span class="hs-identifier hs-var hs-var hs-var">flushWriteBuffer</span></a></span></span><span>  </span><span id="local-6989586621679822890"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822890"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679822891"><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822891"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Buffer Word8) -&gt; IO (Buffer Word8)
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writeBuf&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO (Buffer Word8) -&gt; IO (Buffer Word8))
-&gt; IO (Buffer Word8) -&gt; IO (Buffer Word8)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Buffer Word8 -&gt; IO (Buffer Word8)
</span><a href="GHC.Internal.IO.FD.html#writeBuf%27"><span class="hs-identifier hs-var">writeBuf'</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822890"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822891"><span class="hs-identifier hs-var">buf</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621679822894"><span class="annot"><span class="annottext">flushWriteBuffer0 :: FD -&gt; Buffer Word8 -&gt; IO (Int, Buffer Word8)
</span><a href="#local-6989586621679822894"><span class="hs-identifier hs-var hs-var hs-var">flushWriteBuffer0</span></a></span></span><span> </span><span id="local-6989586621679822896"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822896"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679822897"><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822897"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Int, Buffer Word8) -&gt; IO (Int, Buffer Word8)
forall a. String -&gt; a -&gt; a
</span><a href="GHC.Internal.IO.FD.html#ifSupported"><span class="hs-identifier hs-var">ifSupported</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writeBufNonBlock&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO (Int, Buffer Word8) -&gt; IO (Int, Buffer Word8))
-&gt; IO (Int, Buffer Word8) -&gt; IO (Int, Buffer Word8)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FD -&gt; Buffer Word8 -&gt; IO (Int, Buffer Word8)
forall dev.
RawIO dev =&gt;
dev -&gt; Buffer Word8 -&gt; IO (Int, Buffer Word8)
</span><a href="GHC.Internal.IO.BufferedIO.html#writeBufNonBlocking"><span class="hs-identifier hs-var">writeBufNonBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822896"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822897"><span class="hs-identifier hs-var">buf</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#readBuf%27"><span class="hs-identifier hs-type">readBuf'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span id="readBuf%27"><span class="annot"><span class="annottext">readBuf' :: FD -&gt; Buffer Word8 -&gt; IO (Int, Buffer Word8)
</span><a href="GHC.Internal.IO.FD.html#readBuf%27"><span class="hs-identifier hs-var hs-var">readBuf'</span></a></span></span><span> </span><span id="local-6989586621679822899"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822899"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679822900"><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822900"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="GHC.Internal.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.IO.FD.html#c_DEBUG_DUMP"><span class="hs-identifier hs-var">c_DEBUG_DUMP</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.Internal.System.Posix.Internals.html#puts"><span class="hs-identifier hs-var">puts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;readBuf fd=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">FD -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Internal.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822899"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8 -&gt; String
forall a. Buffer a -&gt; String
</span><a href="GHC.Internal.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-var">summaryBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822900"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679822904"><span class="annot"><a href="#local-6989586621679822904"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679822905"><span class="annot"><a href="#local-6989586621679822905"><span class="hs-identifier hs-var">buf'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FD -&gt; Buffer Word8 -&gt; IO (Int, Buffer Word8)
forall dev.
RawIO dev =&gt;
dev -&gt; Buffer Word8 -&gt; IO (Int, Buffer Word8)
</span><a href="GHC.Internal.IO.BufferedIO.html#readBuf"><span class="hs-identifier hs-var">readBuf</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822899"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822900"><span class="hs-identifier hs-var">buf</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><a href="GHC.Internal.Base.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#c_DEBUG_DUMP"><span class="hs-identifier hs-type">c_DEBUG_DUMP</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><a href="GHC.Internal.System.Posix.Internals.html#puts"><span class="hs-identifier hs-type">puts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;after: &quot;</span></span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-type">summaryBuffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822905"><span class="hs-identifier hs-type">buf'</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679822904"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679822905"><span class="hs-identifier hs-type">buf'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#writeBuf%27"><span class="hs-identifier hs-type">writeBuf'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span id="writeBuf%27"><span class="annot"><span class="annottext">writeBuf' :: FD -&gt; Buffer Word8 -&gt; IO (Buffer Word8)
</span><a href="GHC.Internal.IO.FD.html#writeBuf%27"><span class="hs-identifier hs-var hs-var">writeBuf'</span></a></span></span><span> </span><span id="local-6989586621679822907"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822907"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679822908"><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822908"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="GHC.Internal.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.IO.FD.html#c_DEBUG_DUMP"><span class="hs-identifier hs-var">c_DEBUG_DUMP</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="GHC.Internal.System.Posix.Internals.html#puts"><span class="hs-identifier hs-var">puts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writeBuf fd=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">FD -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="GHC.Internal.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822907"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8 -&gt; String
forall a. Buffer a -&gt; String
</span><a href="GHC.Internal.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-var">summaryBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822908"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Internal.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">FD -&gt; Buffer Word8 -&gt; IO (Buffer Word8)
forall dev. RawIO dev =&gt; dev -&gt; Buffer Word8 -&gt; IO (Buffer Word8)
</span><a href="GHC.Internal.IO.BufferedIO.html#writeBuf"><span class="hs-identifier hs-var">writeBuf</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822907"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer Word8
</span><a href="#local-6989586621679822908"><span class="hs-identifier hs-var">buf</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- opening files</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | Open a file and make an 'FD' for it. Truncates the file to zero size when</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- the `IOMode` is `WriteMode`.</span><span>
</span><span id="line-176"></span><span class="hs-comment">--</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- `openFileWith` takes two actions, @act1@ and @act2@, to perform after</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- opening the file.</span><span>
</span><span id="line-179"></span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- @act1@ is passed a file descriptor and I/O device type for the newly opened</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- file. If an exception occurs in @act1@, then the file will be closed.</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- @act1@ /must not/ close the file itself. If it does so and then receives an</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- exception, then the exception handler will attempt to close it again, which</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- is impermissible.</span><span>
</span><span id="line-185"></span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- @act2@ is performed with asynchronous exceptions masked. It is passed a</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- function to restore the masking state and the result of @act1@.  It /must</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- not/ throw an exception (or deliver one via an interruptible operation)</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- without first closing the file or arranging for it to be closed. @act2@</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- /may/ close the file, but is not required to do so.  If @act2@ leaves the</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- file open, then the file will remain open on return from `openFileWith`.</span><span>
</span><span id="line-192"></span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- Code calling `openFileWith` that wishes to install a finalizer to close</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- the file should do so in @act2@. Doing so in @act1@ could potentially close</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- the file in the finalizer first and then in the exception handler. See</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- 'GHC.Internal.IO.Handle.FD.openFile'' for an example of this use. Regardless, the</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- caller is responsible for ensuring that the file is eventually closed,</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- perhaps using 'GHC.Internal.Control.Exception.bracket'.</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="local-6989586621679822464"><span id="local-6989586621679822466"><span class="annot"><a href="GHC.Internal.IO.FD.html#openFileWith"><span class="hs-identifier hs-type">openFileWith</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ file to open</span></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.IOMode.html#IOMode"><span class="hs-identifier hs-type">IOMode</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ mode in which to open the file</span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>     </span><span class="hs-comment">-- ^ open the file in non-blocking mode?</span><span>
</span><span id="line-204"></span><span>              </span><span class="hs-comment">--   This has no effect on regular files and block devices:</span><span>
</span><span id="line-205"></span><span>              </span><span class="hs-comment">--   they are always opened in blocking mode.</span><span>
</span><span id="line-206"></span><span>              </span><span class="hs-comment">--   See 'fdIsNonBlocking' for more discussion.</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#IODeviceType"><span class="hs-identifier hs-type">IODeviceType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822464"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ @act1@: An action to perform</span><span>
</span><span id="line-208"></span><span>                    </span><span class="hs-comment">-- on the file descriptor with the masking state</span><span>
</span><span id="line-209"></span><span>                    </span><span class="hs-comment">-- restored and an exception handler that closes</span><span>
</span><span id="line-210"></span><span>                    </span><span class="hs-comment">-- the file on exception.</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679822465"><span class="annot"><a href="#local-6989586621679822465"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822465"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822465"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679822464"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822466"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>                    </span><span class="hs-comment">-- ^ @act2@: An action to perform with async exceptions</span><span>
</span><span id="line-213"></span><span>                    </span><span class="hs-comment">-- masked and no exception handler.</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822466"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-215"></span><span id="openFileWith"><span class="annot"><span class="annottext">openFileWith :: forall r s.
String
-&gt; IOMode
-&gt; Bool
-&gt; (FD -&gt; IODeviceType -&gt; IO r)
-&gt; ((forall x. IO x -&gt; IO x) -&gt; r -&gt; IO s)
-&gt; IO s
</span><a href="GHC.Internal.IO.FD.html#openFileWith"><span class="hs-identifier hs-var hs-var">openFileWith</span></a></span></span><span> </span><span id="local-6989586621679822925"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679822925"><span class="hs-identifier hs-var">filepath</span></a></span></span><span> </span><span id="local-6989586621679822926"><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679822926"><span class="hs-identifier hs-var">iomode</span></a></span></span><span> </span><span id="local-6989586621679822927"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679822927"><span class="hs-identifier hs-var">non_blocking</span></a></span></span><span> </span><span id="local-6989586621679822928"><span class="annot"><span class="annottext">FD -&gt; IODeviceType -&gt; IO r
</span><a href="#local-6989586621679822928"><span class="hs-identifier hs-var">act1</span></a></span></span><span> </span><span id="local-6989586621679822929"><span class="annot"><span class="annottext">(forall x. IO x -&gt; IO x) -&gt; r -&gt; IO s
</span><a href="#local-6989586621679822929"><span class="hs-identifier hs-var">act2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; (CString -&gt; IO s) -&gt; IO s
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><a href="GHC.Internal.System.Posix.Internals.html#withFilePath"><span class="hs-identifier hs-var">withFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679822925"><span class="hs-identifier hs-var">filepath</span></a></span><span> </span><span class="annot"><span class="annottext">((CString -&gt; IO s) -&gt; IO s) -&gt; (CString -&gt; IO s) -&gt; IO s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679822931"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679822931"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-218"></span><span>      </span><span id="local-6989586621679822932"><span class="annot"><span class="annottext">oflags1 :: CInt
</span><a href="#local-6989586621679822932"><span class="hs-identifier hs-var hs-var">oflags1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679822926"><span class="hs-identifier hs-var">iomode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>                  </span><span class="annot"><span class="annottext">IOMode
</span><a href="GHC.Internal.IO.IOMode.html#ReadMode"><span class="hs-identifier hs-var">ReadMode</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#read_flags"><span class="hs-identifier hs-var">read_flags</span></a></span><span>
</span><span id="line-220"></span><span>                  </span><span class="annot"><span class="annottext">IOMode
</span><a href="GHC.Internal.IO.IOMode.html#WriteMode"><span class="hs-identifier hs-var">WriteMode</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#write_flags"><span class="hs-identifier hs-var">write_flags</span></a></span><span>
</span><span id="line-221"></span><span>                  </span><span class="annot"><span class="annottext">IOMode
</span><a href="GHC.Internal.IO.IOMode.html#ReadWriteMode"><span class="hs-identifier hs-var">ReadWriteMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#rw_flags"><span class="hs-identifier hs-var">rw_flags</span></a></span><span>
</span><span id="line-222"></span><span>                  </span><span class="annot"><span class="annottext">IOMode
</span><a href="GHC.Internal.IO.IOMode.html#AppendMode"><span class="hs-identifier hs-var">AppendMode</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#append_flags"><span class="hs-identifier hs-var">append_flags</span></a></span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span>      </span><span class="hs-identifier">binary_flags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">o_BINARY</span><span class="hs-cpp">
#else
</span><span>      </span><span id="local-6989586621679822941"><span class="annot"><span class="annottext">binary_flags :: CInt
</span><a href="#local-6989586621679822941"><span class="hs-identifier hs-var hs-var">binary_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">0</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-230"></span><span>      </span><span id="local-6989586621679822943"><span class="annot"><span class="annottext">oflags2 :: CInt
</span><a href="#local-6989586621679822943"><span class="hs-identifier hs-var hs-var">oflags2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822932"><span class="hs-identifier hs-var">oflags1</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; CInt
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Internal.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822941"><span class="hs-identifier hs-var">binary_flags</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621679822946"><span class="annot"><span class="annottext">oflags :: CInt
</span><a href="#local-6989586621679822946"><span class="hs-identifier hs-var hs-var">oflags</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679822927"><span class="hs-identifier hs-var">non_blocking</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822943"><span class="hs-identifier hs-var">oflags2</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; CInt
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Internal.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#nonblock_flags"><span class="hs-identifier hs-var">nonblock_flags</span></a></span><span>
</span><span id="line-233"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822943"><span class="hs-identifier hs-var">oflags2</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-comment">-- We want to be sure all the arguments to c_interruptible_open</span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-comment">-- are fully evaluated *before* it slips under a mask (assuming we're</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-comment">-- not already under a user-imposed mask).</span><span>
</span><span id="line-238"></span><span>      </span><span id="local-6989586621679822948"><span class="annot"><a href="#local-6989586621679822948"><span class="hs-identifier hs-var">oflags'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; IO CInt
forall a. a -&gt; IO a
</span><a href="GHC.Internal.IO.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822946"><span class="hs-identifier hs-var">oflags</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-comment">-- NB. always use a safe open(), because we don't know whether open()</span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-comment">-- will be fast or not.  It can be slow on NFS and FUSE filesystems,</span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-comment">-- for example.</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><a href="GHC.Internal.IO.html#mask"><span class="hs-identifier hs-type">mask</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679822951"><span class="annot"><span class="annottext">forall x. IO x -&gt; IO x
</span><a href="#local-6989586621679822951"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-244"></span><span>        </span><span id="local-6989586621679822952"><span class="annot"><a href="#local-6989586621679822952"><span class="hs-identifier hs-var">fileno</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO CInt
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1Retry"><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;openFile&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO CInt) -&gt; IO CInt -&gt; IO CInt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-245"></span><span>                </span><span class="annot"><span class="annottext">CString -&gt; CInt -&gt; CMode -&gt; IO CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#c_interruptible_open"><span class="hs-identifier hs-var">c_interruptible_open</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679822931"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822948"><span class="hs-identifier hs-var">oflags'</span></a></span><span> </span><span class="annot"><span class="annottext">CMode
</span><span class="hs-number">0o666</span></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679822955"><span class="annot"><a href="#local-6989586621679822955"><span class="hs-identifier hs-var">fD</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679822956"><span class="annot"><a href="#local-6989586621679822956"><span class="hs-identifier hs-var">fd_type</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#mkFD"><span class="hs-identifier hs-type">mkFD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822952"><span class="hs-identifier hs-type">fileno</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822926"><span class="hs-identifier hs-type">iomode</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-type">Nothing</span></a></span><span class="hs-comment">{-no stat-}</span><span>
</span><span id="line-248"></span><span>                                </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#False"><span class="hs-identifier hs-type">False</span></a></span><span class="hs-comment">{-not a socket-}</span><span>
</span><span id="line-249"></span><span>                                </span><span class="annot"><a href="#local-6989586621679822927"><span class="hs-identifier hs-type">non_blocking</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.html#onException"><span class="hs-operator hs-type">`onException`</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Internals.html#c_close"><span class="hs-identifier hs-type">c_close</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822952"><span class="hs-identifier hs-type">fileno</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-comment">-- we want to truncate() if this is an open in WriteMode, but only</span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-comment">-- if the target is a RegularFile.  ftruncate() fails on special files</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-comment">-- like /dev/null.</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><a href="GHC.Internal.Base.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679822926"><span class="hs-identifier hs-type">iomode</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.IOMode.html#WriteMode"><span class="hs-identifier hs-type">WriteMode</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-type">&amp;&amp;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822956"><span class="hs-identifier hs-type">fd_type</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#RegularFile"><span class="hs-identifier hs-type">RegularFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span>
</span><span id="line-256"></span><span>          </span><span class="annot"><a href="GHC.Internal.IO.FD.html#setSize"><span class="hs-identifier hs-type">setSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822955"><span class="hs-identifier hs-type">fD</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="GHC.Internal.IO.html#onException"><span class="hs-operator hs-type">`onException`</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#close"><span class="hs-identifier hs-type">close</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822955"><span class="hs-identifier hs-type">fD</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>        </span><span id="local-6989586621679822961"><span class="annot"><a href="#local-6989586621679822961"><span class="hs-identifier hs-var">carry</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679822951"><span class="hs-identifier hs-type">restore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679822928"><span class="hs-identifier hs-type">act1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822955"><span class="hs-identifier hs-type">fD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822956"><span class="hs-identifier hs-type">fd_type</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Internal.IO.html#onException"><span class="hs-operator hs-type">`onException`</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#close"><span class="hs-identifier hs-type">close</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822955"><span class="hs-identifier hs-type">fD</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><a href="#local-6989586621679822929"><span class="hs-identifier hs-type">act2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822951"><span class="hs-identifier hs-type">restore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822961"><span class="hs-identifier hs-type">carry</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Open a file and make an 'FD' for it.  Truncates the file to zero</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- size when the `IOMode` is `WriteMode`. This function is difficult</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- to use without potentially leaking the file descriptor on exception.</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- In particular, it must be used with exceptions masked, which is a</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- bit rude because the thread will be uninterruptible while the file</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- path is being encoded. Use 'openFileWith' instead.</span><span>
</span><span id="line-268"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#openFile"><span class="hs-identifier hs-type">openFile</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ file to open</span></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.IOMode.html#IOMode"><span class="hs-identifier hs-type">IOMode</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ mode in which to open the file</span></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ open the file in non-blocking mode?</span></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Internal.IO.Device.html#IODeviceType"><span class="hs-identifier hs-type">IODeviceType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span id="openFile"><span class="annot"><span class="annottext">openFile :: String -&gt; IOMode -&gt; Bool -&gt; IO (FD, IODeviceType)
</span><a href="GHC.Internal.IO.FD.html#openFile"><span class="hs-identifier hs-var hs-var">openFile</span></a></span></span><span> </span><span id="local-6989586621679822962"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679822962"><span class="hs-identifier hs-var">filepath</span></a></span></span><span> </span><span id="local-6989586621679822963"><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679822963"><span class="hs-identifier hs-var">iomode</span></a></span></span><span> </span><span id="local-6989586621679822964"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679822964"><span class="hs-identifier hs-var">non_blocking</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; IOMode
-&gt; Bool
-&gt; (FD -&gt; IODeviceType -&gt; IO (FD, IODeviceType))
-&gt; ((forall x. IO x -&gt; IO x)
    -&gt; (FD, IODeviceType) -&gt; IO (FD, IODeviceType))
-&gt; IO (FD, IODeviceType)
forall r s.
String
-&gt; IOMode
-&gt; Bool
-&gt; (FD -&gt; IODeviceType -&gt; IO r)
-&gt; ((forall x. IO x -&gt; IO x) -&gt; r -&gt; IO s)
-&gt; IO s
</span><a href="GHC.Internal.IO.FD.html#openFileWith"><span class="hs-identifier hs-var">openFileWith</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679822962"><span class="hs-identifier hs-var">filepath</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679822963"><span class="hs-identifier hs-var">iomode</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679822964"><span class="hs-identifier hs-var">non_blocking</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679822965"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822965"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679822966"><span class="annot"><span class="annottext">IODeviceType
</span><a href="#local-6989586621679822966"><span class="hs-identifier hs-var">fd_type</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(FD, IODeviceType) -&gt; IO (FD, IODeviceType)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="GHC.Internal.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679822965"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IODeviceType
</span><a href="#local-6989586621679822966"><span class="hs-identifier hs-var">fd_type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">forall x. IO x -&gt; IO x
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679822967"><span class="annot"><span class="annottext">(FD, IODeviceType)
</span><a href="#local-6989586621679822967"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(FD, IODeviceType) -&gt; IO (FD, IODeviceType)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="GHC.Internal.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(FD, IODeviceType)
</span><a href="#local-6989586621679822967"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#std_flags"><span class="hs-identifier hs-type">std_flags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#output_flags"><span class="hs-identifier hs-type">output_flags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#read_flags"><span class="hs-identifier hs-type">read_flags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#write_flags"><span class="hs-identifier hs-type">write_flags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#rw_flags"><span class="hs-identifier hs-type">rw_flags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="GHC.Internal.IO.FD.html#append_flags"><span class="hs-identifier hs-type">append_flags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#nonblock_flags"><span class="hs-identifier hs-type">nonblock_flags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span>
</span><span id="line-279"></span><span id="std_flags"><span class="annot"><span class="annottext">std_flags :: CInt
</span><a href="GHC.Internal.IO.FD.html#std_flags"><span class="hs-identifier hs-var hs-var">std_flags</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#o_NOCTTY"><span class="hs-identifier hs-var">o_NOCTTY</span></a></span><span>
</span><span id="line-280"></span><span id="output_flags"><span class="annot"><span class="annottext">output_flags :: CInt
</span><a href="GHC.Internal.IO.FD.html#output_flags"><span class="hs-identifier hs-var hs-var">output_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#std_flags"><span class="hs-identifier hs-var">std_flags</span></a></span><span>    </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; CInt
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Internal.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#o_CREAT"><span class="hs-identifier hs-var">o_CREAT</span></a></span><span>
</span><span id="line-281"></span><span id="read_flags"><span class="annot"><span class="annottext">read_flags :: CInt
</span><a href="GHC.Internal.IO.FD.html#read_flags"><span class="hs-identifier hs-var hs-var">read_flags</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#std_flags"><span class="hs-identifier hs-var">std_flags</span></a></span><span>    </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; CInt
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Internal.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#o_RDONLY"><span class="hs-identifier hs-var">o_RDONLY</span></a></span><span>
</span><span id="line-282"></span><span id="write_flags"><span class="annot"><span class="annottext">write_flags :: CInt
</span><a href="GHC.Internal.IO.FD.html#write_flags"><span class="hs-identifier hs-var hs-var">write_flags</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#output_flags"><span class="hs-identifier hs-var">output_flags</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; CInt
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Internal.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#o_WRONLY"><span class="hs-identifier hs-var">o_WRONLY</span></a></span><span>
</span><span id="line-283"></span><span id="rw_flags"><span class="annot"><span class="annottext">rw_flags :: CInt
</span><a href="GHC.Internal.IO.FD.html#rw_flags"><span class="hs-identifier hs-var hs-var">rw_flags</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#output_flags"><span class="hs-identifier hs-var">output_flags</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; CInt
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Internal.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#o_RDWR"><span class="hs-identifier hs-var">o_RDWR</span></a></span><span>
</span><span id="line-284"></span><span id="append_flags"><span class="annot"><span class="annottext">append_flags :: CInt
</span><a href="GHC.Internal.IO.FD.html#append_flags"><span class="hs-identifier hs-var hs-var">append_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.IO.FD.html#write_flags"><span class="hs-identifier hs-var">write_flags</span></a></span><span>  </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; CInt
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="GHC.Internal.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#o_APPEND"><span class="hs-identifier hs-var">o_APPEND</span></a></span><span>
</span><span id="line-285"></span><span id="nonblock_flags"><span class="annot"><span class="annottext">nonblock_flags :: CInt
</span><a href="GHC.Internal.IO.FD.html#nonblock_flags"><span class="hs-identifier hs-var hs-var">nonblock_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#o_NONBLOCK"><span class="hs-identifier hs-var">o_NONBLOCK</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">-- | Make a 'FD' from an existing file descriptor.  Fails if the FD</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- refers to a directory.  If the FD refers to a file, `mkFD` locks</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- the file according to the Haskell 2010 single writer/multiple reader</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- locking semantics (this is why we need the `IOMode` argument too).</span><span>
</span><span id="line-292"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#mkFD"><span class="hs-identifier hs-type">mkFD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span>
</span><span id="line-293"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.IOMode.html#IOMode"><span class="hs-identifier hs-type">IOMode</span></a></span><span>
</span><span id="line-294"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.Device.html#IODeviceType"><span class="hs-identifier hs-type">IODeviceType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html#CDev"><span class="hs-identifier hs-type">CDev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html#CIno"><span class="hs-identifier hs-type">CIno</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>     </span><span class="hs-comment">-- the results of fdStat if we already know them, or we want</span><span>
</span><span id="line-296"></span><span>     </span><span class="hs-comment">-- to prevent fdToHandle_stat from doing its own stat.</span><span>
</span><span id="line-297"></span><span>     </span><span class="hs-comment">-- These are used for:</span><span>
</span><span id="line-298"></span><span>     </span><span class="hs-comment">--   - we fail if the FD refers to a directory</span><span>
</span><span id="line-299"></span><span>     </span><span class="hs-comment">--   - if the FD refers to a file, we lock it using (cdev,cino)</span><span>
</span><span id="line-300"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ is a socket (on Windows)</span></span><span>
</span><span id="line-301"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ is in non-blocking mode on Unix</span></span><span>
</span><span id="line-302"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Internal.IO.Device.html#IODeviceType"><span class="hs-identifier hs-type">IODeviceType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="mkFD"><span class="annot"><span class="annottext">mkFD :: CInt
-&gt; IOMode
-&gt; Maybe (IODeviceType, CDev, CIno)
-&gt; Bool
-&gt; Bool
-&gt; IO (FD, IODeviceType)
</span><a href="GHC.Internal.IO.FD.html#mkFD"><span class="hs-identifier hs-var hs-var">mkFD</span></a></span></span><span> </span><span id="local-6989586621679822977"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822977"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679822978"><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679822978"><span class="hs-identifier hs-var">iomode</span></a></span></span><span> </span><span id="local-6989586621679822979"><span class="annot"><span class="annottext">Maybe (IODeviceType, CDev, CIno)
</span><a href="#local-6989586621679822979"><span class="hs-identifier hs-var">mb_stat</span></a></span></span><span> </span><span id="local-6989586621679822980"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679822980"><span class="hs-identifier hs-var">is_socket</span></a></span></span><span> </span><span id="local-6989586621679822981"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679822981"><span class="hs-identifier hs-var">is_nonblock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="annottext">(Bool, Bool)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679822980"><span class="hs-identifier hs-var">is_socket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679822981"><span class="hs-identifier hs-var">is_nonblock</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- warning suppression</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679822982"><span class="annot"><a href="#local-6989586621679822982"><span class="hs-identifier hs-var">fd_type</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679822983"><span class="annot"><a href="#local-6989586621679822983"><span class="hs-identifier hs-var">dev</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679822984"><span class="annot"><a href="#local-6989586621679822984"><span class="hs-identifier hs-var">ino</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-309"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (IODeviceType, CDev, CIno)
</span><a href="#local-6989586621679822979"><span class="hs-identifier hs-var">mb_stat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-310"></span><span>          </span><span class="annot"><span class="annottext">Maybe (IODeviceType, CDev, CIno)
</span><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; IO (IODeviceType, CDev, CIno)
</span><a href="GHC.Internal.System.Posix.Internals.html#fdStat"><span class="hs-identifier hs-var">fdStat</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822977"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-311"></span><span>          </span><span class="annot"><a href="GHC.Internal.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679822986"><span class="annot"><span class="annottext">(IODeviceType, CDev, CIno)
</span><a href="#local-6989586621679822986"><span class="hs-identifier hs-var">stat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(IODeviceType, CDev, CIno) -&gt; IO (IODeviceType, CDev, CIno)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(IODeviceType, CDev, CIno)
</span><a href="#local-6989586621679822986"><span class="hs-identifier hs-var">stat</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679822987"><span class="annot"><a href="#local-6989586621679822987"><span class="hs-identifier hs-var hs-var">write</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="#local-6989586621679822978"><span class="hs-identifier hs-var">iomode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-314"></span><span>                   </span><span class="annot"><span class="annottext">IOMode
</span><a href="GHC.Internal.IO.IOMode.html#ReadMode"><span class="hs-identifier hs-var">ReadMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-315"></span><span>                   </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679822982"><span class="hs-identifier hs-type">fd_type</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="annottext">IODeviceType
</span><a href="GHC.Internal.IO.Device.html#Directory"><span class="hs-identifier hs-var">Directory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>           </span><span class="annot"><span class="annottext">IOException -&gt; IO ()
forall a. HasCallStack =&gt; IOException -&gt; IO a
</span><a href="GHC.Internal.IO.Exception.html#ioException"><span class="hs-identifier hs-var">ioException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
-&gt; IOErrorType
-&gt; String
-&gt; String
-&gt; Maybe CInt
-&gt; Maybe String
-&gt; IOException
</span><a href="GHC.Internal.IO.Exception.html#IOError"><span class="hs-identifier hs-var">IOError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Handle
forall a. Maybe a
</span><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">IOErrorType
</span><a href="GHC.Internal.IO.Exception.html#InappropriateType"><span class="hs-identifier hs-var">InappropriateType</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;openFile&quot;</span></span><span>
</span><span id="line-320"></span><span>                           </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is a directory&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe CInt
forall a. Maybe a
</span><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-comment">-- regular files need to be locked</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="annottext">IODeviceType
</span><a href="GHC.Internal.IO.Device.html#RegularFile"><span class="hs-identifier hs-var">RegularFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>           </span><span class="hs-comment">-- On Windows we need an additional call to get a unique device id</span><span>
</span><span id="line-325"></span><span>           </span><span class="hs-comment">-- and inode, since fstat just returns 0 for both.</span><span>
</span><span id="line-326"></span><span>           </span><span class="hs-comment">-- See also Note [RTS File locking]</span><span>
</span><span id="line-327"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621679822992"><span class="annot"><a href="#local-6989586621679822992"><span class="hs-identifier hs-var">unique_dev</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679822993"><span class="annot"><a href="#local-6989586621679822993"><span class="hs-identifier hs-var">unique_ino</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CDev -&gt; CIno -&gt; IO (Word64, Word64)
</span><a href="GHC.Internal.IO.FD.html#getUniqueFileInfo"><span class="hs-identifier hs-var">getUniqueFileInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679822977"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">CDev
</span><a href="#local-6989586621679822983"><span class="hs-identifier hs-var">dev</span></a></span><span> </span><span class="annot"><span class="annottext">CIno
</span><a href="#local-6989586621679822984"><span class="hs-identifier hs-var">ino</span></a></span><span>
</span><span id="line-328"></span><span>           </span><span id="local-6989586621679822995"><span class="annot"><a href="#local-6989586621679822995"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#lockFile"><span class="hs-identifier hs-type">lockFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822977"><span class="hs-identifier hs-type">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679822992"><span class="hs-identifier hs-type">unique_dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822993"><span class="hs-identifier hs-type">unique_ino</span></a></span><span>
</span><span id="line-329"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Foreign.Marshal.Utils.html#fromBool"><span class="hs-identifier hs-type">fromBool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822987"><span class="hs-identifier hs-type">write</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>           </span><span class="annot"><a href="GHC.Internal.Base.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679822995"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span>
</span><span id="line-331"></span><span>                </span><span class="annot"><a href="GHC.Internal.IO.Exception.html#ioException"><span class="hs-identifier hs-type">ioException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.Exception.html#IOError"><span class="hs-identifier hs-type">IOError</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-type">Nothing</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Exception.html#ResourceBusy"><span class="hs-identifier hs-type">ResourceBusy</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;openFile&quot;</span></span><span>
</span><span id="line-332"></span><span>                                   </span><span class="annot"><span class="hs-string">&quot;file is locked&quot;</span></span><span> </span><span class="annot"><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-type">Nothing</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-type">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>        </span><span id="local-6989586621679822999"><span class="annot"><span class="annottext">IODeviceType
</span><a href="#local-6989586621679822999"><span class="hs-identifier hs-var">_other_type</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-identifier">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">is_socket</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">setmode</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">True</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679822977"><span class="hs-identifier hs-type">fd</span></a></span><span class="hs-special">,</span><span class="hs-cpp">
#if !defined(mingw32_HOST_OS)
</span><span>                </span><span class="hs-comment">-- As https://man7.org/linux/man-pages/man2/open.2.html explains,</span><span>
</span><span id="line-343"></span><span>                </span><span class="hs-comment">-- O_NONBLOCK has no effect on regular files and block devices;</span><span>
</span><span id="line-344"></span><span>                </span><span class="hs-comment">-- utilities inspecting fdIsNonBlocking (such as readRawBufferPtr)</span><span>
</span><span id="line-345"></span><span>                </span><span class="hs-comment">-- should not be tricked to think otherwise.</span><span>
</span><span id="line-346"></span><span>                </span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdIsNonBlocking"><span class="hs-identifier hs-var">fdIsNonBlocking</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Internal.Enum.html#fromEnum"><span class="hs-identifier hs-type">fromEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679822981"><span class="hs-identifier hs-type">is_nonblock</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-type">&amp;&amp;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822982"><span class="hs-identifier hs-type">fd_type</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-type">/=</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#RegularFile"><span class="hs-identifier hs-type">RegularFile</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-type">&amp;&amp;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679822982"><span class="hs-identifier hs-type">fd_type</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-type">/=</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#RawDevice"><span class="hs-identifier hs-type">RawDevice</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>                </span><span class="hs-identifier">fdIsSocket_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">is_socket</span><span class="hs-cpp">
#endif
</span><span>              </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-351"></span><span>            </span><span class="annot"><a href="#local-6989586621679822982"><span class="hs-identifier hs-type">fd_type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#getUniqueFileInfo"><span class="hs-identifier hs-type">getUniqueFileInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html#CDev"><span class="hs-identifier hs-type">CDev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html#CIno"><span class="hs-identifier hs-type">CIno</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if !defined(mingw32_HOST_OS)
</span><span id="getUniqueFileInfo"><span class="annot"><span class="annottext">getUniqueFileInfo :: CInt -&gt; CDev -&gt; CIno -&gt; IO (Word64, Word64)
</span><a href="GHC.Internal.IO.FD.html#getUniqueFileInfo"><span class="hs-identifier hs-var hs-var">getUniqueFileInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679823003"><span class="annot"><span class="annottext">CDev
</span><a href="#local-6989586621679823003"><span class="hs-identifier hs-var">dev</span></a></span></span><span> </span><span id="local-6989586621679823004"><span class="annot"><span class="annottext">CIno
</span><a href="#local-6989586621679823004"><span class="hs-identifier hs-var">ino</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word64, Word64) -&gt; IO (Word64, Word64)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CDev -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">CDev
</span><a href="#local-6989586621679823003"><span class="hs-identifier hs-var">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CIno -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">CIno
</span><a href="#local-6989586621679823004"><span class="hs-identifier hs-var">ino</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">getUniqueFileInfo</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-identifier">with</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">devptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-identifier">with</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">inoptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-identifier">c_getUniqueFileInfo</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">devptr</span><span> </span><span class="hs-identifier">inoptr</span><span>
</span><span id="line-361"></span><span>      </span><span class="hs-identifier">liftM2</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">devptr</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">inoptr</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;__hscore_setmode&quot;</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-identifier">setmode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- Standard file descriptors</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#stdFD"><span class="hs-identifier hs-type">stdFD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span>
</span><span id="line-373"></span><span id="stdFD"><span class="annot"><span class="annottext">stdFD :: CInt -&gt; FD
</span><a href="GHC.Internal.IO.FD.html#stdFD"><span class="hs-identifier hs-var hs-var">stdFD</span></a></span></span><span> </span><span id="local-6989586621679823006"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679823006"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fdFD :: CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679823006"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">,</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>                </span><span class="hs-identifier">fdIsSocket_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#else
</span><span>                </span><span class="annot"><span class="annottext">fdIsNonBlocking :: Int
</span><a href="GHC.Internal.IO.FD.html#fdIsNonBlocking"><span class="hs-identifier hs-var">fdIsNonBlocking</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-378"></span><span>   </span><span class="hs-comment">-- We don't set non-blocking mode on standard handles, because it may</span><span>
</span><span id="line-379"></span><span>   </span><span class="hs-comment">-- confuse other applications attached to the same TTY/pipe</span><span>
</span><span id="line-380"></span><span>   </span><span class="hs-comment">-- see Note [nonblock]</span><span class="hs-cpp">
#endif
</span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#stdin"><span class="hs-identifier hs-type">stdin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#stdout"><span class="hs-identifier hs-type">stdout</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#stderr"><span class="hs-identifier hs-type">stderr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span>
</span><span id="line-385"></span><span id="stdin"><span class="annot"><span class="annottext">stdin :: FD
</span><a href="GHC.Internal.IO.FD.html#stdin"><span class="hs-identifier hs-var hs-var">stdin</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; FD
</span><a href="GHC.Internal.IO.FD.html#stdFD"><span class="hs-identifier hs-var">stdFD</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">0</span></span><span>
</span><span id="line-386"></span><span id="stdout"><span class="annot"><span class="annottext">stdout :: FD
</span><a href="GHC.Internal.IO.FD.html#stdout"><span class="hs-identifier hs-var hs-var">stdout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; FD
</span><a href="GHC.Internal.IO.FD.html#stdFD"><span class="hs-identifier hs-var">stdFD</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">1</span></span><span>
</span><span id="line-387"></span><span id="stderr"><span class="annot"><span class="annottext">stderr :: FD
</span><a href="GHC.Internal.IO.FD.html#stderr"><span class="hs-identifier hs-var hs-var">stderr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; FD
</span><a href="GHC.Internal.IO.FD.html#stdFD"><span class="hs-identifier hs-var">stdFD</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">2</span></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- Operations on file descriptors</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#close"><span class="hs-identifier hs-type">close</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span id="close"><span class="annot"><span class="annottext">close :: FD -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#close"><span class="hs-identifier hs-var hs-var">close</span></a></span></span><span> </span><span id="local-6989586621679823007"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823007"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679823028"><span class="annot"><span class="annottext">closer :: a -&gt; IO ()
</span><a href="#local-6989586621679823028"><span class="hs-identifier hs-var hs-var hs-var">closer</span></a></span></span><span> </span><span id="local-6989586621679823029"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679823029"><span class="hs-identifier hs-var">realFd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-395"></span><span>           </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO ()
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1Retry_"><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.close&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO ()) -&gt; IO CInt -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-398"></span><span>             </span><span class="hs-identifier">c_closesocket</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">realFd</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>           </span><span class="hs-keyword">else</span><span class="hs-cpp">
#endif
</span><span>             </span><span class="annot"><span class="annottext">CInt -&gt; IO CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#c_close"><span class="hs-identifier hs-var">c_close</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; CInt
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679823029"><span class="hs-identifier hs-var">realFd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>     </span><span class="hs-comment">-- release the lock *first*, because otherwise if we're preempted</span><span>
</span><span id="line-404"></span><span>     </span><span class="hs-comment">-- after closing but before releasing, the FD may have been reused.</span><span>
</span><span id="line-405"></span><span>     </span><span class="hs-comment">-- (#7646)</span><span>
</span><span id="line-406"></span><span>     </span><span class="annot"><span class="annottext">FD -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#release"><span class="hs-identifier hs-var">release</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823007"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>     </span><span class="annot"><span class="annottext">(Fd -&gt; IO ()) -&gt; Fd -&gt; IO ()
</span><a href="GHC.Internal.Conc.IO.html#closeFdWith"><span class="hs-identifier hs-var">closeFdWith</span></a></span><span> </span><span class="annot"><span class="annottext">Fd -&gt; IO ()
forall {a}. Integral a =&gt; a -&gt; IO ()
</span><a href="#local-6989586621679823028"><span class="hs-identifier hs-var">closer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Fd
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823007"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#release"><span class="hs-identifier hs-type">release</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span id="release"><span class="annot"><span class="annottext">release :: FD -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#release"><span class="hs-identifier hs-var hs-var">release</span></a></span></span><span> </span><span id="local-6989586621679823032"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823032"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#unlockFile"><span class="hs-identifier hs-var">unlockFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(CInt -&gt; Word64) -&gt; CInt -&gt; Word64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823032"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>                </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;HsBase.h closesocket&quot;</span><span>
</span><span id="line-416"></span><span>   </span><span class="hs-identifier">c_closesocket</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-419"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#isSeekable"><span class="hs-identifier hs-type">isSeekable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-420"></span><span id="isSeekable"><span class="annot"><span class="annottext">isSeekable :: FD -&gt; IO Bool
</span><a href="GHC.Internal.IO.FD.html#isSeekable"><span class="hs-identifier hs-var hs-var">isSeekable</span></a></span></span><span> </span><span id="local-6989586621679823034"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823034"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-421"></span><span>  </span><span id="local-6989586621679823035"><span class="annot"><a href="#local-6989586621679823035"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FD -&gt; IO IODeviceType
</span><a href="GHC.Internal.IO.FD.html#devType"><span class="hs-identifier hs-var">devType</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823034"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679823035"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#RegularFile"><span class="hs-identifier hs-type">RegularFile</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-type">||</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823035"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#RawDevice"><span class="hs-identifier hs-type">RawDevice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#seek"><span class="hs-identifier hs-type">seek</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#SeekMode"><span class="hs-identifier hs-type">SeekMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-bignum-1.3-6db4/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-bignum-1.3-6db4/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-425"></span><span id="seek"><span class="annot"><span class="annottext">seek :: FD -&gt; SeekMode -&gt; Integer -&gt; IO Integer
</span><a href="GHC.Internal.IO.FD.html#seek"><span class="hs-identifier hs-var hs-var">seek</span></a></span></span><span> </span><span id="local-6989586621679823037"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823037"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823038"><span class="annot"><span class="annottext">SeekMode
</span><a href="#local-6989586621679823038"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621679823039"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679823039"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">COff -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(COff -&gt; Integer) -&gt; IO COff -&gt; IO Integer
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="GHC.Internal.Base.html#fmap"><span class="hs-operator hs-var">`fmap`</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO COff -&gt; IO COff
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1Retry"><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;seek&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO COff -&gt; IO COff) -&gt; IO COff -&gt; IO COff
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-427"></span><span>     </span><span class="annot"><span class="annottext">CInt -&gt; COff -&gt; CInt -&gt; IO COff
</span><a href="GHC.Internal.System.Posix.Internals.html#c_lseek"><span class="hs-identifier hs-var">c_lseek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823037"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; COff
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679823039"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679823041"><span class="hs-identifier hs-var">seektype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>    </span><span class="annot"><a href="#local-6989586621679823041"><span class="hs-identifier hs-type">seektype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621679823041"><span class="annot"><span class="annottext">seektype :: CInt
</span><a href="#local-6989586621679823041"><span class="hs-identifier hs-var hs-var">seektype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SeekMode
</span><a href="#local-6989586621679823038"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-431"></span><span>                   </span><span class="annot"><span class="annottext">SeekMode
</span><a href="GHC.Internal.IO.Device.html#AbsoluteSeek"><span class="hs-identifier hs-var">AbsoluteSeek</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#sEEK_SET"><span class="hs-identifier hs-var">sEEK_SET</span></a></span><span>
</span><span id="line-432"></span><span>                   </span><span class="annot"><span class="annottext">SeekMode
</span><a href="GHC.Internal.IO.Device.html#RelativeSeek"><span class="hs-identifier hs-var">RelativeSeek</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#sEEK_CUR"><span class="hs-identifier hs-var">sEEK_CUR</span></a></span><span>
</span><span id="line-433"></span><span>                   </span><span class="annot"><span class="annottext">SeekMode
</span><a href="GHC.Internal.IO.Device.html#SeekFromEnd"><span class="hs-identifier hs-var">SeekFromEnd</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#sEEK_END"><span class="hs-identifier hs-var">sEEK_END</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#tell"><span class="hs-identifier hs-type">tell</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-bignum-1.3-6db4/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-436"></span><span id="tell"><span class="annot"><span class="annottext">tell :: FD -&gt; IO Integer
</span><a href="GHC.Internal.IO.FD.html#tell"><span class="hs-identifier hs-var hs-var">tell</span></a></span></span><span> </span><span id="local-6989586621679823048"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823048"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-437"></span><span> </span><span class="annot"><span class="annottext">COff -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(COff -&gt; Integer) -&gt; IO COff -&gt; IO Integer
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="GHC.Internal.Base.html#fmap"><span class="hs-operator hs-var">`fmap`</span></a></span><span>
</span><span id="line-438"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO COff -&gt; IO COff
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1Retry"><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hGetPosn&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO COff -&gt; IO COff) -&gt; IO COff -&gt; IO COff
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-439"></span><span>      </span><span class="annot"><span class="annottext">CInt -&gt; COff -&gt; CInt -&gt; IO COff
</span><a href="GHC.Internal.System.Posix.Internals.html#c_lseek"><span class="hs-identifier hs-var">c_lseek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823048"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">COff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#sEEK_CUR"><span class="hs-identifier hs-var">sEEK_CUR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#getSize"><span class="hs-identifier hs-type">getSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-bignum-1.3-6db4/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-442"></span><span id="getSize"><span class="annot"><span class="annottext">getSize :: FD -&gt; IO Integer
</span><a href="GHC.Internal.IO.FD.html#getSize"><span class="hs-identifier hs-var hs-var">getSize</span></a></span></span><span> </span><span id="local-6989586621679823049"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823049"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; IO Integer
</span><a href="GHC.Internal.System.Posix.Internals.html#fdFileSize"><span class="hs-identifier hs-var">fdFileSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823049"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#setSize"><span class="hs-identifier hs-type">setSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-bignum-1.3-6db4/src/GHC.Num.Integer.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span id="setSize"><span class="annot"><span class="annottext">setSize :: FD -&gt; Integer -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#setSize"><span class="hs-identifier hs-var hs-var">setSize</span></a></span></span><span> </span><span id="local-6989586621679823051"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823051"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823052"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679823052"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><span class="annottext">(CInt -&gt; Bool) -&gt; String -&gt; IO CInt -&gt; IO ()
forall a. (a -&gt; Bool) -&gt; String -&gt; IO a -&gt; IO ()
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIf_"><span class="hs-identifier hs-var">throwErrnoIf_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.setSize&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO ()) -&gt; IO CInt -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-447"></span><span>     </span><span class="annot"><span class="annottext">CInt -&gt; COff -&gt; IO CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#c_ftruncate"><span class="hs-identifier hs-var">c_ftruncate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823051"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; COff
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679823052"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#devType"><span class="hs-identifier hs-type">devType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#IODeviceType"><span class="hs-identifier hs-type">IODeviceType</span></a></span><span>
</span><span id="line-450"></span><span id="devType"><span class="annot"><span class="annottext">devType :: FD -&gt; IO IODeviceType
</span><a href="GHC.Internal.IO.FD.html#devType"><span class="hs-identifier hs-var hs-var">devType</span></a></span></span><span> </span><span id="local-6989586621679823055"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823055"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679823056"><span class="annot"><a href="#local-6989586621679823056"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; IO (IODeviceType, CDev, CIno)
</span><a href="GHC.Internal.System.Posix.Internals.html#fdStat"><span class="hs-identifier hs-var">fdStat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823055"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823056"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#dup"><span class="hs-identifier hs-type">dup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span>
</span><span id="line-453"></span><span id="dup"><span class="annot"><span class="annottext">dup :: FD -&gt; IO FD
</span><a href="GHC.Internal.IO.FD.html#dup"><span class="hs-identifier hs-var hs-var">dup</span></a></span></span><span> </span><span id="local-6989586621679823057"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823057"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-454"></span><span>  </span><span id="local-6989586621679823058"><span class="annot"><a href="#local-6989586621679823058"><span class="hs-identifier hs-var">newfd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO CInt
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1"><span class="hs-identifier hs-var">throwErrnoIfMinus1</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.dup&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO CInt) -&gt; IO CInt -&gt; IO CInt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; IO CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#c_dup"><span class="hs-identifier hs-var">c_dup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823057"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>  </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823057"><span class="hs-identifier hs-type">fd</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679823058"><span class="hs-identifier hs-type">newfd</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#dup2"><span class="hs-identifier hs-type">dup2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span>
</span><span id="line-458"></span><span id="dup2"><span class="annot"><span class="annottext">dup2 :: FD -&gt; FD -&gt; IO FD
</span><a href="GHC.Internal.IO.FD.html#dup2"><span class="hs-identifier hs-var hs-var">dup2</span></a></span></span><span> </span><span id="local-6989586621679823061"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823061"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823062"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823062"><span class="hs-identifier hs-var">fdto</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-comment">-- Windows' dup2 does not return the new descriptor, unlike Unix</span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO ()
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1_"><span class="hs-identifier hs-var">throwErrnoIfMinus1_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.dup2&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO ()) -&gt; IO CInt -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; IO CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#c_dup2"><span class="hs-identifier hs-var">c_dup2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823061"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823062"><span class="hs-identifier hs-var">fdto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><span class="annottext">FD -&gt; IO FD
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823061"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823062"><span class="hs-identifier hs-type">fdto</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- original FD, with the new fdFD</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#setNonBlockingMode"><span class="hs-identifier hs-type">setNonBlockingMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span>
</span><span id="line-465"></span><span id="setNonBlockingMode"><span class="annot"><span class="annottext">setNonBlockingMode :: FD -&gt; Bool -&gt; IO FD
</span><a href="GHC.Internal.IO.FD.html#setNonBlockingMode"><span class="hs-identifier hs-var hs-var">setNonBlockingMode</span></a></span></span><span> </span><span id="local-6989586621679823065"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823065"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823066"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679823066"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-comment">-- This mirrors the behaviour of mkFD:</span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-comment">-- O_NONBLOCK has no effect on regular files and block devices;</span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-comment">-- utilities inspecting fdIsNonBlocking (such as readRawBufferPtr)</span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-comment">-- should not be tricked to think otherwise.</span><span>
</span><span id="line-470"></span><span>  </span><span id="local-6989586621679823067"><span class="annot"><a href="#local-6989586621679823067"><span class="hs-identifier hs-var">is_nonblock</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679823066"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-472"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; (Ptr CStat -&gt; IO Bool) -&gt; IO Bool
forall a b. Int -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><a href="GHC.Internal.Foreign.Marshal.Alloc.html#allocaBytes"><span class="hs-identifier hs-var">allocaBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Internal.System.Posix.Internals.html#sizeof_stat"><span class="hs-identifier hs-var">sizeof_stat</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr CStat -&gt; IO Bool) -&gt; IO Bool)
-&gt; (Ptr CStat -&gt; IO Bool) -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679823069"><span class="annot"><span class="annottext">Ptr CStat
</span><a href="#local-6989586621679823069"><span class="hs-identifier hs-var">p_stat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-474"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO ()
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO ()
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1Retry_"><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fileSize&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO ()) -&gt; IO CInt -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-475"></span><span>            </span><span class="annot"><span class="annottext">CInt -&gt; Ptr CStat -&gt; IO CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#c_fstat"><span class="hs-identifier hs-var">c_fstat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823065"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ptr CStat
</span><a href="#local-6989586621679823069"><span class="hs-identifier hs-var">p_stat</span></a></span><span>
</span><span id="line-476"></span><span>          </span><span id="local-6989586621679823071"><span class="annot"><a href="#local-6989586621679823071"><span class="hs-identifier hs-var">fd_type</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr CStat -&gt; IO (Maybe IODeviceType)
</span><a href="GHC.Internal.System.Posix.Internals.html#statGetType_maybe"><span class="hs-identifier hs-var">statGetType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr CStat
</span><a href="#local-6989586621679823069"><span class="hs-identifier hs-var">p_stat</span></a></span><span>
</span><span id="line-477"></span><span>          </span><span class="annot"><a href="GHC.Internal.Base.html#pure"><span class="hs-identifier hs-type">pure</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823071"><span class="hs-identifier hs-type">fd_type</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-type">/=</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#RegularFile"><span class="hs-identifier hs-type">RegularFile</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-type">&amp;&amp;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823071"><span class="hs-identifier hs-type">fd_type</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-type">/=</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.IO.Device.html#RawDevice"><span class="hs-identifier hs-type">RawDevice</span></a></span><span>
</span><span id="line-478"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="GHC.Internal.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-479"></span><span>  </span><span class="annot"><a href="GHC.Internal.System.Posix.Internals.html#setNonBlockingFD"><span class="hs-identifier hs-type">setNonBlockingFD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823065"><span class="hs-identifier hs-type">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679823067"><span class="hs-identifier hs-type">is_nonblock</span></a></span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">fd</span><span class="hs-cpp">
#else
</span><span>  </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823065"><span class="hs-identifier hs-type">fd</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdIsNonBlocking"><span class="hs-identifier hs-var">fdIsNonBlocking</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Internal.Enum.html#fromEnum"><span class="hs-identifier hs-type">fromEnum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823067"><span class="hs-identifier hs-type">is_nonblock</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-486"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#ready"><span class="hs-identifier hs-type">ready</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-487"></span><span id="ready"><span class="annot"><span class="annottext">ready :: FD -&gt; Bool -&gt; Int -&gt; IO Bool
</span><a href="GHC.Internal.IO.FD.html#ready"><span class="hs-identifier hs-var hs-var">ready</span></a></span></span><span> </span><span id="local-6989586621679823074"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823074"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823075"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679823075"><span class="hs-identifier hs-var">write</span></a></span></span><span> </span><span id="local-6989586621679823076"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823076"><span class="hs-identifier hs-var">msecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-488"></span><span>  </span><span id="local-6989586621679823077"><span class="annot"><a href="#local-6989586621679823077"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO CInt
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1Retry"><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.ready&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO CInt) -&gt; IO CInt -&gt; IO CInt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-489"></span><span>          </span><span class="annot"><span class="annottext">CInt -&gt; CBool -&gt; Int64 -&gt; CBool -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#fdReady"><span class="hs-identifier hs-var">fdReady</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823074"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CBool
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; CBool) -&gt; Int -&gt; CBool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><a href="GHC.Internal.Enum.html#fromEnum"><span class="hs-identifier hs-var">fromEnum</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Int) -&gt; Bool -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679823075"><span class="hs-identifier hs-var">write</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823076"><span class="hs-identifier hs-var">msecs</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>                          </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>                          </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">0</span></span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Enum.html#toEnum"><span class="hs-identifier hs-type">toEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823077"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">safe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;fdReady&quot;</span></span><span>
</span><span id="line-499"></span><span>  </span><span id="fdReady"><span class="annot"><a href="GHC.Internal.IO.FD.html#fdReady"><span class="hs-identifier hs-var">fdReady</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- Terminal-related stuff</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#isTerminal"><span class="hs-identifier hs-type">isTerminal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-505"></span><span id="isTerminal"><span class="annot"><span class="annottext">isTerminal :: FD -&gt; IO Bool
</span><a href="GHC.Internal.IO.FD.html#isTerminal"><span class="hs-identifier hs-var hs-var">isTerminal</span></a></span></span><span> </span><span id="local-6989586621679823080"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823080"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">False</span><span>
</span><span id="line-508"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">is_console</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-identifier">return</span><span class="hs-operator">.</span><span class="hs-identifier">toBool</span><span class="hs-cpp">
#else
</span><span>    </span><span class="annot"><span class="annottext">CInt -&gt; IO CInt
</span><a href="GHC.Internal.System.Posix.Internals.html#c_isatty"><span class="hs-identifier hs-var">c_isatty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823080"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO CInt -&gt; (CInt -&gt; IO Bool) -&gt; IO Bool
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="GHC.Internal.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span class="annot"><span class="annottext">(Bool -&gt; IO Bool) -&gt; (CInt -&gt; Bool) -&gt; CInt -&gt; IO Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="GHC.Internal.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">CInt -&gt; Bool
forall a. (Eq a, Num a) =&gt; a -&gt; Bool
</span><a href="GHC.Internal.Foreign.Marshal.Utils.html#toBool"><span class="hs-identifier hs-var">toBool</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-513"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#setEcho"><span class="hs-identifier hs-type">setEcho</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span id="setEcho"><span class="annot"><span class="annottext">setEcho :: FD -&gt; Bool -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#setEcho"><span class="hs-identifier hs-var hs-var">setEcho</span></a></span></span><span> </span><span id="local-6989586621679823084"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823084"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823085"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679823085"><span class="hs-identifier hs-var">on</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Bool -&gt; IO ()
</span><a href="GHC.Internal.System.Posix.Internals.html#setEcho"><span class="hs-identifier hs-var">GHC.Internal.System.Posix.Internals.setEcho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823084"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679823085"><span class="hs-identifier hs-var">on</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#getEcho"><span class="hs-identifier hs-type">getEcho</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-517"></span><span id="getEcho"><span class="annot"><span class="annottext">getEcho :: FD -&gt; IO Bool
</span><a href="GHC.Internal.IO.FD.html#getEcho"><span class="hs-identifier hs-var hs-var">getEcho</span></a></span></span><span> </span><span id="local-6989586621679823086"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823086"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; IO Bool
</span><a href="GHC.Internal.System.Posix.Internals.html#getEcho"><span class="hs-identifier hs-var">GHC.Internal.System.Posix.Internals.getEcho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823086"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#setRaw"><span class="hs-identifier hs-type">setRaw</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span id="setRaw"><span class="annot"><span class="annottext">setRaw :: FD -&gt; Bool -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#setRaw"><span class="hs-identifier hs-var hs-var">setRaw</span></a></span></span><span> </span><span id="local-6989586621679823087"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823087"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823088"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679823088"><span class="hs-identifier hs-var">raw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Bool -&gt; IO ()
</span><a href="GHC.Internal.System.Posix.Internals.html#setCooked"><span class="hs-identifier hs-var">GHC.Internal.System.Posix.Internals.setCooked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823087"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679823088"><span class="hs-identifier hs-var">raw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- Reading and Writing</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdRead"><span class="hs-identifier hs-type">fdRead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-526"></span><span id="fdRead"><span class="annot"><span class="annottext">fdRead :: FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO Int
</span><a href="GHC.Internal.IO.FD.html#fdRead"><span class="hs-identifier hs-var hs-var">fdRead</span></a></span></span><span> </span><span id="local-6989586621679823091"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823091"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823092"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823092"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span id="local-6989586621679823093"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679823093"><span class="hs-identifier hs-var">_offset</span></a></span></span><span> </span><span id="local-6989586621679823094"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823094"><span class="hs-identifier hs-var">bytes</span></a></span></span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679823095"><span class="annot"><a href="#local-6989586621679823095"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; FD -&gt; Ptr Word8 -&gt; Int -&gt; CSize -&gt; IO Int
</span><a href="GHC.Internal.IO.FD.html#readRawBufferPtr"><span class="hs-identifier hs-var">readRawBufferPtr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.fdRead&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823091"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823092"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-528"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CSize
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; CSize) -&gt; Int -&gt; CSize
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="GHC.Internal.IO.FD.html#clampReadSize"><span class="hs-identifier hs-var">clampReadSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823094"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823095"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdReadNonBlocking"><span class="hs-identifier hs-type">fdReadNonBlocking</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span id="fdReadNonBlocking"><span class="annot"><span class="annottext">fdReadNonBlocking :: FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO (Maybe Int)
</span><a href="GHC.Internal.IO.FD.html#fdReadNonBlocking"><span class="hs-identifier hs-var hs-var">fdReadNonBlocking</span></a></span></span><span> </span><span id="local-6989586621679823096"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823096"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823097"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823097"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span id="local-6989586621679823098"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679823098"><span class="hs-identifier hs-var">_offset</span></a></span></span><span> </span><span id="local-6989586621679823099"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823099"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-533"></span><span>  </span><span id="local-6989586621679823100"><span class="annot"><a href="#local-6989586621679823100"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; FD -&gt; Ptr Word8 -&gt; Int -&gt; CSize -&gt; IO Int
</span><a href="GHC.Internal.IO.FD.html#readRawBufferPtrNoBlock"><span class="hs-identifier hs-var">readRawBufferPtrNoBlock</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.fdReadNonBlocking&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823096"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823097"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-534"></span><span>           </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CSize
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; CSize) -&gt; Int -&gt; CSize
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="GHC.Internal.IO.FD.html#clampReadSize"><span class="hs-identifier hs-var">clampReadSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823099"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823100"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; IO (Maybe Int)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><a href="GHC.Internal.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>    </span><span id="local-6989586621679823101"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823101"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; IO (Maybe Int)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><a href="GHC.Internal.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823101"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdWrite"><span class="hs-identifier hs-type">fdWrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span id="fdWrite"><span class="annot"><span class="annottext">fdWrite :: FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO ()
</span><a href="GHC.Internal.IO.FD.html#fdWrite"><span class="hs-identifier hs-var hs-var">fdWrite</span></a></span></span><span> </span><span id="local-6989586621679823102"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823102"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823103"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823103"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span id="local-6989586621679823104"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679823104"><span class="hs-identifier hs-var">_offset</span></a></span></span><span> </span><span id="local-6989586621679823105"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823105"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-542"></span><span>  </span><span id="local-6989586621679823106"><span class="annot"><a href="#local-6989586621679823106"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; FD -&gt; Ptr Word8 -&gt; Int -&gt; CSize -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#writeRawBufferPtr"><span class="hs-identifier hs-var">writeRawBufferPtr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.fdWrite&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823102"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823103"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-543"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CSize
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; CSize) -&gt; Int -&gt; CSize
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="GHC.Internal.IO.FD.html#clampWriteSize"><span class="hs-identifier hs-var">clampWriteSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823105"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679823109"><span class="annot"><a href="#local-6989586621679823109"><span class="hs-identifier hs-var hs-var">res'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679823106"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679823109"><span class="hs-identifier hs-type">res'</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3C"><span class="hs-operator hs-type">&lt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823105"><span class="hs-identifier hs-type">bytes</span></a></span><span>
</span><span id="line-546"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdWrite"><span class="hs-identifier hs-type">fdWrite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823102"><span class="hs-identifier hs-type">fd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679823103"><span class="hs-identifier hs-type">ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-type">`plusPtr`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823109"><span class="hs-identifier hs-type">res'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679823104"><span class="hs-identifier hs-type">_offset</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Num.html#%2B"><span class="hs-operator hs-type">+</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823109"><span class="hs-identifier hs-type">res'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679823105"><span class="hs-identifier hs-type">bytes</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Num.html#-"><span class="hs-glyph hs-type">-</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823109"><span class="hs-identifier hs-type">res'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="hs-comment">-- XXX ToDo: this isn't non-blocking</span><span>
</span><span id="line-550"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdWriteNonBlocking"><span class="hs-identifier hs-type">fdWriteNonBlocking</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-551"></span><span id="fdWriteNonBlocking"><span class="annot"><span class="annottext">fdWriteNonBlocking :: FD -&gt; Ptr Word8 -&gt; Word64 -&gt; Int -&gt; IO Int
</span><a href="GHC.Internal.IO.FD.html#fdWriteNonBlocking"><span class="hs-identifier hs-var hs-var">fdWriteNonBlocking</span></a></span></span><span> </span><span id="local-6989586621679823113"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823113"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621679823114"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823114"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span id="local-6989586621679823115"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679823115"><span class="hs-identifier hs-var">_offset</span></a></span></span><span> </span><span id="local-6989586621679823116"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823116"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>  </span><span id="local-6989586621679823117"><span class="annot"><a href="#local-6989586621679823117"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; FD -&gt; Ptr Word8 -&gt; Int -&gt; CSize -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#writeRawBufferPtrNoBlock"><span class="hs-identifier hs-var">writeRawBufferPtrNoBlock</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Internal.IO.FD.fdWriteNonBlocking&quot;</span></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823113"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823114"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-553"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CSize
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; CSize) -&gt; Int -&gt; CSize
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="GHC.Internal.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="GHC.Internal.IO.FD.html#clampWriteSize"><span class="hs-identifier hs-var">clampWriteSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823116"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>  </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823117"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-557"></span><span class="hs-comment">-- FD operations</span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span class="hs-comment">-- Low level routines for reading/writing to (raw)buffers:</span><span class="hs-cpp">

#if !defined(mingw32_HOST_OS)
</span><span>
</span><span id="line-563"></span><span class="hs-comment">{-
Note [nonblock]
~~~~~~~~~~~~~~~
Unix has broken semantics when it comes to non-blocking I/O: you can
set the O_NONBLOCK flag on an FD, but it applies to the all other FDs
attached to the same underlying file, pipe or TTY; there's no way to
have private non-blocking behaviour for an FD.  See bug #724.

We fix this by only setting O_NONBLOCK on FDs that we create; FDs that
come from external sources or are exposed externally are left in
blocking mode.  This solution has some problems though.  We can't
completely simulate a non-blocking read without O_NONBLOCK: several
cases are wrong here.  The cases that are wrong:

  * reading/writing to a blocking FD in non-threaded mode.
    In threaded mode, we just make a safe call to read().
    In non-threaded mode we call select() before attempting to read,
    but that leaves a small race window where the data can be read
    from the file descriptor before we issue our blocking read().
  * readRawBufferNoBlock for a blocking FD

NOTE [2363]:

In the threaded RTS we could just make safe calls to read()/write()
for file descriptors in blocking mode without worrying about blocking
other threads, but the problem with this is that the thread will be
uninterruptible while it is blocked in the foreign call.  See #2363.
So now we always call fdReady() before reading, and if fdReady
indicates that there's no data, we call threadWaitRead.

-}</span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#readRawBufferPtr"><span class="hs-identifier hs-type">readRawBufferPtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CSize"><span class="hs-identifier hs-type">CSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-596"></span><span id="readRawBufferPtr"><span class="annot"><span class="annottext">readRawBufferPtr :: String -&gt; FD -&gt; Ptr Word8 -&gt; Int -&gt; CSize -&gt; IO Int
</span><a href="GHC.Internal.IO.FD.html#readRawBufferPtr"><span class="hs-identifier hs-var hs-var">readRawBufferPtr</span></a></span></span><span> </span><span id="local-6989586621679823119"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823119"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823120"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823120"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823121"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823121"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823122"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823122"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823123"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823123"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-599"></span><span>    </span><span class="hs-identifier">throwErrnoIfMinus1</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">c_read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">off</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FD -&gt; Bool
</span><a href="GHC.Internal.IO.FD.html#isNonBlocking"><span class="hs-identifier hs-var">isNonBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823120"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621679823125"><span class="hs-identifier hs-var">unsafe_read</span></a></span><span> </span><span class="hs-comment">-- unsafe is ok, it can't block</span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679823126"><span class="annot"><a href="#local-6989586621679823126"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO CInt -&gt; IO CInt
forall a. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO a
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1"><span class="hs-identifier hs-var">throwErrnoIfMinus1</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823119"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-603"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; CBool -&gt; Int64 -&gt; CBool -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#unsafe_fdReady"><span class="hs-identifier hs-var">unsafe_fdReady</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823120"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679823126"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-type">/=</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-605"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621679823128"><span class="hs-identifier hs-type">read</span></a></span><span>
</span><span id="line-606"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="GHC.Internal.Conc.IO.html#threadWaitRead"><span class="hs-identifier hs-type">threadWaitRead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823120"><span class="hs-identifier hs-type">fd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621679823128"><span class="hs-identifier hs-type">read</span></a></span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-608"></span><span>    </span><span id="local-6989586621679823149"><span class="annot"><span class="annottext">do_read :: IO a -&gt; IO b
</span><a href="#local-6989586621679823149"><span class="hs-identifier hs-var hs-var">do_read</span></a></span></span><span> </span><span id="local-6989586621679823150"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679823150"><span class="hs-identifier hs-var">call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; IO a -&gt; IO b
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="GHC.Internal.Base.html#fmap"><span class="hs-operator hs-var">`fmap`</span></a></span><span>
</span><span id="line-609"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; IO a -&gt; IO () -&gt; IO a
forall a b. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO b -&gt; IO a
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1RetryMayBlock"><span class="hs-identifier hs-var">throwErrnoIfMinus1RetryMayBlock</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823119"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679823150"><span class="hs-identifier hs-var">call</span></a></span><span>
</span><span id="line-610"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fd -&gt; IO ()
</span><a href="GHC.Internal.Conc.IO.html#threadWaitRead"><span class="hs-identifier hs-var">threadWaitRead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Fd
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823120"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>    </span><span id="local-6989586621679823128"><span class="annot"><span class="annottext">read :: IO Int
</span><a href="#local-6989586621679823128"><span class="hs-identifier hs-var hs-var">read</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.IO.FD.html#threaded"><span class="hs-identifier hs-var">threaded</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621679823153"><span class="hs-identifier hs-var">safe_read</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621679823125"><span class="hs-identifier hs-var">unsafe_read</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span id="local-6989586621679823125"><span class="annot"><span class="annottext">unsafe_read :: IO Int
</span><a href="#local-6989586621679823125"><span class="hs-identifier hs-var hs-var">unsafe_read</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CSsize -&gt; IO Int
forall {a} {b}. (Integral a, Num b) =&gt; IO a -&gt; IO b
</span><a href="#local-6989586621679823149"><span class="hs-identifier hs-var">do_read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize
</span><a href="GHC.Internal.System.Posix.Internals.html#c_read"><span class="hs-identifier hs-var">c_read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823120"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823121"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823122"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823123"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>    </span><span id="local-6989586621679823153"><span class="annot"><span class="annottext">safe_read :: IO Int
</span><a href="#local-6989586621679823153"><span class="hs-identifier hs-var hs-var">safe_read</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CSsize -&gt; IO Int
forall {a} {b}. (Integral a, Num b) =&gt; IO a -&gt; IO b
</span><a href="#local-6989586621679823149"><span class="hs-identifier hs-var">do_read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize
</span><a href="GHC.Internal.System.Posix.Internals.html#c_safe_read"><span class="hs-identifier hs-var">c_safe_read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823120"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823121"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823122"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823123"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-616"></span><span class="hs-comment">-- return: -1 indicates EOF, &gt;=0 is bytes read</span><span>
</span><span id="line-617"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#readRawBufferPtrNoBlock"><span class="hs-identifier hs-type">readRawBufferPtrNoBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CSize"><span class="hs-identifier hs-type">CSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-618"></span><span id="readRawBufferPtrNoBlock"><span class="annot"><span class="annottext">readRawBufferPtrNoBlock :: String -&gt; FD -&gt; Ptr Word8 -&gt; Int -&gt; CSize -&gt; IO Int
</span><a href="GHC.Internal.IO.FD.html#readRawBufferPtrNoBlock"><span class="hs-identifier hs-var hs-var">readRawBufferPtrNoBlock</span></a></span></span><span> </span><span id="local-6989586621679823161"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823161"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823162"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823162"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823163"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823163"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823164"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823164"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823165"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823165"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>      </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">throwErrnoIfMinus1</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">c_read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">off</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-623"></span><span>       </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-number">0</span><span>
</span><span id="line-624"></span><span>       </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>       </span><span class="hs-identifier">n</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FD -&gt; Bool
</span><a href="GHC.Internal.IO.FD.html#isNonBlocking"><span class="hs-identifier hs-var">isNonBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823162"><span class="hs-identifier hs-var">fd</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621679823166"><span class="hs-identifier hs-var">unsafe_read</span></a></span><span> </span><span class="hs-comment">-- unsafe is ok, it can't block</span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679823167"><span class="annot"><a href="#local-6989586621679823167"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CBool -&gt; Int64 -&gt; CBool -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#unsafe_fdReady"><span class="hs-identifier hs-var">unsafe_fdReady</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823162"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">0</span></span><span>
</span><span id="line-629"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679823167"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-type">/=</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621679823168"><span class="hs-identifier hs-type">safe_read</span></a></span><span>
</span><span id="line-630"></span><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-631"></span><span>       </span><span class="hs-comment">-- XXX see note [nonblock]</span><span>
</span><span id="line-632"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-633"></span><span>   </span><span id="local-6989586621679823187"><span class="annot"><span class="annottext">do_read :: IO CSsize -&gt; IO b
</span><a href="#local-6989586621679823187"><span class="hs-identifier hs-var hs-var">do_read</span></a></span></span><span> </span><span id="local-6989586621679823188"><span class="annot"><span class="annottext">IO CSsize
</span><a href="#local-6989586621679823188"><span class="hs-identifier hs-var">call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679823189"><span class="annot"><a href="#local-6989586621679823189"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO CSsize -&gt; IO CSsize -&gt; IO CSsize
</span><a href="GHC.Internal.IO.FD.html#throwErrnoIfMinus1RetryOnBlock"><span class="hs-identifier hs-var">throwErrnoIfMinus1RetryOnBlock</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823161"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">IO CSsize
</span><a href="#local-6989586621679823188"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CSsize -&gt; IO CSsize
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">CSsize
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>                     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679823189"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-635"></span><span>                       </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; IO b
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">0</span></span><span>
</span><span id="line-636"></span><span>                       </span><span class="annot"><span class="annottext">CSsize
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; IO b
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>                       </span><span id="local-6989586621679823191"><span class="annot"><span class="annottext">CSsize
</span><a href="#local-6989586621679823191"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; IO b
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CSsize -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">CSsize
</span><a href="#local-6989586621679823191"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>   </span><span id="local-6989586621679823166"><span class="annot"><span class="annottext">unsafe_read :: IO Int
</span><a href="#local-6989586621679823166"><span class="hs-identifier hs-var hs-var">unsafe_read</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CSsize -&gt; IO Int
forall {b}. Num b =&gt; IO CSsize -&gt; IO b
</span><a href="#local-6989586621679823187"><span class="hs-identifier hs-var">do_read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize
</span><a href="GHC.Internal.System.Posix.Internals.html#c_read"><span class="hs-identifier hs-var">c_read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823162"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823163"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823164"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823165"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>   </span><span id="local-6989586621679823168"><span class="annot"><span class="annottext">safe_read :: IO Int
</span><a href="#local-6989586621679823168"><span class="hs-identifier hs-var hs-var">safe_read</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CSsize -&gt; IO Int
forall {b}. Num b =&gt; IO CSsize -&gt; IO b
</span><a href="#local-6989586621679823187"><span class="hs-identifier hs-var">do_read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize
</span><a href="GHC.Internal.System.Posix.Internals.html#c_safe_read"><span class="hs-identifier hs-var">c_safe_read</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823162"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823163"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823164"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823165"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-642"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#writeRawBufferPtr"><span class="hs-identifier hs-type">writeRawBufferPtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CSize"><span class="hs-identifier hs-type">CSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span>
</span><span id="line-643"></span><span id="writeRawBufferPtr"><span class="annot"><span class="annottext">writeRawBufferPtr :: String -&gt; FD -&gt; Ptr Word8 -&gt; Int -&gt; CSize -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#writeRawBufferPtr"><span class="hs-identifier hs-var hs-var">writeRawBufferPtr</span></a></span></span><span> </span><span id="local-6989586621679823194"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823194"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823195"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823195"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823196"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823196"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823197"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823197"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823198"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823198"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-identifier">throwErrnoIfMinus1</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">c_write</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">off</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FD -&gt; Bool
</span><a href="GHC.Internal.IO.FD.html#isNonBlocking"><span class="hs-identifier hs-var">isNonBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823195"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CInt
</span><a href="#local-6989586621679823199"><span class="hs-identifier hs-var">unsafe_write</span></a></span><span> </span><span class="hs-comment">-- unsafe is ok, it can't block</span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679823200"><span class="annot"><a href="#local-6989586621679823200"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CBool -&gt; Int64 -&gt; CBool -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#unsafe_fdReady"><span class="hs-identifier hs-var">unsafe_fdReady</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823195"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">0</span></span><span>
</span><span id="line-650"></span><span>                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679823200"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-type">/=</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-651"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621679823201"><span class="hs-identifier hs-type">write</span></a></span><span>
</span><span id="line-652"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="GHC.Internal.Conc.IO.html#threadWaitWrite"><span class="hs-identifier hs-type">threadWaitWrite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-type">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823195"><span class="hs-identifier hs-type">fd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621679823201"><span class="hs-identifier hs-type">write</span></a></span><span>
</span><span id="line-653"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-654"></span><span>    </span><span id="local-6989586621679823222"><span class="annot"><span class="annottext">do_write :: IO a -&gt; IO b
</span><a href="#local-6989586621679823222"><span class="hs-identifier hs-var hs-var">do_write</span></a></span></span><span> </span><span id="local-6989586621679823223"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679823223"><span class="hs-identifier hs-var">call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; IO a -&gt; IO b
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="GHC.Internal.Base.html#fmap"><span class="hs-operator hs-var">`fmap`</span></a></span><span>
</span><span id="line-655"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; IO a -&gt; IO () -&gt; IO a
forall a b. (Eq a, Num a) =&gt; String -&gt; IO a -&gt; IO b -&gt; IO a
</span><a href="GHC.Internal.Foreign.C.Error.html#throwErrnoIfMinus1RetryMayBlock"><span class="hs-identifier hs-var">throwErrnoIfMinus1RetryMayBlock</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823194"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679823223"><span class="hs-identifier hs-var">call</span></a></span><span>
</span><span id="line-656"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fd -&gt; IO ()
</span><a href="GHC.Internal.Conc.IO.html#threadWaitWrite"><span class="hs-identifier hs-var">threadWaitWrite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Fd
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823195"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>    </span><span id="local-6989586621679823201"><span class="annot"><span class="annottext">write :: IO CInt
</span><a href="#local-6989586621679823201"><span class="hs-identifier hs-var hs-var">write</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.IO.FD.html#threaded"><span class="hs-identifier hs-var">threaded</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO CInt
</span><a href="#local-6989586621679823224"><span class="hs-identifier hs-var">safe_write</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO CInt
</span><a href="#local-6989586621679823199"><span class="hs-identifier hs-var">unsafe_write</span></a></span><span>
</span><span id="line-658"></span><span>    </span><span id="local-6989586621679823199"><span class="annot"><span class="annottext">unsafe_write :: IO CInt
</span><a href="#local-6989586621679823199"><span class="hs-identifier hs-var hs-var">unsafe_write</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CSsize -&gt; IO CInt
forall {a} {b}. (Integral a, Num b) =&gt; IO a -&gt; IO b
</span><a href="#local-6989586621679823222"><span class="hs-identifier hs-var">do_write</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize
</span><a href="GHC.Internal.System.Posix.Internals.html#c_write"><span class="hs-identifier hs-var">c_write</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823195"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823196"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823197"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823198"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>    </span><span id="local-6989586621679823224"><span class="annot"><span class="annottext">safe_write :: IO CInt
</span><a href="#local-6989586621679823224"><span class="hs-identifier hs-var hs-var">safe_write</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CSsize -&gt; IO CInt
forall {a} {b}. (Integral a, Num b) =&gt; IO a -&gt; IO b
</span><a href="#local-6989586621679823222"><span class="hs-identifier hs-var">do_write</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize
</span><a href="GHC.Internal.System.Posix.Internals.html#c_safe_write"><span class="hs-identifier hs-var">c_safe_write</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823195"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823196"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823197"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823198"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-662"></span><span class="annot"><a href="GHC.Internal.IO.FD.html#writeRawBufferPtrNoBlock"><span class="hs-identifier hs-type">writeRawBufferPtrNoBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CSize"><span class="hs-identifier hs-type">CSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span>
</span><span id="line-663"></span><span id="writeRawBufferPtrNoBlock"><span class="annot"><span class="annottext">writeRawBufferPtrNoBlock :: String -&gt; FD -&gt; Ptr Word8 -&gt; Int -&gt; CSize -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#writeRawBufferPtrNoBlock"><span class="hs-identifier hs-var hs-var">writeRawBufferPtrNoBlock</span></a></span></span><span> </span><span id="local-6989586621679823231"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823231"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823232"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823232"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823233"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823233"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823234"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823234"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679823235"><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823235"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-cpp">
#if defined(javascript_HOST_ARCH)
</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">throwErrnoIfMinus1</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">c_write</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">off</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-668"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-number">0</span><span>
</span><span id="line-669"></span><span>        </span><span class="hs-identifier">n</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FD -&gt; Bool
</span><a href="GHC.Internal.IO.FD.html#isNonBlocking"><span class="hs-identifier hs-var">isNonBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823232"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CInt
</span><a href="#local-6989586621679823236"><span class="hs-identifier hs-var">unsafe_write</span></a></span><span> </span><span class="hs-comment">-- unsafe is ok, it can't block</span><span>
</span><span id="line-672"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679823237"><span class="annot"><a href="#local-6989586621679823237"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; CBool -&gt; Int64 -&gt; CBool -&gt; IO CInt
</span><a href="GHC.Internal.IO.FD.html#unsafe_fdReady"><span class="hs-identifier hs-var">unsafe_fdReady</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823232"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">CBool
</span><span class="hs-number">0</span></span><span>
</span><span id="line-673"></span><span>                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679823237"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-type">/=</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621679823238"><span class="hs-identifier hs-type">write</span></a></span><span>
</span><span id="line-674"></span><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621679823252"><span class="annot"><span class="annottext">do_write :: IO CSsize -&gt; IO b
</span><a href="#local-6989586621679823252"><span class="hs-identifier hs-var hs-var">do_write</span></a></span></span><span> </span><span id="local-6989586621679823253"><span class="annot"><span class="annottext">IO CSsize
</span><a href="#local-6989586621679823253"><span class="hs-identifier hs-var">call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679823254"><span class="annot"><a href="#local-6989586621679823254"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO CSsize -&gt; IO CSsize -&gt; IO CSsize
</span><a href="GHC.Internal.IO.FD.html#throwErrnoIfMinus1RetryOnBlock"><span class="hs-identifier hs-var">throwErrnoIfMinus1RetryOnBlock</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823231"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">IO CSsize
</span><a href="#local-6989586621679823253"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CSsize -&gt; IO CSsize
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">CSsize
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>                       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679823254"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-678"></span><span>                         </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; IO b
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">0</span></span><span>
</span><span id="line-679"></span><span>                         </span><span id="local-6989586621679823255"><span class="annot"><span class="annottext">CSsize
</span><a href="#local-6989586621679823255"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; IO b
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CSsize -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="GHC.Internal.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">CSsize
</span><a href="#local-6989586621679823255"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>    </span><span id="local-6989586621679823238"><span class="annot"><span class="annottext">write :: IO CInt
</span><a href="#local-6989586621679823238"><span class="hs-identifier hs-var hs-var">write</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Internal.IO.FD.html#threaded"><span class="hs-identifier hs-var">threaded</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO CInt
</span><a href="#local-6989586621679823256"><span class="hs-identifier hs-var">safe_write</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO CInt
</span><a href="#local-6989586621679823236"><span class="hs-identifier hs-var">unsafe_write</span></a></span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621679823236"><span class="annot"><span class="annottext">unsafe_write :: IO CInt
</span><a href="#local-6989586621679823236"><span class="hs-identifier hs-var hs-var">unsafe_write</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CSsize -&gt; IO CInt
forall {b}. Num b =&gt; IO CSsize -&gt; IO b
</span><a href="#local-6989586621679823252"><span class="hs-identifier hs-var">do_write</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize
</span><a href="GHC.Internal.System.Posix.Internals.html#c_write"><span class="hs-identifier hs-var">c_write</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823232"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823233"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823234"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823235"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>    </span><span id="local-6989586621679823256"><span class="annot"><span class="annottext">safe_write :: IO CInt
</span><a href="#local-6989586621679823256"><span class="hs-identifier hs-var hs-var">safe_write</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CSsize -&gt; IO CInt
forall {b}. Num b =&gt; IO CSsize -&gt; IO b
</span><a href="#local-6989586621679823252"><span class="hs-identifier hs-var">do_write</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize
</span><a href="GHC.Internal.System.Posix.Internals.html#c_safe_write"><span class="hs-identifier hs-var">c_safe_write</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FD -&gt; CInt
</span><a href="GHC.Internal.IO.FD.html#fdFD"><span class="hs-identifier hs-var">fdFD</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823232"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679823233"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; Ptr Word8
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><a href="GHC.Internal.Ptr.html#plusPtr"><span class="hs-operator hs-var">`plusPtr`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679823234"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="#local-6989586621679823235"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if !defined(javascript_HOST_ARCH)
</span><span class="annot"><a href="GHC.Internal.IO.FD.html#isNonBlocking"><span class="hs-identifier hs-type">isNonBlocking</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#FD"><span class="hs-identifier hs-type">FD</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-687"></span><span id="isNonBlocking"><span class="annot"><span class="annottext">isNonBlocking :: FD -&gt; Bool
</span><a href="GHC.Internal.IO.FD.html#isNonBlocking"><span class="hs-identifier hs-var hs-var">isNonBlocking</span></a></span></span><span> </span><span id="local-6989586621679823259"><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823259"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FD -&gt; Int
</span><a href="GHC.Internal.IO.FD.html#fdIsNonBlocking"><span class="hs-identifier hs-var">fdIsNonBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">FD
</span><a href="#local-6989586621679823259"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;fdReady&quot;</span></span><span>
</span><span id="line-690"></span><span>  </span><span id="unsafe_fdReady"><span class="annot"><a href="GHC.Internal.IO.FD.html#unsafe_fdReady"><span class="hs-identifier hs-var">unsafe_fdReady</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#else /* mingw32_HOST_OS.... */
</span><span>
</span><span id="line-695"></span><span class="hs-identifier">readRawBufferPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-696"></span><span class="hs-identifier">readRawBufferPtr</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">buf</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">off</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">len</span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">threaded</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">blockingReadRawBufferPtr</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-identifier">len</span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">asyncReadRawBufferPtr</span><span>    </span><span class="hs-identifier">loc</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-identifier">len</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="hs-identifier">writeRawBufferPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-701"></span><span class="hs-identifier">writeRawBufferPtr</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">buf</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">off</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">len</span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">threaded</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">blockingWriteRawBufferPtr</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-identifier">len</span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">asyncWriteRawBufferPtr</span><span>    </span><span class="hs-identifier">loc</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-identifier">len</span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span class="hs-identifier">readRawBufferPtrNoBlock</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-706"></span><span class="hs-identifier">readRawBufferPtrNoBlock</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">readRawBufferPtr</span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="hs-identifier">writeRawBufferPtrNoBlock</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-709"></span><span class="hs-identifier">writeRawBufferPtrNoBlock</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">writeRawBufferPtr</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span class="hs-comment">-- Async versions of the read/write primitives, for the non-threaded RTS</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="hs-identifier">asyncReadRawBufferPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-714"></span><span class="hs-identifier">asyncReadRawBufferPtr</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">buf</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">off</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>    </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">asyncRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdIsSocket_</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>                        </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">off</span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">sock_errno</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c_maperrno_func</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">rc</span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>               </span><span class="hs-identifier">non_sock_errno</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Errno</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">rc</span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>               </span><span class="hs-identifier">errno</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bool</span><span> </span><span class="hs-identifier">non_sock_errno</span><span> </span><span class="hs-identifier">sock_errno</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>           </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">errnoToIOError</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-identifier">errno</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span class="hs-identifier">asyncWriteRawBufferPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-725"></span><span class="hs-identifier">asyncWriteRawBufferPtr</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">buf</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">off</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-726"></span><span>    </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">asyncWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdIsSocket_</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">off</span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">sock_errno</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c_maperrno_func</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">rc</span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>               </span><span class="hs-identifier">non_sock_errno</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Errno</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">rc</span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>               </span><span class="hs-identifier">errno</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bool</span><span> </span><span class="hs-identifier">non_sock_errno</span><span> </span><span class="hs-identifier">sock_errno</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>           </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">errnoToIOError</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-identifier">errno</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="hs-comment">-- Blocking versions of the read/write primitives, for the threaded RTS</span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span class="hs-identifier">blockingReadRawBufferPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-738"></span><span class="hs-identifier">blockingReadRawBufferPtr</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">buf</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">off</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">len</span><span>
</span><span id="line-739"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">throwErrnoIfMinus1Retry</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-740"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">start_ptr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">off</span><span>
</span><span id="line-741"></span><span>            </span><span class="hs-identifier">recv_ret</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c_safe_recv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">start_ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span>
</span><span id="line-742"></span><span>            </span><span class="hs-identifier">read_ret</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c_safe_read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">start_ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>        </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">bool</span><span> </span><span class="hs-identifier">read_ret</span><span> </span><span class="hs-identifier">recv_ret</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>        </span><span class="hs-identifier">when</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">c_maperrno</span><span>
</span><span id="line-745"></span><span>        </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">r</span><span>
</span><span id="line-746"></span><span>      </span><span class="hs-comment">-- We trust read() to give us the correct errno but recv(), as a</span><span>
</span><span id="line-747"></span><span>      </span><span class="hs-comment">-- Winsock function, doesn't do the errno conversion so if the fd</span><span>
</span><span id="line-748"></span><span>      </span><span class="hs-comment">-- is for a socket, we do it from GetLastError() ourselves.</span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span class="hs-identifier">blockingWriteRawBufferPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-751"></span><span class="hs-identifier">blockingWriteRawBufferPtr</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">buf</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">off</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">len</span><span>
</span><span id="line-752"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">throwErrnoIfMinus1Retry</span><span> </span><span class="hs-identifier">loc</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-753"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">start_ptr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">off</span><span>
</span><span id="line-754"></span><span>            </span><span class="hs-identifier">send_ret</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c_safe_send</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">start_ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span>
</span><span id="line-755"></span><span>            </span><span class="hs-identifier">write_ret</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c_safe_write</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdFD</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">start_ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>        </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">bool</span><span> </span><span class="hs-identifier">write_ret</span><span> </span><span class="hs-identifier">send_ret</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fdIsSocket</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-identifier">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">c_maperrno</span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">r</span><span>
</span><span id="line-759"></span><span>      </span><span class="hs-comment">-- We don't trust write() to give us the correct errno, and</span><span>
</span><span id="line-760"></span><span>      </span><span class="hs-comment">-- instead do the errno conversion from GetLastError()</span><span>
</span><span id="line-761"></span><span>      </span><span class="hs-comment">-- ourselves. The main reason is that we treat ERROR_NO_DATA</span><span>
</span><span id="line-762"></span><span>      </span><span class="hs-comment">-- (pipe is closing) as EPIPE, whereas write() returns EINVAL</span><span>
</span><span id="line-763"></span><span>      </span><span class="hs-comment">-- for this case. We need to detect EPIPE correctly, because it</span><span>
</span><span id="line-764"></span><span>      </span><span class="hs-comment">-- shouldn't be reported as an error when it happens on stdout.</span><span>
</span><span id="line-765"></span><span>      </span><span class="hs-comment">-- As for send()'s case, Winsock functions don't do errno</span><span>
</span><span id="line-766"></span><span>      </span><span class="hs-comment">-- conversion in any case so we have to do it ourselves.</span><span>
</span><span id="line-767"></span><span>      </span><span class="hs-comment">-- That means we're doing the errno conversion no matter if the</span><span>
</span><span id="line-768"></span><span>      </span><span class="hs-comment">-- fd is from a socket or not.</span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span class="hs-comment">-- NOTE: &quot;safe&quot; versions of the read/write calls for use by the threaded RTS.</span><span>
</span><span id="line-771"></span><span class="hs-comment">-- These calls may block, but that's ok.</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">safe</span><span> </span><span class="hs-string">&quot;recv&quot;</span><span>
</span><span id="line-774"></span><span>   </span><span class="hs-identifier">c_safe_recv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-comment">{-flags-}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><span id="line-775"></span><span>
</span><span id="line-776"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">safe</span><span> </span><span class="hs-string">&quot;send&quot;</span><span>
</span><span id="line-777"></span><span>   </span><span class="hs-identifier">c_safe_send</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-comment">{-flags-}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-cpp">

#endif
</span><span class="hs-cpp">
#if !defined(javascript_HOST_ARCH)
</span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;rtsSupportsBoundThreads&quot;</span></span><span> </span><span id="threaded"><span class="annot"><a href="GHC.Internal.IO.FD.html#threaded"><span class="hs-identifier hs-var">threaded</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-785"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-786"></span><span class="hs-comment">-- utils</span><span class="hs-cpp">

#if !defined(mingw32_HOST_OS) &amp;&amp; !defined(javascript_HOST_ARCH)
</span><span class="annot"><a href="GHC.Internal.IO.FD.html#throwErrnoIfMinus1RetryOnBlock"><span class="hs-identifier hs-type">throwErrnoIfMinus1RetryOnBlock</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html#CSsize"><span class="hs-identifier hs-type">CSsize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html#CSsize"><span class="hs-identifier hs-type">CSsize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html#CSsize"><span class="hs-identifier hs-type">CSsize</span></a></span><span>
</span><span id="line-790"></span><span id="throwErrnoIfMinus1RetryOnBlock"><span class="annot"><span class="annottext">throwErrnoIfMinus1RetryOnBlock :: String -&gt; IO CSsize -&gt; IO CSsize -&gt; IO CSsize
</span><a href="GHC.Internal.IO.FD.html#throwErrnoIfMinus1RetryOnBlock"><span class="hs-identifier hs-var hs-var">throwErrnoIfMinus1RetryOnBlock</span></a></span></span><span> </span><span id="local-6989586621679823260"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679823260"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679823261"><span class="annot"><span class="annottext">IO CSsize
</span><a href="#local-6989586621679823261"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679823262"><span class="annot"><span class="annottext">IO CSsize
</span><a href="#local-6989586621679823262"><span class="hs-identifier hs-var">on_block</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-791"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-792"></span><span>    </span><span id="local-6989586621679823263"><span class="annot"><a href="#local-6989586621679823263"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CSsize
</span><a href="#local-6989586621679823261"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-793"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679823263"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.System.Posix.Types.html#CSsize"><span class="hs-identifier hs-type">CSsize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-794"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-795"></span><span>        </span><span id="local-6989586621679823264"><span class="annot"><a href="#local-6989586621679823264"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Error.html#getErrno"><span class="hs-identifier hs-type">getErrno</span></a></span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679823264"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Error.html#eINTR"><span class="hs-identifier hs-type">eINTR</span></a></span><span>
</span><span id="line-797"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="GHC.Internal.IO.FD.html#throwErrnoIfMinus1RetryOnBlock"><span class="hs-identifier hs-type">throwErrnoIfMinus1RetryOnBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823260"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823261"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823262"><span class="hs-identifier hs-type">on_block</span></a></span><span>
</span><span id="line-798"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679823264"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Error.html#eWOULDBLOCK"><span class="hs-identifier hs-type">eWOULDBLOCK</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-type">||</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823264"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-type">==</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Error.html#eAGAIN"><span class="hs-identifier hs-type">eAGAIN</span></a></span><span>
</span><span id="line-799"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621679823262"><span class="hs-identifier hs-type">on_block</span></a></span><span>
</span><span id="line-800"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Error.html#throwErrno"><span class="hs-identifier hs-type">throwErrno</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823260"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="GHC.Internal.Base.html#return"><span class="hs-identifier hs-type">return</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679823263"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-804"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- Locking/unlocking</span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;lockFile&quot;</span></span><span>
</span><span id="line-808"></span><span>  </span><span id="lockFile"><span class="annot"><a href="GHC.Internal.IO.FD.html#lockFile"><span class="hs-identifier hs-var">lockFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;unlockFile&quot;</span></span><span>
</span><span id="line-811"></span><span>  </span><span id="unlockFile"><span class="annot"><a href="GHC.Internal.IO.FD.html#unlockFile"><span class="hs-identifier hs-var">unlockFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Internal.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-prim-0.13.0-e168/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="GHC.Internal.Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a></span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;get_unique_file_info&quot;</span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-identifier">c_getUniqueFileInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span></pre></body></html>